<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Term Conversion Test</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    table { border-collapse: collapse; width: 100%; margin: 20px 0; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background-color: #4CAF50; color: white; }
    tr:nth-child(even) { background-color: #f2f2f2; }
    .pass { color: green; font-weight: bold; }
    .fail { color: red; font-weight: bold; }
  </style>
</head>
<body>
  <h1>ğŸ“… æ—¥ä»˜ â†’ æœŸ å¤‰æ›ãƒ†ã‚¹ãƒˆ</h1>
  <p><strong>å¤‰æ›ãƒ«ãƒ¼ãƒ«:</strong> 43æœŸ = 2025/03ï½2026/02ã€44æœŸ = 2026/03ï½2027/02</p>
  
  <h2>ãƒ†ã‚¹ãƒˆçµæœ</h2>
  <table id="testResults">
    <thead>
      <tr>
        <th>å…¥åŠ›å€¤</th>
        <th>æœŸå¾…å€¤</th>
        <th>å®Ÿéš›ã®å‡ºåŠ›</th>
        <th>çµæœ</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    /**
     * æ—¥ä»˜æ–‡å­—åˆ—ã‹ã‚‰ã€ŒæœŸã€ã«å¤‰æ›ï¼ˆGASã¨åŒã˜ãƒ­ã‚¸ãƒƒã‚¯ï¼‰
     */
    function dateToTerm(dateInput) {
      if (!dateInput) return '';
      
      // ã™ã§ã«ã€Œâ—‹â—‹æœŸã€ã®å½¢å¼ãªã‚‰ã€ãã®ã¾ã¾è¿”ã™
      if (typeof dateInput === 'string' && /^\d+æœŸ$/.test(dateInput.trim())) {
        return dateInput.trim();
      }

      try {
        const date = new Date(dateInput);
        if (isNaN(date.getTime())) {
          return String(dateInput);
        }

        const year = date.getFullYear();
        const month = date.getMonth() + 1; // 0-indexed

        // åŸºæº–: 43æœŸ = 2025/03 ~ 2026/02
        const BASE_TERM = 43;
        const BASE_START_YEAR = 2025;
        const BASE_START_MONTH = 3;

        // æœŸã®é–‹å§‹å¹´æœˆã‚’è¨ˆç®—
        let termStartYear;
        if (month >= BASE_START_MONTH) {
          termStartYear = year;
        } else {
          termStartYear = year - 1;
        }

        // 43æœŸã‹ã‚‰ã®å·®åˆ†ã‚’è¨ˆç®—
        const yearDiff = termStartYear - BASE_START_YEAR;
        const term = BASE_TERM + yearDiff;

        return `${term}æœŸ`;
      } catch (error) {
        return String(dateInput);
      }
    }

    // ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹
    const testCases = [
      // 43æœŸï¼ˆ2025/03ï½2026/02ï¼‰
      { input: '2025-03-01', expected: '43æœŸ', description: '43æœŸã®é–‹å§‹æ—¥' },
      { input: '2025-06-15', expected: '43æœŸ', description: '43æœŸã®é€”ä¸­ï¼ˆ6æœˆï¼‰' },
      { input: '2025-12-31', expected: '43æœŸ', description: '43æœŸã®å¹´æœ«' },
      { input: '2026-01-15', expected: '43æœŸ', description: '43æœŸã®çµ‚ç›¤ï¼ˆ1æœˆï¼‰' },
      { input: '2026-02-28', expected: '43æœŸ', description: '43æœŸã®æœ€çµ‚æ—¥' },
      
      // 44æœŸï¼ˆ2026/03ï½2027/02ï¼‰
      { input: '2026-03-01', expected: '44æœŸ', description: '44æœŸã®é–‹å§‹æ—¥' },
      { input: '2026-04-10', expected: '44æœŸ', description: '44æœŸã®é€”ä¸­ï¼ˆ4æœˆï¼‰' },
      { input: '2026-12-25', expected: '44æœŸ', description: '44æœŸã®ã‚¯ãƒªã‚¹ãƒã‚¹' },
      { input: '2027-02-28', expected: '44æœŸ', description: '44æœŸã®æœ€çµ‚æ—¥' },
      
      // 45æœŸï¼ˆ2027/03ï½2028/02ï¼‰
      { input: '2027-03-01', expected: '45æœŸ', description: '45æœŸã®é–‹å§‹æ—¥' },
      { input: '2027-06-01', expected: '45æœŸ', description: '45æœŸã®é€”ä¸­' },
      
      // 42æœŸï¼ˆ2024/03ï½2025/02ï¼‰
      { input: '2024-03-01', expected: '42æœŸ', description: '42æœŸã®é–‹å§‹æ—¥' },
      { input: '2024-06-01', expected: '42æœŸ', description: '42æœŸã®é€”ä¸­' },
      { input: '2025-02-28', expected: '42æœŸ', description: '42æœŸã®æœ€çµ‚æ—¥' },
      
      // 41æœŸï¼ˆ2023/03ï½2024/02ï¼‰
      { input: '2023-03-01', expected: '41æœŸ', description: '41æœŸã®é–‹å§‹æ—¥' },
      { input: '2024-02-29', expected: '41æœŸ', description: '41æœŸã®æœ€çµ‚æ—¥ï¼ˆé–å¹´ï¼‰' },
      
      // 40æœŸï¼ˆ2022/03ï½2023/02ï¼‰
      { input: '2022-03-01', expected: '40æœŸ', description: '40æœŸã®é–‹å§‹æ—¥' },
      { input: '2023-02-28', expected: '40æœŸ', description: '40æœŸã®æœ€çµ‚æ—¥' },
      
      // ã™ã§ã«æœŸã®å½¢å¼
      { input: '43æœŸ', expected: '43æœŸ', description: 'ã™ã§ã«æœŸã®å½¢å¼' },
      { input: '44æœŸ', expected: '44æœŸ', description: 'ã™ã§ã«æœŸã®å½¢å¼ï¼ˆ44æœŸï¼‰' },
      
      // ç•°ãªã‚‹ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
      { input: '2025/06/15', expected: '43æœŸ', description: 'ã‚¹ãƒ©ãƒƒã‚·ãƒ¥åŒºåˆ‡ã‚Š' },
      
      // ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹
      { input: '', expected: '', description: 'ç©ºæ–‡å­—åˆ—' },
      { input: 'invalid', expected: 'invalid', description: 'ç„¡åŠ¹ãªæ—¥ä»˜' }
    ];

    // ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
    const tbody = document.querySelector('#testResults tbody');
    let passCount = 0;
    let failCount = 0;

    testCases.forEach(testCase => {
      const result = dateToTerm(testCase.input);
      const pass = result === testCase.expected;
      
      if (pass) passCount++;
      else failCount++;

      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${testCase.input || '(ç©º)'}<br><small>${testCase.description}</small></td>
        <td><strong>${testCase.expected}</strong></td>
        <td><strong>${result}</strong></td>
        <td class="${pass ? 'pass' : 'fail'}">${pass ? 'âœ… PASS' : 'âŒ FAIL'}</td>
      `;
      tbody.appendChild(row);
    });

    // ã‚µãƒãƒªãƒ¼è¿½åŠ 
    const summary = document.createElement('div');
    summary.style.cssText = 'margin: 20px 0; padding: 15px; background: #f0f0f0; border-radius: 5px;';
    summary.innerHTML = `
      <h2>ãƒ†ã‚¹ãƒˆã‚µãƒãƒªãƒ¼</h2>
      <p><span class="pass">âœ… æˆåŠŸ: ${passCount}ä»¶</span> / <span class="fail">âŒ å¤±æ•—: ${failCount}ä»¶</span> / <strong>åˆè¨ˆ: ${testCases.length}ä»¶</strong></p>
      ${failCount === 0 ? '<p style="color: green; font-size: 1.2em;">ğŸ‰ ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒåˆæ ¼ã—ã¾ã—ãŸï¼</p>' : '<p style="color: red;">âš ï¸ ä¸€éƒ¨ã®ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã—ã¾ã—ãŸ</p>'}
    `;
    document.body.insertBefore(summary, document.querySelector('h2'));
  </script>
</body>
</html>
