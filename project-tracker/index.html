<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå±¥æ­´ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  - ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
  <!-- Version: 2025-11-09-final æœŸé–“æ¯”è¼ƒåˆ†æã‚·ã‚¹ãƒ†ãƒ æœ¬ç•ªç‰ˆ -->
  <link rel="icon" type="image/png" href="SP_logo_shape_only.png">
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Project Tracker ã‚¹ã‚¿ã‚¤ãƒ«ã‚·ãƒ¼ãƒˆ -->
  <link rel="stylesheet" href="css/style-2026.css">
  <link rel="stylesheet" href="css/components.css">
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Chart.js for interactive visualizations -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  
  <!-- å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•° -->
  <script src="js/utils.js"></script>
  <script src="js/data/specialties-master.js"></script>
</head>
<body class="bg-gray-50">
  <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
  <nav class="bg-white shadow-md sticky top-0 z-40">
    <div class="container mx-auto px-2 sm:px-4 py-2 sm:py-3">
      <div class="flex items-center justify-between flex-wrap gap-2">
        <!-- ãƒ­ã‚´éƒ¨åˆ† -->
        <div class="flex items-center space-x-2 sm:space-x-4">
          <img src="Seed_Planning_Logo_Original.jpg" alt="SEED PLANNING" class="h-8 sm:h-10">
          <h1 class="hidden md:block text-lg font-bold text-gray-800">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå±¥æ­´ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h1>
        </div>
        
        <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
        <div class="flex flex-wrap gap-1 sm:gap-2">
          <a href="index.html" class="px-2 sm:px-4 py-2 text-xs sm:text-sm text-white rounded-lg transition flex items-center bg-sp-primary">
            <i class="fas fa-home sm:mr-2"></i><span class="hidden sm:inline ml-1">ãƒ›ãƒ¼ãƒ </span>
          </a>
          <a href="register.html" class="px-2 sm:px-4 py-2 text-xs sm:text-sm bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition flex items-center">
            <i class="fas fa-plus sm:mr-2"></i><span class="hidden sm:inline ml-1">æ–°è¦ç™»éŒ²</span>
          </a>
          <a href="projects.html" class="px-2 sm:px-4 py-2 text-xs sm:text-sm bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition flex items-center">
            <i class="fas fa-search sm:mr-2"></i><span class="hidden sm:inline ml-1">æ¡ˆä»¶æ¤œç´¢</span>
          </a>
          <a href="links.html" class="px-2 sm:px-4 py-2 text-xs sm:text-sm bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition flex items-center">
            <i class="fas fa-link sm:mr-2"></i><span class="hidden sm:inline ml-1">ãƒªãƒ³ã‚¯é›†</span>
          </a>
          <a href="https://seedplanning.monday.com/boards/2723929863" target="_blank" rel="noopener noreferrer" class="px-2 sm:px-4 py-2 text-xs sm:text-sm bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition flex items-center">
            <img src="monday.png" alt="Monday" class="h-3 w-3 sm:h-4 sm:w-4 sm:mr-2"><span class="hidden sm:inline ml-1">Monday</span>
          </a>
          <a href="https://db.seedplanning.co.jp/project/management" target="_blank" rel="noopener noreferrer" class="px-2 sm:px-4 py-2 text-xs sm:text-sm bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition flex items-center">
            <img src="SP_logo_shape_only.png" alt="ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†" class="h-3 w-3 sm:h-4 sm:w-4 sm:mr-2"><span class="hidden sm:inline ml-1">PJç®¡ç†</span>
          </a>
        </div>
      </div>
    </div>
  </nav>

  <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
  <div class="container mx-auto px-4 py-8">
    
    <!-- ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆä¿ƒé€²ãƒãƒŠãƒ¼ -->
    <div id="importBanner" class="hidden bg-gradient-to-r from-purple-500 to-blue-600 text-white rounded-lg shadow-lg p-6 mb-8">
      <div class="flex items-center justify-between">
        <div class="flex items-center space-x-4">
          <i class="fas fa-database text-4xl"></i>
          <div>
            <h3 class="text-xl font-bold">ãƒ‡ãƒ¼ã‚¿ãŒã¾ã ã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“</h3>
            <p class="text-sm opacity-90">Seed Planningã®å®Ÿç¸¾ãƒ‡ãƒ¼ã‚¿ï¼ˆ113ä»¶ï¼‰ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ã€ã™ãã«ä½¿ã„å§‹ã‚ã¾ã—ã‚‡ã†ï¼</p>
          </div>
        </div>
        <a href="import.html" class="bg-white text-purple-600 px-6 py-3 rounded-lg font-semibold hover:bg-gray-100 transition">
          <i class="fas fa-file-import mr-2"></i>ä»Šã™ãã‚¤ãƒ³ãƒãƒ¼ãƒˆ
        </a>
      </div>
    </div>

    <!-- çµ±è¨ˆã‚«ãƒ¼ãƒ‰ -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
      <!-- ç·æ¡ˆä»¶æ•° -->
      <div class="rounded-lg shadow-md p-6" style="background: linear-gradient(135deg, #E8F0F1 0%, #d5e5e7 100%);">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-500 text-sm">ç·æ¡ˆä»¶æ•°</p>
            <p id="totalProjects" class="text-3xl font-bold text-blue-600">0</p>
          </div>
          <div class="bg-blue-100 rounded-full p-3">
            <i class="fas fa-folder-open text-blue-600 text-2xl"></i>
          </div>
        </div>
      </div>

      <!-- ç·ãƒªã‚¯ãƒ«ãƒ¼ãƒˆäººæ•° -->
      <div class="rounded-lg shadow-md p-6" style="background: linear-gradient(135deg, #E8F0F1 0%, #d5e5e7 100%);">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-500 text-sm">ç·ãƒªã‚¯ãƒ«ãƒ¼ãƒˆäººæ•°</p>
            <p id="totalRecruits" class="text-3xl font-bold text-green-600">0</p>
          </div>
          <div class="bg-green-100 rounded-full p-3">
            <i class="fas fa-users text-green-600 text-2xl"></i>
          </div>
        </div>
      </div>

      <!-- å¹³å‡ãƒªã‚¯ãƒ«ãƒ¼ãƒˆäººæ•° -->
      <div class="rounded-lg shadow-md p-6" style="background: linear-gradient(135deg, #E8F0F1 0%, #d5e5e7 100%);">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-500 text-sm">å¹³å‡ãƒªã‚¯ãƒ«ãƒ¼ãƒˆäººæ•°</p>
            <p id="avgRecruits" class="text-3xl font-bold text-purple-600">0</p>
          </div>
          <div class="bg-purple-100 rounded-full p-3">
            <i class="fas fa-chart-line text-purple-600 text-2xl"></i>
          </div>
        </div>
      </div>

      <!-- ä»Šæœˆã®æ–°è¦æ¡ˆä»¶ -->
      <div class="rounded-lg shadow-md p-6" style="background: linear-gradient(135deg, #E8F0F1 0%, #d5e5e7 100%);">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-500 text-sm">ä»Šæœˆã®æ–°è¦</p>
            <p id="thisMonthProjects" class="text-3xl font-bold text-orange-600">0</p>
          </div>
          <div class="bg-orange-100 rounded-full p-3">
            <i class="fas fa-calendar-plus text-orange-600 text-2xl"></i>
          </div>
        </div>
      </div>
    </div>

    <!-- æœ€è¿‘ã®æ¡ˆä»¶ -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-8">
      <h2 class="text-xl font-bold mb-4 flex items-center">
        <i class="fas fa-clock mr-2 text-purple-600"></i>
        æœ€è¿‘ã®æ¡ˆä»¶ï¼ˆ5ä»¶ï¼‰
      </h2>
      <div class="overflow-x-auto">
        <table class="min-w-full">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">ç–¾æ‚£å</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">ç–¾æ‚£ç•¥èª</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">å¯¾è±¡è€…</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">å°‚é–€</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">å®Ÿç¸¾æ•°</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">ç™»éŒ²æ—¥</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</th>
            </tr>
          </thead>
          <tbody id="recentProjectsTable" class="bg-white divide-y divide-gray-200">
            <!-- å‹•çš„ã«ç”Ÿæˆ -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- 2ã‚«ãƒ©ãƒ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
      
      <!-- ç–¾æ‚£ã‚«ãƒ†ã‚´ãƒªãƒ¼ Top 5 -->
      <div class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-xl font-bold mb-4 flex items-center justify-between">
          <span>
            <i class="fas fa-heartbeat mr-2 text-red-600"></i>
            ç–¾æ‚£ã‚«ãƒ†ã‚´ãƒªãƒ¼ Top 5 <span class="text-sm font-normal text-gray-500 ml-2">ï¼ˆéå»3ãƒµæœˆæ¯”è¼ƒï¼‰</span>
          </span>
          <button onclick="toggleChartView('disease')" class="text-sm px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded-lg transition">
            <i class="fas fa-exchange-alt mr-1"></i><span id="diseaseToggleText">å††ã‚°ãƒ©ãƒ•è¡¨ç¤º</span>
          </button>
        </h2>
        <!-- ãƒãƒ¼ãƒãƒ£ãƒ¼ãƒˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰ -->
        <div id="diseaseChart" class="space-y-3">
          <!-- å‹•çš„ã«ç”Ÿæˆ -->
        </div>
        <!-- ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒãƒ£ãƒ¼ãƒˆï¼ˆChart.jsï¼‰ -->
        <div id="diseaseChartCanvas" class="hidden">
          <canvas id="diseaseCanvas"></canvas>
        </div>
      </div>

      <!-- å°‚é–€ï¼ˆè¨ºç™‚ç§‘ï¼‰Top 5 -->
      <div class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-xl font-bold mb-4 flex items-center justify-between">
          <span>
            <i class="fas fa-user-md mr-2 text-indigo-600"></i>
            å°‚é–€ï¼ˆè¨ºç™‚ç§‘ï¼‰Top 5 <span class="text-sm font-normal text-gray-500 ml-2">ï¼ˆéå»3ãƒµæœˆæ¯”è¼ƒï¼‰</span>
          </span>
          <button onclick="toggleChartView('specialty')" class="text-sm px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded-lg transition">
            <i class="fas fa-exchange-alt mr-1"></i><span id="specialtyToggleText">å††ã‚°ãƒ©ãƒ•è¡¨ç¤º</span>
          </button>
        </h2>
        <!-- ãƒãƒ¼ãƒãƒ£ãƒ¼ãƒˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰ -->
        <div id="specialtyChart" class="space-y-3">
          <!-- å‹•çš„ã«ç”Ÿæˆ -->
        </div>
        <!-- ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒãƒ£ãƒ¼ãƒˆï¼ˆChart.jsï¼‰ -->
        <div id="specialtyChartCanvas" class="hidden">
          <canvas id="specialtyCanvas"></canvas>
        </div>
      </div>
    </div>

    <!-- 2ã‚«ãƒ©ãƒ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
      
      <!-- å¯¾è±¡è€…ã‚¿ã‚¤ãƒ—åˆ¥åˆ†å¸ƒ -->
      <div class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-xl font-bold mb-4 flex items-center justify-between">
          <span>
            <i class="fas fa-chart-pie mr-2 text-blue-600"></i>
            å¯¾è±¡è€…ã‚¿ã‚¤ãƒ—åˆ¥åˆ†å¸ƒ <span class="text-sm font-normal text-gray-500 ml-2">ï¼ˆéå»1å¹´æ¯”è¼ƒï¼‰</span>
          </span>
          <button onclick="toggleChartView('targetType')" class="text-sm px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded-lg transition">
            <i class="fas fa-exchange-alt mr-1"></i><span id="targetTypeToggleText">å††ã‚°ãƒ©ãƒ•è¡¨ç¤º</span>
          </button>
        </h2>
        <!-- ãƒãƒ¼ãƒãƒ£ãƒ¼ãƒˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰ -->
        <div id="targetTypeChart" class="space-y-3">
          <!-- å‹•çš„ã«ç”Ÿæˆ -->
        </div>
        <!-- ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒãƒ£ãƒ¼ãƒˆï¼ˆChart.jsï¼‰ -->
        <div id="targetTypeChartCanvas" class="hidden">
          <canvas id="targetTypeCanvas"></canvas>
        </div>
      </div>

      <!-- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ Top 5 -->
      <div class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-xl font-bold mb-4 flex items-center justify-between">
          <span>
            <i class="fas fa-handshake mr-2 text-yellow-600"></i>
            ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ Top 5 <span class="text-sm font-normal text-gray-500 ml-2">ï¼ˆéå»3ãƒµæœˆæ¯”è¼ƒï¼‰</span>
          </span>
          <button onclick="toggleChartView('client')" class="text-sm px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded-lg transition">
            <i class="fas fa-exchange-alt mr-1"></i><span id="clientToggleText">å††ã‚°ãƒ©ãƒ•è¡¨ç¤º</span>
          </button>
        </h2>
        <!-- ãƒãƒ¼ãƒãƒ£ãƒ¼ãƒˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰ -->
        <div id="clientChart" class="space-y-3">
          <!-- å‹•çš„ã«ç”Ÿæˆ -->
        </div>
        <!-- ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒãƒ£ãƒ¼ãƒˆï¼ˆChart.jsï¼‰ -->
        <div id="clientChartCanvas" class="hidden">
          <canvas id="clientCanvas"></canvas>
        </div>
      </div>
    </div>

    <!-- ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="mt-8 flex justify-center space-x-4">
      <a href="import.html" class="bg-purple-500 text-white px-6 py-3 rounded-lg hover:bg-purple-600 transition flex items-center space-x-2">
        <i class="fas fa-chart-bar"></i>
        <span>è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆ</span>
      </a>
      <a href="register.html" class="bg-green-500 text-white px-6 py-3 rounded-lg hover:bg-green-600 transition flex items-center space-x-2">
        <i class="fas fa-plus-circle"></i>
        <span>æ–°è¦æ¡ˆä»¶ç™»éŒ²</span>
      </a>
      <a href="projects.html" class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition flex items-center space-x-2">
        <i class="fas fa-search"></i>
        <span>æ¡ˆä»¶æ¤œç´¢</span>
      </a>
    </div>
  </div>

  <!-- å…±é€šè¨­å®š -->
  <script src="js/config.js"></script>
  <script src="js/specialties.js"></script>
  <!-- API Client -->
  <script src="js/api.js"></script>
  <!-- Export helpers -->
  <script src="js/export.js"></script>

  <!-- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ­ã‚¸ãƒƒã‚¯ -->
  <script>
    // åˆæœŸåŒ–
    async function initDashboard() {
      // ãƒ‡ãƒ¼ã‚¿å­˜åœ¨ç¢ºèªï¼†è‡ªå‹•å–å¾—
      await ensureDataLoaded();
      await loadStatistics();
    }
    
    // ãƒ‡ãƒ¼ã‚¿ãŒå–å¾—ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªï¼ˆåˆå›èµ·å‹•æ™‚ã®è‡ªå‹•åŒæœŸï¼‰
    async function ensureDataLoaded() {
      try {
        const projects = await api.getAllProjects();
        console.log('ğŸ” Data Check:');
        console.log(`  - Projects loaded: ${projects.length}`);
        console.log('  - Expected: ~469 (after CSV parser fix)');
        console.log('  - Old (buggy): 611');
        
        if (projects.length === 0) {
          console.log('âš ï¸ ãƒ‡ãƒ¼ã‚¿ãŒç©ºã§ã™ã€‚GitHubã‹ã‚‰å–å¾—ã—ã¦ã„ã¾ã™...');
          // å¼·åˆ¶ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥
          api.clearCache();
          await api.getAllProjects(true);
        } else if (projects.length > 500) {
          console.warn('âš ï¸ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ•°ãŒ500ã‚’è¶…ãˆã¦ã„ã¾ã™ï¼CSVãƒ‘ãƒ¼ã‚µãƒ¼ã®ä¿®æ­£ãŒåæ˜ ã•ã‚Œã¦ã„ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚');
          console.warn('ğŸ’¡ å¯¾å‡¦æ³•:');
          console.warn('  1. 5åˆ†å¾…ã£ã¦ã‹ã‚‰å†åº¦ãƒªãƒ­ãƒ¼ãƒ‰ï¼ˆCloudflare Workerã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒæœŸé™åˆ‡ã‚Œã«ãªã‚‹ï¼‰');
          console.warn('  2. ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒªãƒ­ãƒ¼ãƒ‰ï¼ˆCtrl+Shift+R ã¾ãŸã¯ Cmd+Shift+Rï¼‰');
        } else {
          console.log(`âœ… ${projects.length}ä»¶ã®ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèªã—ã¾ã—ãŸï¼ˆæ­£å¸¸ï¼‰`);
        }
      } catch (error) {
        console.error('âŒ ãƒ‡ãƒ¼ã‚¿ç¢ºèªã‚¨ãƒ©ãƒ¼:', error);
        // ã‚¨ãƒ©ãƒ¼ã§ã‚‚ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¡¨ç¤ºã¯ç¶šè¡Œ
      }
    }

    // ==========================================
    // Phase 1: æœŸé–“æ¯”è¼ƒãƒ‡ãƒ¼ã‚¿é›†è¨ˆãƒ­ã‚¸ãƒƒã‚¯
    // ==========================================
    
    /**
     * ç›´è¿‘3ãƒµæœˆã®æœŸé–“ã‚’å–å¾—ï¼ˆå‰æœˆç¢ºå®šãƒ­ãƒ¼ãƒªãƒ³ã‚°ï¼‰
     * ä¾‹ï¼šä»Šæ—¥ãŒ2025/11/9 â†’ å‰æœˆ=10æœˆ â†’ ç›´è¿‘3ãƒ¶æœˆ = 8æœˆ, 9æœˆ, 10æœˆ
     * è¨ˆç®—æ–¹æ³•: ç¾åœ¨æœˆã‹ã‚‰1ãƒ¶æœˆã€2ãƒ¶æœˆã€3ãƒ¶æœˆå‰
     * 
     * æ³¨æ„: toISOString()ã¯UTCã‚’ä½¿ã†ãŸã‚ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã§ãšã‚Œã‚‹å•é¡ŒãŒã‚ã‚Šã€
     * ãƒ­ãƒ¼ã‚«ãƒ«ã®å¹´æœˆã‚’ç›´æ¥ä½¿ç”¨ã™ã‚‹
     */
    function getRecentThreeMonths() {
      const today = new Date();
      const currentYear = today.getFullYear();
      const currentMonth = today.getMonth(); // 0-based (0=Jan, 10=Nov)
      
      console.log('[getRecentThreeMonths] ======== START ========');
      console.log('[getRecentThreeMonths] Today:', today.toString());
      console.log('[getRecentThreeMonths] Current year:', currentYear);
      console.log('[getRecentThreeMonths] Current month (0-based):', currentMonth, '(November=10)');
      
      const months = [];
      // ç›´è¿‘3ãƒ¶æœˆ = ç¾åœ¨æœˆã‹ã‚‰3ãƒ¶æœˆå‰ã€2ãƒ¶æœˆå‰ã€1ãƒ¶æœˆå‰
      for (let i = 3; i >= 1; i--) {
        const d = new Date(currentYear, currentMonth - i, 1);
        // UTCå¤‰æ›ã‚’é¿ã‘ã¦ã€ãƒ­ãƒ¼ã‚«ãƒ«ã®å¹´æœˆã‚’ç›´æ¥ä½¿ç”¨
        const year = d.getFullYear();
        const month = String(d.getMonth() + 1).padStart(2, '0'); // 1-based, 0åŸ‹ã‚
        const monthStr = `${year}-${month}`;
        months.push(monthStr);
        console.log(`[getRecentThreeMonths]   ${i}ãƒ¶æœˆå‰: year=${year}, month=${d.getMonth() + 1} â†’ ${monthStr}`);
      }
      
      console.log('[getRecentThreeMonths] Result:', months);
      console.log('[getRecentThreeMonths] Expected: [2025-08, 2025-09, 2025-10]');
      console.log('[getRecentThreeMonths] ======== END ========');
      return months;
    }
    
    /**
     * æ˜¨å¹´åŒæ™‚æœŸã®3ãƒµæœˆã‚’å–å¾—
     */
    function getYoYThreeMonths() {
      const recentMonths = getRecentThreeMonths();
      return recentMonths.map(month => {
        const [year, m] = month.split('-');
        return `${parseInt(year) - 1}-${m}`;
      });
    }
    
    /**
     * ç›´è¿‘6ãƒµæœˆã®æœŸé–“ã‚’å–å¾—ï¼ˆã‚¹ãƒ‘ãƒ¼ã‚¯ãƒ©ã‚¤ãƒ³ç”¨ï¼‰
     */
    function getRecentSixMonths() {
      const today = new Date();
      const currentYear = today.getFullYear();
      const currentMonth = today.getMonth();

      const months = [];
      for (let i = 6; i >= 1; i--) {
        const d = new Date(currentYear, currentMonth - i, 1);
        // UTCå¤‰æ›ã‚’é¿ã‘ã¦ã€ãƒ­ãƒ¼ã‚«ãƒ«ã®å¹´æœˆã‚’ç›´æ¥ä½¿ç”¨
        const year = d.getFullYear();
        const month = String(d.getMonth() + 1).padStart(2, '0');
        months.push(`${year}-${month}`);
      }
      return months;
    }

    /**
     * ç›´è¿‘12ãƒµæœˆã®æœŸé–“ã‚’å–å¾—
     */
    function getRecentTwelveMonths() {
      const today = new Date();
      const currentYear = today.getFullYear();
      const currentMonth = today.getMonth();

      const months = [];
      for (let i = 12; i >= 1; i--) {
        const d = new Date(currentYear, currentMonth - i, 1);
        const year = d.getFullYear();
        const month = String(d.getMonth() + 1).padStart(2, '0');
        months.push(`${year}-${month}`);
      }
      return months;
    }

    /**
     * æ˜¨å¹´åŒæ™‚æœŸã®12ãƒµæœˆã‚’å–å¾—
     */
    function getYoYTwelveMonths() {
      return getRecentTwelveMonths().map(month => {
        const [year, m] = month.split('-');
        return `${parseInt(year) - 1}-${m}`;
      });
    }
    
    /**
     * ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’æœˆåˆ¥ã«é›†è¨ˆ
     * 
     * config.js ã® AGGREGATION_CONFIG ã‹ã‚‰é™¤å¤–ãƒ«ãƒ¼ãƒ«ã¨ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’èª­ã¿è¾¼ã¿
     */
    function aggregateByMonth(projects, fieldName) {
      const monthlyData = {};
      
      // config.js ã‹ã‚‰è¨­å®šã‚’å–å¾—
      const EXACT_EXCLUDE_VALUES = window.AGGREGATION_CONFIG?.EXACT_EXCLUDE_VALUES || [];
      const SPECIALTY_KEYWORDS = window.AGGREGATION_CONFIG?.SPECIALTY_KEYWORDS || [];
      
      projects.forEach(project => {
        // å®Ÿæ–½å¹´æœˆã‚’ãƒ‘ãƒ¼ã‚¹
        let month = null;
        if (project.implementationDate) {
          const dateStr = project.implementationDate.trim();
          
          // ãƒ‘ã‚¿ãƒ¼ãƒ³1: yyyy/mm ã¾ãŸã¯ yyyy/mm/dd å½¢å¼
          if (/^\d{4}\/\d{1,2}/.test(dateStr)) {
            const parts = dateStr.split('/');
            const year = parts[0];
            const m = parts[1].padStart(2, '0');
            month = `${year}-${m}`;
          }
          // ãƒ‘ã‚¿ãƒ¼ãƒ³2: yyyy-mm ã¾ãŸã¯ yyyy-mm-dd å½¢å¼
          else if (/^\d{4}-\d{1,2}/.test(dateStr)) {
            const parts = dateStr.split('-');
            const year = parts[0];
            const m = parts[1].padStart(2, '0');
            month = `${year}-${m}`;
          }
          // ãƒ‘ã‚¿ãƒ¼ãƒ³3: yyyy/mï¼ˆã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã®ã¿ã€æ—¥ä»˜ãªã—ï¼‰
          else if (/^\d{4}\/\d{1,2}$/.test(dateStr)) {
            const parts = dateStr.split('/');
            const year = parts[0];
            const m = parts[1].padStart(2, '0');
            month = `${year}-${m}`;
          }
          // ãƒ‘ã‚¿ãƒ¼ãƒ³4: ãã®ä»–ã®å½¢å¼ï¼ˆDate()ã§ãƒ‘ãƒ¼ã‚¹è©¦è¡Œï¼‰
          else {
            const date = new Date(dateStr);
            if (!isNaN(date.getTime())) {
              month = date.toISOString().substring(0, 7);
            }
          }
        }
        
        if (!month) return; // æ—¥ä»˜ãŒä¸æ­£ãªå ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—
        
        let fieldValue = project[fieldName];
        if (!fieldValue || fieldValue.trim() === '') return; // ç©ºã®å€¤ã¯ã‚¹ã‚­ãƒƒãƒ—
        
        fieldValue = fieldValue.trim();
        
        // è¨ºç™‚ç§‘ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å ´åˆã¯ã€éè¨ºç™‚ç§‘ã®å€¤ã‚’é™¤å¤–
        if (fieldName === 'specialty') {
          // å®Œå…¨ä¸€è‡´ã§ã®é™¤å¤–ãƒã‚§ãƒƒã‚¯ï¼ˆã€ŒåŒ»å¸«ã€å˜ä½“ã¯é™¤å¤–ã€ã€Œå†…ç§‘åŒ»ã€ã¯è¨±å¯ï¼‰
          if (EXACT_EXCLUDE_VALUES.includes(fieldValue)) {
            console.log(`Excluding exact match: "${fieldValue}"`);
            return; // éè¨ºç™‚ç§‘ã®å€¤ã¯ã‚¹ã‚­ãƒƒãƒ—
          }
          
          // è¨ºç™‚ç§‘ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯ï¼ˆéƒ¨åˆ†ä¸€è‡´ï¼‰
          const hasSpecialtyKeyword = SPECIALTY_KEYWORDS.some(keyword => 
            fieldValue.includes(keyword)
          );
          
          // è¨ºç™‚ç§‘ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã¦ã„ãªã„å ´åˆã‚‚ã‚¹ã‚­ãƒƒãƒ—
          if (!hasSpecialtyKeyword) {
            console.log(`Skipping non-specialty value: "${fieldValue}"`);
            return;
          }
          
          console.log(`Including specialty: "${fieldValue}"`);
        }
        
        if (!monthlyData[month]) {
          monthlyData[month] = {};
        }
        if (!monthlyData[month][fieldValue]) {
          monthlyData[month][fieldValue] = 0;
        }
        monthlyData[month][fieldValue]++;
      });
      
      return monthlyData;
    }
    
    /**
     * æœŸé–“æ¯”è¼ƒãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ
     */
    function generateComparisonData(projects, fieldName, options = {}) {
      console.log(`generateComparisonData for ${fieldName}:`, {
        totalProjects: projects.length,
        sampleDates: projects.slice(0, 5).map(p => p.implementationDate)
      });

      const monthlyData = aggregateByMonth(projects, fieldName);
      console.log(`Monthly data for ${fieldName}:`, Object.keys(monthlyData).sort());

      const {
        recentMonths = getRecentThreeMonths(),
        yoyMonths = getYoYThreeMonths(),
        sparklineMonths = getRecentSixMonths(),
        filterFn
      } = options;

      console.log(`Periods:`, { recentMonths, yoyMonths });

      // ç›´è¿‘3ãƒµæœˆã®é›†è¨ˆ
      const currData = {};
      recentMonths.forEach(month => {
        if (monthlyData[month]) {
          console.log(`  ${month} data:`, monthlyData[month]);
          Object.entries(monthlyData[month]).forEach(([key, count]) => {
            currData[key] = (currData[key] || 0) + count;
          });
        }
      });
      
      console.log(`Current period (${fieldName}) aggregated data:`, currData);
      
      // æ˜¨å¹´åŒæ™‚æœŸã®é›†è¨ˆ
      const prevData = {};
      yoyMonths.forEach(month => {
        if (monthlyData[month]) {
          console.log(`  ${month} data (YoY):`, monthlyData[month]);
          Object.entries(monthlyData[month]).forEach(([key, count]) => {
            prevData[key] = (prevData[key] || 0) + count;
          });
        }
      });
      
      console.log(`Previous period (${fieldName}) aggregated data:`, prevData);
      
      // ç›´è¿‘6ãƒµæœˆã®æœˆåˆ¥æ¨ç§»ï¼ˆã‚¹ãƒ‘ãƒ¼ã‚¯ãƒ©ã‚¤ãƒ³ç”¨ï¼‰
      const sparklineData = {};
      sparklineMonths.forEach(month => {
        if (monthlyData[month]) {
          Object.entries(monthlyData[month]).forEach(([key, count]) => {
            if (!sparklineData[key]) sparklineData[key] = [];
            sparklineData[key].push(count);
          });
        }
      });

      // æ¯”è¼ƒãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ
      const allKeys = new Set([...Object.keys(currData), ...Object.keys(prevData)]);
      const comparison = [];

      const currTotal = Object.values(currData).reduce((sum, v) => sum + v, 0);
      const prevTotal = Object.values(prevData).reduce((sum, v) => sum + v, 0);

      allKeys.forEach(key => {
        const curr = currData[key] || 0;
        const prev = prevData[key] || 0;
        const delta = curr - prev;
        const yoyPercent = prev > 0 ? ((delta / prev) * 100) : null;

        // å…¨ä½“ã«å¯¾ã™ã‚‹æ§‹æˆæ¯”
        const currShare = currTotal > 0 ? (curr / currTotal) * 100 : 0;
        const prevShare = prevTotal > 0 ? (prev / prevTotal) * 100 : 0;
        const shareDelta = currShare - prevShare;

        comparison.push({
          name: key,
          curr: curr,
          prev: prev,
          delta: delta,
          yoyPercent: yoyPercent,
          currShare: currShare,
          prevShare: prevShare,
          shareDelta: shareDelta,
          sparkline: sparklineData[key] || []
        });
      });
      
      console.log(`${fieldName} comparison before filtering (${comparison.length} items):`, comparison);
      
      // config.js ã‹ã‚‰é–¾å€¤è¨­å®šã‚’å–å¾—
      const thresholds = window.AGGREGATION_CONFIG?.FILTER_THRESHOLDS || {};
      const fieldThreshold = thresholds[fieldName] || thresholds.default || { prev: 5, curr: 8 };
      
      // ãƒã‚¤ã‚ºæŠ‘åˆ¶ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼šãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã”ã¨ã«åŸºæº–ã‚’èª¿æ•´
      const defaultFilter = (item) => {
        return item.prev >= fieldThreshold.prev || item.curr >= fieldThreshold.curr;
      };

      const effectiveFilter = filterFn || defaultFilter;
      const filtered = comparison.filter(effectiveFilter);
      
      console.log(`${fieldName} comparison after filtering (${filtered.length} items):`, filtered);
      
      // ä»¶æ•°é †ã§ã‚½ãƒ¼ãƒˆ
      filtered.sort((a, b) => b.curr - a.curr);
      
      const result = {
        data: filtered,
        recentPeriod: recentMonths,
        yoyPeriod: yoyMonths,
        currTotal,
        prevTotal
      };
      
      console.log(`${fieldName} final result:`, result);
      
      return result;
    }

    // çµ±è¨ˆæƒ…å ±ã‚’èª­ã¿è¾¼ã¿
    async function loadStatistics() {
      try {
        const stats = await api.getStats();
        const allProjects = await api.getAllProjects();

        // ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°
        console.log('ğŸ“Š Dashboard Statistics:');
        console.log('  - Total Projects (from stats):', stats.totalProjects);
        console.log('  - All Projects (direct):', allProjects.length);
        console.log('  - Total Recruits:', stats.totalRecruits);
        console.log('  - Average Recruits:', stats.averageRecruits);
        
        // ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã¯ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒãƒŠãƒ¼ã‚’è¡¨ç¤º
        if (stats.totalProjects === 0) {
          document.getElementById('importBanner').classList.remove('hidden');
        }

        // åŸºæœ¬çµ±è¨ˆ
        document.getElementById('totalProjects').textContent = stats.totalProjects;
        document.getElementById('totalRecruits').textContent = stats.totalRecruits.toLocaleString();
        document.getElementById('avgRecruits').textContent = stats.averageRecruits;

        // ä»Šæœˆã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ•°
        const thisMonth = new Date().toISOString().substring(0, 7);
        document.getElementById('thisMonthProjects').textContent = stats.monthlyTrend[thisMonth] || 0;

        // å¯¾è±¡è€…ã‚¿ã‚¤ãƒ—åˆ¥åˆ†å¸ƒ Top 5ï¼ˆéå»1å¹´æ¯”è¼ƒï¼‰
        const targetTypeComparison = generateComparisonData(allProjects, 'targetType', {
          recentMonths: getRecentTwelveMonths(),
          yoyMonths: getYoYTwelveMonths(),
          filterFn: (item) => item.prev >= 5 || item.curr >= 5
        });
        chartData.targetType = targetTypeComparison; // ãƒãƒ£ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
        renderTargetTypeChartWithComparison(targetTypeComparison);

        // ã€æ–°ãƒ­ã‚¸ãƒƒã‚¯ã€‘ç–¾æ‚£ã‚«ãƒ†ã‚´ãƒªãƒ¼ Top 5ï¼ˆæœŸé–“æ¯”è¼ƒï¼‰
        const diseaseComparison = generateComparisonData(allProjects, 'diseaseName');
        chartData.disease = diseaseComparison; // ãƒãƒ£ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
        renderDiseaseChartWithComparison(diseaseComparison);

        // ã€æ–°ãƒ­ã‚¸ãƒƒã‚¯ã€‘å°‚é–€ï¼ˆè¨ºç™‚ç§‘ï¼‰Top 5ï¼ˆæœŸé–“æ¯”è¼ƒï¼‰
        const specialtyComparison = generateComparisonData(allProjects, 'specialty');
        chartData.specialty = specialtyComparison; // ãƒãƒ£ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
        renderSpecialtyChartWithComparison(specialtyComparison);

        // ã€æ–°ãƒ­ã‚¸ãƒƒã‚¯ã€‘ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ Top 5ï¼ˆæœŸé–“æ¯”è¼ƒï¼‰
        const clientComparison = generateComparisonData(allProjects, 'client');
        chartData.client = clientComparison; // ãƒãƒ£ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
        renderClientChartWithComparison(clientComparison);

        // æœ€è¿‘ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
        renderRecentProjects(stats.recentProjects);

      } catch (error) {
        console.error('Failed to load statistics:', error);
        alert('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚');
      }
    }

    /**
     * å¯¾è±¡è€…ã‚¿ã‚¤ãƒ—åˆ¥åˆ†å¸ƒ Top 5ï¼ˆéå»1å¹´æ¯”è¼ƒç‰ˆï¼‰
     */
    function renderTargetTypeChartWithComparison(comparisonResult) {
      const container = document.getElementById('targetTypeChart');
      renderComparisonChart(container, comparisonResult, 'bg-blue-500', {
        currentLabel: 'éå»1å¹´',
        previousLabel: 'å‰å¹´åŒæœŸé–“'
      });
    }

    // ==========================================
    // Phase 2: æœŸé–“æ¯”è¼ƒUIï¼ˆäºŒé‡ãƒãƒ¼ + Î”ãƒãƒƒã‚¸ï¼‰
    // ==========================================
    
    /**
     * æœŸé–“æ¯”è¼ƒã‚«ãƒ¼ãƒ‰ã‚’ç”Ÿæˆï¼ˆå…±é€šé–¢æ•°ï¼‰
     */
    function renderComparisonChart(container, comparisonResult, colorClass = 'bg-blue-500', options = {}) {
      const { data, recentPeriod, yoyPeriod, currTotal, prevTotal } = comparisonResult;
      const {
        currentLabel = 'ç›´è¿‘3ãƒµæœˆ',
        previousLabel = 'æ˜¨å¹´åŒæ™‚æœŸ'
      } = options;
      
      console.log('renderComparisonChart called:', { 
        dataCount: data.length, 
        currTotal, 
        prevTotal,
        recentPeriod,
        yoyPeriod,
        sampleData: data.slice(0, 3)
      });
      
      container.innerHTML = '';
      
      // æœŸé–“è¡¨ç¤º
      const recentStart = recentPeriod.length > 0 ? recentPeriod[0] : '-';
      const recentEnd = recentPeriod.length > 0 ? recentPeriod[recentPeriod.length - 1] : '-';
      const yoyStart = yoyPeriod.length > 0 ? yoyPeriod[0] : '-';
      const yoyEnd = yoyPeriod.length > 0 ? yoyPeriod[yoyPeriod.length - 1] : '-';
      const periodInfo = `
        <div class="text-xs text-gray-500 mb-3 flex items-center justify-between">
          <span>${currentLabel}: ${recentStart}ã€œ${recentEnd} (${currTotal}ä»¶)</span>
          <span>${previousLabel}: ${yoyStart}ã€œ${yoyEnd} (${prevTotal}ä»¶)</span>
        </div>
      `;
      container.innerHTML = periodInfo;
      
      if (data.length === 0) {
        container.innerHTML += '<p class="text-gray-500 text-center py-4">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>';
        return;
      }
      
      // Top 5ã®ã¿è¡¨ç¤º
      data.slice(0, 5).forEach((item) => {
        const maxCount = Math.max(item.curr, item.prev);
        const currPercent = maxCount > 0 ? (item.curr / maxCount) * 100 : 0;
        const prevPercent = maxCount > 0 ? (item.prev / maxCount) * 100 : 0;
        
        // Î”ãƒãƒƒã‚¸ã®ç”Ÿæˆ
        let deltaBadge = '';
        if (item.prev === 0) {
          // æ–°è¦
          deltaBadge = `<span class="px-2 py-1 bg-purple-100 text-purple-700 text-xs font-semibold rounded">æ–°è¦</span>`;
        } else if (item.delta > 0) {
          deltaBadge = `<span class="px-2 py-1 bg-green-100 text-green-700 text-xs font-semibold rounded">+${item.delta}ä»¶ (+${item.yoyPercent.toFixed(1)}%)</span>`;
        } else if (item.delta < 0) {
          deltaBadge = `<span class="px-2 py-1 bg-red-100 text-red-700 text-xs font-semibold rounded">${item.delta}ä»¶ (${item.yoyPercent.toFixed(1)}%)</span>`;
        } else {
          deltaBadge = `<span class="px-2 py-1 bg-gray-100 text-gray-700 text-xs font-semibold rounded">å¤‰å‹•ãªã—</span>`;
        }
        
        // æ§‹æˆæ¯”å·®
        const shareText = item.shareDelta !== 0 
          ? `<span class="text-xs ${item.shareDelta > 0 ? 'text-green-600' : 'text-red-600'}">(${item.shareDelta > 0 ? '+' : ''}${item.shareDelta.toFixed(1)}pt)</span>`
          : '';
        
        container.innerHTML += `
          <div class="mb-4">
            <div class="flex justify-between items-center mb-2">
              <span class="text-sm font-medium text-gray-700">${item.name}</span>
              <div class="flex items-center space-x-2">
                ${deltaBadge}
                ${shareText}
              </div>
            </div>
            <div class="relative">
              <!-- ä¸‹åœ°ãƒãƒ¼ï¼ˆæ˜¨å¹´åŒæ™‚æœŸï¼‰ -->
              <div class="w-full bg-gray-200 rounded-full h-6 mb-1">
                <div class="${colorClass} opacity-30 h-6 rounded-full transition-all duration-500" style="width: ${prevPercent}%"></div>
              </div>
              <!-- æ¿ƒè‰²ãƒãƒ¼ï¼ˆç›´è¿‘3ãƒµæœˆï¼‰ -->
              <div class="w-full absolute top-0 left-0">
                <div class="${colorClass} h-6 rounded-full transition-all duration-500 flex items-center justify-end pr-2" style="width: ${currPercent}%">
                  <span class="text-white text-xs font-bold">${item.curr}ä»¶</span>
                </div>
              </div>
            </div>
            <div class="flex justify-between text-xs text-gray-500 mt-1">
              <span>æ˜¨å¹´: ${item.prev}ä»¶</span>
              <span>æ§‹æˆæ¯”: ${item.currShare.toFixed(1)}%</span>
            </div>
          </div>
        `;
      });
    }
    
    /**
     * ç–¾æ‚£ã‚«ãƒ†ã‚´ãƒªãƒ¼ Top 5ï¼ˆæœŸé–“æ¯”è¼ƒç‰ˆï¼‰
     */
    function renderDiseaseChartWithComparison(comparisonResult) {
      const container = document.getElementById('diseaseChart');
      renderComparisonChart(container, comparisonResult, 'bg-red-500');
    }
    
    /**
     * å°‚é–€ï¼ˆè¨ºç™‚ç§‘ï¼‰Top 5ï¼ˆæœŸé–“æ¯”è¼ƒç‰ˆï¼‰
     */
    function renderSpecialtyChartWithComparison(comparisonResult) {
      const container = document.getElementById('specialtyChart');
      renderComparisonChart(container, comparisonResult, 'bg-indigo-500');
    }
    
    /**
     * ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ Top 5ï¼ˆæœŸé–“æ¯”è¼ƒç‰ˆï¼‰
     */
    function renderClientChartWithComparison(comparisonResult) {
      const container = document.getElementById('clientChart');
      renderComparisonChart(container, comparisonResult, 'bg-yellow-500');
    }

    // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ Top 5
    function renderClientChart(clients) {
      const container = document.getElementById('clientChart');
      container.innerHTML = '';

      const sorted = Object.entries(clients)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 5);

      if (sorted.length === 0) {
        container.innerHTML = '<p class="text-gray-500 text-center py-4">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>';
        return;
      }

      const maxCount = sorted[0][1];
      const colors = ['bg-yellow-500', 'bg-orange-500', 'bg-red-500', 'bg-pink-500', 'bg-purple-500'];

      sorted.forEach(([client, count], index) => {
        const percentage = (count / maxCount) * 100;

        container.innerHTML += `
          <div>
            <div class="flex justify-between mb-1">
              <span class="text-sm font-medium text-gray-700 truncate" title="${client}">${truncate(client, 30)}</span>
              <span class="text-sm text-gray-600">${count}ä»¶</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-2">
              <div class="${colors[index]} h-2 rounded-full transition-all duration-500" style="width: ${percentage}%"></div>
            </div>
          </div>
        `;
      });
    }

    // ç–¾æ‚£ã‚«ãƒ†ã‚´ãƒªãƒ¼ Top 5
    function renderDiseaseChart(diseases) {
      const container = document.getElementById('diseaseChart');
      container.innerHTML = '';

      const sorted = Object.entries(diseases)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 5);

      if (sorted.length === 0) {
        container.innerHTML = '<p class="text-gray-500 text-center py-4">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>';
        return;
      }

      const maxCount = sorted[0][1];
      const colors = ['bg-red-500', 'bg-orange-500', 'bg-yellow-500', 'bg-green-500', 'bg-blue-500'];

      sorted.forEach(([disease, count], index) => {
        const percentage = (count / maxCount) * 100;

        container.innerHTML += `
          <div>
            <div class="flex justify-between mb-1">
              <span class="text-sm font-medium text-gray-700 truncate" title="${disease}">${truncate(disease, 30)}</span>
              <span class="text-sm text-gray-600">${count}ä»¶</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-2">
              <div class="${colors[index]} h-2 rounded-full transition-all duration-500" style="width: ${percentage}%"></div>
            </div>
          </div>
        `;
      });
    }

    // å°‚é–€ï¼ˆè¨ºç™‚ç§‘ï¼‰Top 5
    function renderSpecialtyChart(specialties) {
      const container = document.getElementById('specialtyChart');
      container.innerHTML = '';

      const sorted = Object.entries(specialties)
        .filter(([specialty]) => specialty) // ç©ºæ–‡å­—ã‚’é™¤å¤–
        .sort((a, b) => b[1] - a[1])
        .slice(0, 5);

      if (sorted.length === 0) {
        container.innerHTML = '<p class="text-gray-500 text-center py-4">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>';
        return;
      }

      const maxCount = sorted[0][1];
      const colors = ['bg-indigo-500', 'bg-blue-500', 'bg-cyan-500', 'bg-teal-500', 'bg-green-500'];

      sorted.forEach(([specialty, count], index) => {
        const percentage = (count / maxCount) * 100;

        container.innerHTML += `
          <div>
            <div class="flex justify-between mb-1">
              <span class="text-sm font-medium text-gray-700">${specialty}</span>
              <span class="text-sm text-gray-600">${count}ä»¶</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-2">
              <div class="${colors[index]} h-2 rounded-full transition-all duration-500" style="width: ${percentage}%"></div>
            </div>
          </div>
        `;
      });
    }

    // æœ€è¿‘ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§
    function renderRecentProjects(projects) {
      const tbody = document.getElementById('recentProjectsTable');
      tbody.innerHTML = '';

      if (projects.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="8" class="px-4 py-8 text-center text-gray-500">
              æ¡ˆä»¶ãŒã¾ã ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“
            </td>
          </tr>
        `;
        return;
      }

      projects.forEach(project => {
        const date = project.createdAt 
          ? new Date(project.createdAt).toLocaleDateString('ja-JP')
          : '-';
        
        tbody.innerHTML += `
          <tr class="hover:bg-gray-50 transition">
            <td class="px-4 py-3 text-sm text-gray-900">${truncate(project.diseaseName, 30)}</td>
            <td class="px-4 py-3 text-sm text-gray-600">${project.diseaseAbbr || '-'}</td>
            <td class="px-4 py-3 text-sm">
              <span class="px-2 py-1 rounded-full text-xs font-semibold ${getTargetTypeBadgeClass(project.targetType)}">
                ${project.targetType}
              </span>
            </td>
            <td class="px-4 py-3 text-sm text-gray-600">${project.specialty || '-'}</td>
            <td class="px-4 py-3 text-sm font-medium ${project.inquiryOnly === 'TRUE' || project.inquiryOnly === true ? 'text-red-600' : 'text-green-600'}">
              ${project.inquiryOnly === 'TRUE' || project.inquiryOnly === true ? 'å•åˆã›: ' : ''}${project.recruitCount}å
            </td>
            <td class="px-4 py-3 text-sm text-gray-600">${truncate(project.client || '-', 20)}</td>
            <td class="px-4 py-3 text-sm text-gray-500">${date}</td>
            <td class="px-4 py-3 text-sm">
              <a href="projects.html?id=${project.id}" class="text-blue-600 hover:text-blue-800">
                <i class="fas fa-eye mr-1"></i>è©³ç´°
              </a>
            </td>
          </tr>
        `;
      });
    }

    // === ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ã¯å…±é€šutils.jsã‚’ä½¿ç”¨ ===
    const getTargetTypeBadgeClass = ProjectUtils.getTargetTypeBadgeClass;
    const truncate = ProjectUtils.truncate;

    // ==========================================
    // Phase 3: Chart.js ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒãƒ£ãƒ¼ãƒˆ
    // ==========================================
    
    // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã§ãƒãƒ£ãƒ¼ãƒˆã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä¿æŒ
    let chartInstances = {
      disease: null,
      specialty: null,
      targetType: null,
      client: null
    };
    
    // ãƒãƒ£ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«ä¿æŒï¼ˆãƒ‰ãƒªãƒ«ãƒ€ã‚¦ãƒ³ç”¨ï¼‰
    let chartData = {
      disease: null,
      specialty: null,
      targetType: null,
      client: null
    };
    
    /**
     * ãƒãƒ£ãƒ¼ãƒˆè¡¨ç¤ºã®åˆ‡ã‚Šæ›¿ãˆï¼ˆãƒãƒ¼ãƒãƒ£ãƒ¼ãƒˆ â‡” å††ã‚°ãƒ©ãƒ•ï¼‰
     */
    function toggleChartView(chartType) {
      const barChart = document.getElementById(`${chartType}Chart`);
      const canvasContainer = document.getElementById(`${chartType}ChartCanvas`);
      const toggleText = document.getElementById(`${chartType}ToggleText`);
      
      if (barChart.classList.contains('hidden')) {
        // å††ã‚°ãƒ©ãƒ•è¡¨ç¤ºä¸­ â†’ ãƒãƒ¼ãƒãƒ£ãƒ¼ãƒˆã«åˆ‡ã‚Šæ›¿ãˆ
        barChart.classList.remove('hidden');
        canvasContainer.classList.add('hidden');
        toggleText.textContent = 'å††ã‚°ãƒ©ãƒ•è¡¨ç¤º';
      } else {
        // ãƒãƒ¼ãƒãƒ£ãƒ¼ãƒˆè¡¨ç¤ºä¸­ â†’ å††ã‚°ãƒ©ãƒ•ã«åˆ‡ã‚Šæ›¿ãˆ
        barChart.classList.add('hidden');
        canvasContainer.classList.remove('hidden');
        toggleText.textContent = 'ãƒãƒ¼ãƒãƒ£ãƒ¼ãƒˆè¡¨ç¤º';
        
        // å††ã‚°ãƒ©ãƒ•ã‚’æç”»ï¼ˆãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹å ´åˆï¼‰
        if (chartData[chartType]) {
          renderPieChart(chartType, chartData[chartType]);
        }
      }
    }
    
    /**
     * Chart.js å††ã‚°ãƒ©ãƒ•ã‚’æç”»
     * 
     * @param {string} chartType - disease | specialty | targetType | client
     * @param {object} comparisonResult - generateComparisonData() ã®æˆ»ã‚Šå€¤
     */
    function renderPieChart(chartType, comparisonResult) {
      const canvasId = `${chartType}Canvas`;
      const ctx = document.getElementById(canvasId);
      
      if (!ctx) {
        console.error(`Canvas element not found: ${canvasId}`);
        return;
      }
      
      // æ—¢å­˜ã®ãƒãƒ£ãƒ¼ãƒˆã‚’ç ´æ£„
      if (chartInstances[chartType]) {
        chartInstances[chartType].destroy();
      }
      
      const { data } = comparisonResult;
      
      // Top 5 ã®ã¿è¡¨ç¤º
      const top5 = data.slice(0, 5);
      const labels = top5.map(item => item.name);
      const values = top5.map(item => item.curr);
      const prevValues = top5.map(item => item.prev);
      
      // ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆ
      const colorPalettes = {
        disease: [
          'rgba(239, 68, 68, 0.8)',   // red-500
          'rgba(249, 115, 22, 0.8)',  // orange-500
          'rgba(234, 179, 8, 0.8)',   // yellow-500
          'rgba(34, 197, 94, 0.8)',   // green-500
          'rgba(59, 130, 246, 0.8)'   // blue-500
        ],
        specialty: [
          'rgba(99, 102, 241, 0.8)',  // indigo-500
          'rgba(59, 130, 246, 0.8)',  // blue-500
          'rgba(6, 182, 212, 0.8)',   // cyan-500
          'rgba(20, 184, 166, 0.8)',  // teal-500
          'rgba(34, 197, 94, 0.8)'    // green-500
        ],
        targetType: [
          'rgba(59, 130, 246, 0.8)',  // blue-500
          'rgba(34, 197, 94, 0.8)',   // green-500
          'rgba(234, 179, 8, 0.8)',   // yellow-500
          'rgba(236, 72, 153, 0.8)',  // pink-500
          'rgba(99, 102, 241, 0.8)'   // indigo-500
        ],
        client: [
          'rgba(234, 179, 8, 0.8)',   // yellow-500
          'rgba(249, 115, 22, 0.8)',  // orange-500
          'rgba(239, 68, 68, 0.8)',   // red-500
          'rgba(236, 72, 153, 0.8)',  // pink-500
          'rgba(168, 85, 247, 0.8)'   // purple-500
        ]
      };
      
      const colors = colorPalettes[chartType] || colorPalettes.disease;
      
      // Chart.js è¨­å®š
      chartInstances[chartType] = new Chart(ctx, {
        type: 'pie',
        data: {
          labels: labels,
          datasets: [{
            label: 'ç›´è¿‘3ãƒµæœˆ',
            data: values,
            backgroundColor: colors,
            borderColor: colors.map(c => c.replace('0.8', '1')),
            borderWidth: 2
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                padding: 15,
                font: {
                  size: 12
                }
              }
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  const label = context.label || '';
                  const value = context.parsed;
                  const prevValue = prevValues[context.dataIndex];
                  const delta = value - prevValue;
                  const yoyPercent = prevValue > 0 ? ((delta / prevValue) * 100).toFixed(1) : 'æ–°è¦';
                  
                  const total = context.dataset.data.reduce((a, b) => a + b, 0);
                  const percentage = ((value / total) * 100).toFixed(1);
                  
                  return [
                    `${label}: ${value}ä»¶ (${percentage}%)`,
                    `æ˜¨å¹´: ${prevValue}ä»¶`,
                    `å¤‰åŒ–: ${delta > 0 ? '+' : ''}${delta}ä»¶ (${yoyPercent}${typeof yoyPercent === 'number' ? '%' : ''})`
                  ];
                }
              }
            }
          },
          onClick: (event, activeElements) => {
            if (activeElements.length > 0) {
              const index = activeElements[0].index;
              const selectedLabel = labels[index];
              
              // ãƒ‰ãƒªãƒ«ãƒ€ã‚¦ãƒ³: æ¡ˆä»¶æ¤œç´¢ãƒšãƒ¼ã‚¸ã¸é·ç§»ï¼ˆãƒ•ã‚£ãƒ«ã‚¿é©ç”¨ï¼‰
              const filterParam = encodeURIComponent(selectedLabel);
              let filterField = '';
              
              if (chartType === 'disease') filterField = 'diseaseName';
              else if (chartType === 'specialty') filterField = 'specialty';
              else if (chartType === 'targetType') filterField = 'targetType';
              else if (chartType === 'client') filterField = 'client';
              
              window.location.href = `projects.html?${filterField}=${filterParam}`;
            }
          }
        }
      });
    }

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å®Ÿè¡Œ
    window.addEventListener('DOMContentLoaded', initDashboard);
  </script>
</body>
</html>
