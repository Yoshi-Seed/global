<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå±¥æ­´ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  - ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
  <!-- Version: 2025-11-09-v2 æœŸé–“è¨ˆç®—ä¿®æ­£ç‰ˆ -->
  <link rel="icon" type="image/png" href="SP_logo_shape%20only.png">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-50">
  <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
  <nav class="bg-white shadow-md sticky top-0 z-40">
    <div class="container mx-auto px-2 sm:px-4 py-2 sm:py-3">
      <div class="flex items-center justify-between flex-wrap gap-2">
        <!-- ãƒ­ã‚´éƒ¨åˆ† -->
        <div class="flex items-center space-x-2 sm:space-x-4">
          <img src="Seed_Planning_Logo_Original.jpg" alt="SEED PLANNING" class="h-8 sm:h-10">
          <h1 class="hidden md:block text-lg font-bold text-gray-800">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå±¥æ­´ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h1>
        </div>
        
        <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
        <div class="flex flex-wrap gap-1 sm:gap-2">
          <a href="index.html" class="px-2 sm:px-4 py-2 text-xs sm:text-sm text-white rounded-lg transition flex items-center" style="background-color: #1F7A85;">
            <i class="fas fa-home sm:mr-2"></i><span class="hidden sm:inline ml-1">ãƒ›ãƒ¼ãƒ </span>
          </a>
          <a href="register.html" class="px-2 sm:px-4 py-2 text-xs sm:text-sm bg-green-500 text-white rounded-lg hover:bg-green-600 transition flex items-center">
            <i class="fas fa-plus sm:mr-2"></i><span class="hidden sm:inline ml-1">æ–°è¦ç™»éŒ²</span>
          </a>
          <a href="projects.html" class="px-2 sm:px-4 py-2 text-xs sm:text-sm bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition flex items-center">
            <i class="fas fa-search sm:mr-2"></i><span class="hidden sm:inline ml-1">æ¡ˆä»¶æ¤œç´¢</span>
          </a>
          <a href="links.html" class="px-2 sm:px-4 py-2 text-xs sm:text-sm bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition flex items-center">
            <i class="fas fa-link sm:mr-2"></i><span class="hidden sm:inline ml-1">ãƒªãƒ³ã‚¯é›†</span>
          </a>
          <a href="https://seedplanning.monday.com/boards/2723929863" target="_blank" rel="noopener noreferrer" class="px-2 sm:px-4 py-2 text-xs sm:text-sm bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition flex items-center">
            <img src="monday.png" alt="Monday" class="h-3 w-3 sm:h-4 sm:w-4 sm:mr-2"><span class="hidden sm:inline ml-1">Monday</span>
          </a>
          <a href="https://seedplanning-my.sharepoint.com/:x:/g/personal/h_yamamoto_seedplanning_co_jp/ERX-ZGMkMaZDgLytPc33TJUB8aUZpPKRq7A9XvqPdykK0g?wdOrigin=TEAMS-MAGLEV.p2p_ns.rwc&wdExp=TEAMS-TREATMENT&wdhostclicktime=1744073789628&web=1" target="_blank" rel="noopener noreferrer" class="px-2 sm:px-4 py-2 text-xs sm:text-sm bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition flex items-center">
            <img src="Everyday-1.png" alt="Everyday" class="h-3 w-3 sm:h-4 sm:w-4 sm:mr-2"><span class="hidden sm:inline ml-1">Everyday</span>
          </a>
          <a href="https://db.seedplanning.co.jp/project/management" target="_blank" rel="noopener noreferrer" class="px-2 sm:px-4 py-2 text-xs sm:text-sm bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition flex items-center">
            <img src="SP_logo_shape_only.png" alt="ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†" class="h-3 w-3 sm:h-4 sm:w-4 sm:mr-2"><span class="hidden sm:inline ml-1">PJç®¡ç†</span>
          </a>
        </div>
      </div>
    </div>
  </nav>

  <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
  <div class="container mx-auto px-4 py-8">
    
    <!-- ãƒ‡ãƒãƒƒã‚°æƒ…å ±ãƒãƒŠãƒ¼ï¼ˆé–‹ç™ºç¢ºèªç”¨ï¼‰ -->
    <div id="debugBanner" class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-4">
      <div class="flex items-center">
        <i class="fas fa-info-circle text-yellow-400 mr-3"></i>
        <div class="text-sm">
          <strong>ãƒãƒ¼ã‚¸ãƒ§ãƒ³:</strong> 2025-11-09-v2 (æœŸé–“è¨ˆç®—ä¿®æ­£ç‰ˆ) | 
          <strong>æœŸé–“ç¢ºèª:</strong> <span id="debugPeriod" class="font-mono text-blue-600">èª­ã¿è¾¼ã¿ä¸­...</span>
        </div>
      </div>
    </div>
    
    <!-- ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆä¿ƒé€²ãƒãƒŠãƒ¼ -->
    <div id="importBanner" class="hidden bg-gradient-to-r from-purple-500 to-blue-600 text-white rounded-lg shadow-lg p-6 mb-8">
      <div class="flex items-center justify-between">
        <div class="flex items-center space-x-4">
          <i class="fas fa-database text-4xl"></i>
          <div>
            <h3 class="text-xl font-bold">ãƒ‡ãƒ¼ã‚¿ãŒã¾ã ã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“</h3>
            <p class="text-sm opacity-90">Seed Planningã®å®Ÿç¸¾ãƒ‡ãƒ¼ã‚¿ï¼ˆ113ä»¶ï¼‰ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ã€ã™ãã«ä½¿ã„å§‹ã‚ã¾ã—ã‚‡ã†ï¼</p>
          </div>
        </div>
        <a href="import.html" class="bg-white text-purple-600 px-6 py-3 rounded-lg font-semibold hover:bg-gray-100 transition">
          <i class="fas fa-file-import mr-2"></i>ä»Šã™ãã‚¤ãƒ³ãƒãƒ¼ãƒˆ
        </a>
      </div>
    </div>

    <!-- çµ±è¨ˆã‚«ãƒ¼ãƒ‰ -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
      <!-- ç·æ¡ˆä»¶æ•° -->
      <div class="rounded-lg shadow-md p-6" style="background: linear-gradient(135deg, #E8F0F1 0%, #d5e5e7 100%);">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-500 text-sm">ç·æ¡ˆä»¶æ•°</p>
            <p id="totalProjects" class="text-3xl font-bold text-blue-600">0</p>
          </div>
          <div class="bg-blue-100 rounded-full p-3">
            <i class="fas fa-folder-open text-blue-600 text-2xl"></i>
          </div>
        </div>
      </div>

      <!-- ç·ãƒªã‚¯ãƒ«ãƒ¼ãƒˆäººæ•° -->
      <div class="rounded-lg shadow-md p-6" style="background: linear-gradient(135deg, #E8F0F1 0%, #d5e5e7 100%);">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-500 text-sm">ç·ãƒªã‚¯ãƒ«ãƒ¼ãƒˆäººæ•°</p>
            <p id="totalRecruits" class="text-3xl font-bold text-green-600">0</p>
          </div>
          <div class="bg-green-100 rounded-full p-3">
            <i class="fas fa-users text-green-600 text-2xl"></i>
          </div>
        </div>
      </div>

      <!-- å¹³å‡ãƒªã‚¯ãƒ«ãƒ¼ãƒˆäººæ•° -->
      <div class="rounded-lg shadow-md p-6" style="background: linear-gradient(135deg, #E8F0F1 0%, #d5e5e7 100%);">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-500 text-sm">å¹³å‡ãƒªã‚¯ãƒ«ãƒ¼ãƒˆäººæ•°</p>
            <p id="avgRecruits" class="text-3xl font-bold text-purple-600">0</p>
          </div>
          <div class="bg-purple-100 rounded-full p-3">
            <i class="fas fa-chart-line text-purple-600 text-2xl"></i>
          </div>
        </div>
      </div>

      <!-- ä»Šæœˆã®æ–°è¦æ¡ˆä»¶ -->
      <div class="rounded-lg shadow-md p-6" style="background: linear-gradient(135deg, #E8F0F1 0%, #d5e5e7 100%);">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-500 text-sm">ä»Šæœˆã®æ–°è¦</p>
            <p id="thisMonthProjects" class="text-3xl font-bold text-orange-600">0</p>
          </div>
          <div class="bg-orange-100 rounded-full p-3">
            <i class="fas fa-calendar-plus text-orange-600 text-2xl"></i>
          </div>
        </div>
      </div>
    </div>

    <!-- æœ€è¿‘ã®æ¡ˆä»¶ -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-8">
      <h2 class="text-xl font-bold mb-4 flex items-center">
        <i class="fas fa-clock mr-2 text-purple-600"></i>
        æœ€è¿‘ã®æ¡ˆä»¶ï¼ˆ5ä»¶ï¼‰
      </h2>
      <div class="overflow-x-auto">
        <table class="min-w-full">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">ç–¾æ‚£å</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">ç–¾æ‚£ç•¥èª</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">å¯¾è±¡è€…</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">å°‚é–€</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">å®Ÿç¸¾æ•°</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">ç™»éŒ²æ—¥</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</th>
            </tr>
          </thead>
          <tbody id="recentProjectsTable" class="bg-white divide-y divide-gray-200">
            <!-- å‹•çš„ã«ç”Ÿæˆ -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- 2ã‚«ãƒ©ãƒ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
      
      <!-- ç–¾æ‚£ã‚«ãƒ†ã‚´ãƒªãƒ¼ Top 5 -->
      <div class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-xl font-bold mb-4 flex items-center">
          <i class="fas fa-heartbeat mr-2 text-red-600"></i>
          ç–¾æ‚£ã‚«ãƒ†ã‚´ãƒªãƒ¼ Top 5
        </h2>
        <div id="diseaseChart" class="space-y-3">
          <!-- å‹•çš„ã«ç”Ÿæˆ -->
        </div>
      </div>

      <!-- å°‚é–€ï¼ˆè¨ºç™‚ç§‘ï¼‰Top 5 -->
      <div class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-xl font-bold mb-4 flex items-center">
          <i class="fas fa-user-md mr-2 text-indigo-600"></i>
          å°‚é–€ï¼ˆè¨ºç™‚ç§‘ï¼‰Top 5
        </h2>
        <div id="specialtyChart" class="space-y-3">
          <!-- å‹•çš„ã«ç”Ÿæˆ -->
        </div>
      </div>
    </div>

    <!-- 2ã‚«ãƒ©ãƒ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
      
      <!-- å¯¾è±¡è€…ã‚¿ã‚¤ãƒ—åˆ¥åˆ†å¸ƒ Top 5 -->
      <div class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-xl font-bold mb-4 flex items-center">
          <i class="fas fa-chart-pie mr-2 text-blue-600"></i>
          å¯¾è±¡è€…ã‚¿ã‚¤ãƒ—åˆ¥åˆ†å¸ƒ Top 5
        </h2>
        <div id="targetTypeChart" class="space-y-3">
          <!-- å‹•çš„ã«ç”Ÿæˆ -->
        </div>
      </div>

      <!-- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ Top 5 -->
      <div class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-xl font-bold mb-4 flex items-center">
          <i class="fas fa-handshake mr-2 text-yellow-600"></i>
          ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ Top 5
        </h2>
        <div id="clientChart" class="space-y-3">
          <!-- å‹•çš„ã«ç”Ÿæˆ -->
        </div>
      </div>
    </div>

    <!-- ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="mt-8 flex justify-center space-x-4">
      <a href="import.html" class="bg-purple-500 text-white px-6 py-3 rounded-lg hover:bg-purple-600 transition flex items-center space-x-2">
        <i class="fas fa-chart-bar"></i>
        <span>è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆ</span>
      </a>
      <a href="register.html" class="bg-green-500 text-white px-6 py-3 rounded-lg hover:bg-green-600 transition flex items-center space-x-2">
        <i class="fas fa-plus-circle"></i>
        <span>æ–°è¦æ¡ˆä»¶ç™»éŒ²</span>
      </a>
      <a href="projects.html" class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition flex items-center space-x-2">
        <i class="fas fa-search"></i>
        <span>æ¡ˆä»¶æ¤œç´¢</span>
      </a>
    </div>
  </div>

  <!-- å…±é€šè¨­å®š -->
  <script src="js/config.js"></script>
  <script src="js/specialties.js"></script>
  <!-- API Client -->
  <script src="js/api.js"></script>
  <!-- Export helpers -->
  <script src="js/export.js"></script>

  <!-- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ­ã‚¸ãƒƒã‚¯ -->
  <script>
    // åˆæœŸåŒ–
    async function initDashboard() {
      // ãƒ‡ãƒ¼ã‚¿å­˜åœ¨ç¢ºèªï¼†è‡ªå‹•å–å¾—
      await ensureDataLoaded();
      await loadStatistics();
    }
    
    // ãƒ‡ãƒ¼ã‚¿ãŒå–å¾—ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªï¼ˆåˆå›èµ·å‹•æ™‚ã®è‡ªå‹•åŒæœŸï¼‰
    async function ensureDataLoaded() {
      try {
        const projects = await api.getAllProjects();
        if (projects.length === 0) {
          console.log('ãƒ‡ãƒ¼ã‚¿ãŒç©ºã§ã™ã€‚GitHubã‹ã‚‰å–å¾—ã—ã¦ã„ã¾ã™...');
          // å¼·åˆ¶ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥
          api.clearCache();
          await api.getAllProjects(true);
        } else {
          console.log(`${projects.length}ä»¶ã®ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèªã—ã¾ã—ãŸ`);
        }
      } catch (error) {
        console.error('ãƒ‡ãƒ¼ã‚¿ç¢ºèªã‚¨ãƒ©ãƒ¼:', error);
        // ã‚¨ãƒ©ãƒ¼ã§ã‚‚ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¡¨ç¤ºã¯ç¶šè¡Œ
      }
    }

    // ==========================================
    // Phase 1: æœŸé–“æ¯”è¼ƒãƒ‡ãƒ¼ã‚¿é›†è¨ˆãƒ­ã‚¸ãƒƒã‚¯
    // ==========================================
    
    /**
     * ç›´è¿‘3ãƒµæœˆã®æœŸé–“ã‚’å–å¾—ï¼ˆå‰æœˆç¢ºå®šãƒ­ãƒ¼ãƒªãƒ³ã‚°ï¼‰
     * ä¾‹ï¼šä»Šæ—¥ãŒ2025/11/9 â†’ å‰æœˆ=10æœˆ â†’ ç›´è¿‘3ãƒ¶æœˆ = 8æœˆ, 9æœˆ, 10æœˆ
     * è¨ˆç®—æ–¹æ³•: ç¾åœ¨æœˆã‹ã‚‰1ãƒ¶æœˆã€2ãƒ¶æœˆã€3ãƒ¶æœˆå‰
     * 
     * æ³¨æ„: toISOString()ã¯UTCã‚’ä½¿ã†ãŸã‚ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã§ãšã‚Œã‚‹å•é¡ŒãŒã‚ã‚Šã€
     * ãƒ­ãƒ¼ã‚«ãƒ«ã®å¹´æœˆã‚’ç›´æ¥ä½¿ç”¨ã™ã‚‹
     */
    function getRecentThreeMonths() {
      const today = new Date();
      const currentYear = today.getFullYear();
      const currentMonth = today.getMonth(); // 0-based (0=Jan, 10=Nov)
      
      console.log('[getRecentThreeMonths] ======== START ========');
      console.log('[getRecentThreeMonths] Today:', today.toString());
      console.log('[getRecentThreeMonths] Current year:', currentYear);
      console.log('[getRecentThreeMonths] Current month (0-based):', currentMonth, '(November=10)');
      
      const months = [];
      // ç›´è¿‘3ãƒ¶æœˆ = ç¾åœ¨æœˆã‹ã‚‰3ãƒ¶æœˆå‰ã€2ãƒ¶æœˆå‰ã€1ãƒ¶æœˆå‰
      for (let i = 3; i >= 1; i--) {
        const d = new Date(currentYear, currentMonth - i, 1);
        // UTCå¤‰æ›ã‚’é¿ã‘ã¦ã€ãƒ­ãƒ¼ã‚«ãƒ«ã®å¹´æœˆã‚’ç›´æ¥ä½¿ç”¨
        const year = d.getFullYear();
        const month = String(d.getMonth() + 1).padStart(2, '0'); // 1-based, 0åŸ‹ã‚
        const monthStr = `${year}-${month}`;
        months.push(monthStr);
        console.log(`[getRecentThreeMonths]   ${i}ãƒ¶æœˆå‰: year=${year}, month=${d.getMonth() + 1} â†’ ${monthStr}`);
      }
      
      console.log('[getRecentThreeMonths] Result:', months);
      console.log('[getRecentThreeMonths] Expected: [2025-08, 2025-09, 2025-10]');
      console.log('[getRecentThreeMonths] ======== END ========');
      return months;
    }
    
    /**
     * æ˜¨å¹´åŒæ™‚æœŸã®3ãƒµæœˆã‚’å–å¾—
     */
    function getYoYThreeMonths() {
      const recentMonths = getRecentThreeMonths();
      return recentMonths.map(month => {
        const [year, m] = month.split('-');
        return `${parseInt(year) - 1}-${m}`;
      });
    }
    
    /**
     * ç›´è¿‘6ãƒµæœˆã®æœŸé–“ã‚’å–å¾—ï¼ˆã‚¹ãƒ‘ãƒ¼ã‚¯ãƒ©ã‚¤ãƒ³ç”¨ï¼‰
     */
    function getRecentSixMonths() {
      const today = new Date();
      const currentYear = today.getFullYear();
      const currentMonth = today.getMonth();
      
      const months = [];
      for (let i = 6; i >= 1; i--) {
        const d = new Date(currentYear, currentMonth - i, 1);
        // UTCå¤‰æ›ã‚’é¿ã‘ã¦ã€ãƒ­ãƒ¼ã‚«ãƒ«ã®å¹´æœˆã‚’ç›´æ¥ä½¿ç”¨
        const year = d.getFullYear();
        const month = String(d.getMonth() + 1).padStart(2, '0');
        months.push(`${year}-${month}`);
      }
      return months;
    }
    
    /**
     * ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’æœˆåˆ¥ã«é›†è¨ˆ
     */
    function aggregateByMonth(projects, fieldName) {
      const monthlyData = {};
      
      // è¨ºç™‚ç§‘ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å®Œå…¨ä¸€è‡´é™¤å¤–ãƒªã‚¹ãƒˆï¼ˆå¯¾è±¡è€…ã‚¿ã‚¤ãƒ—ã‚„èª¿æŸ»æ‰‹æ³•ãªã©ï¼‰
      const EXACT_EXCLUDE_VALUES = [
        'åŒ»å¸«', 'æ‚£è€…', 'ä»‹è­·è€…', 'KOL', 'çœ‹è­·å¸«', 
        'å®šæ€§', 'å®šé‡', 'è–¬å‰¤å¸«', 'ãã®ä»–', 'å®¶æ—'
      ];
      
      // è¨ºç™‚ç§‘ã®éƒ¨åˆ†ä¸€è‡´ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆè¨ºç™‚ç§‘åã«å«ã¾ã‚Œã‚‹å…¸å‹çš„ãªã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼‰
      const SPECIALTY_KEYWORDS = [
        'å†…ç§‘', 'å¤–ç§‘', 'ç§‘åŒ»', 'åŒ»', 'å°‚é–€åŒ»', // ã€Œâ—‹â—‹ç§‘ã€ã€Œâ—‹â—‹åŒ»ã€ã‚’å«ã‚€ã‚‚ã®ã‚’è¨±å¯
        'è…«ç˜', 'å¾ªç’°å™¨', 'æ¶ˆåŒ–å™¨', 'å‘¼å¸å™¨', 'ç¥çµŒ', 'ç²¾ç¥', 
        'å°å…', 'ç”£å©¦äººç§‘', 'æ•´å½¢', 'çš®è†š', 'æ³Œå°¿å™¨', 'çœ¼ç§‘', 
        'è€³é¼»', 'éº»é…”', 'æ”¾å°„ç·š', 'æ•‘æ€¥', 'ç·åˆ', 'ãƒªã‚¦ãƒãƒ', 
        'è…è‡“', 'è¡€æ¶²', 'å†…åˆ†æ³Œ', 'ç³–å°¿ç—…', 'ä¹³è…º', 'å¿ƒè‡“', 
        'è„³ç¥çµŒ', 'ãƒªãƒãƒ“ãƒª', 'ç—…ç†', 'ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼', 'ä»£è¬',
        'è‚è‡“', 'ç”²çŠ¶è…º', 'è¨ºç™‚'
      ];
      
      projects.forEach(project => {
        // å®Ÿæ–½å¹´æœˆã‚’ãƒ‘ãƒ¼ã‚¹
        let month = null;
        if (project.implementationDate) {
          const dateStr = project.implementationDate.trim();
          
          // ãƒ‘ã‚¿ãƒ¼ãƒ³1: yyyy/mm ã¾ãŸã¯ yyyy/mm/dd å½¢å¼
          if (/^\d{4}\/\d{1,2}/.test(dateStr)) {
            const parts = dateStr.split('/');
            const year = parts[0];
            const m = parts[1].padStart(2, '0');
            month = `${year}-${m}`;
          }
          // ãƒ‘ã‚¿ãƒ¼ãƒ³2: yyyy-mm ã¾ãŸã¯ yyyy-mm-dd å½¢å¼
          else if (/^\d{4}-\d{1,2}/.test(dateStr)) {
            const parts = dateStr.split('-');
            const year = parts[0];
            const m = parts[1].padStart(2, '0');
            month = `${year}-${m}`;
          }
          // ãƒ‘ã‚¿ãƒ¼ãƒ³3: yyyy/mï¼ˆã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã®ã¿ã€æ—¥ä»˜ãªã—ï¼‰
          else if (/^\d{4}\/\d{1,2}$/.test(dateStr)) {
            const parts = dateStr.split('/');
            const year = parts[0];
            const m = parts[1].padStart(2, '0');
            month = `${year}-${m}`;
          }
          // ãƒ‘ã‚¿ãƒ¼ãƒ³4: ãã®ä»–ã®å½¢å¼ï¼ˆDate()ã§ãƒ‘ãƒ¼ã‚¹è©¦è¡Œï¼‰
          else {
            const date = new Date(dateStr);
            if (!isNaN(date.getTime())) {
              month = date.toISOString().substring(0, 7);
            }
          }
        }
        
        if (!month) return; // æ—¥ä»˜ãŒä¸æ­£ãªå ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—
        
        let fieldValue = project[fieldName];
        if (!fieldValue || fieldValue.trim() === '') return; // ç©ºã®å€¤ã¯ã‚¹ã‚­ãƒƒãƒ—
        
        fieldValue = fieldValue.trim();
        
        // è¨ºç™‚ç§‘ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å ´åˆã¯ã€éè¨ºç™‚ç§‘ã®å€¤ã‚’é™¤å¤–
        if (fieldName === 'specialty') {
          // å®Œå…¨ä¸€è‡´ã§ã®é™¤å¤–ãƒã‚§ãƒƒã‚¯ï¼ˆã€ŒåŒ»å¸«ã€å˜ä½“ã¯é™¤å¤–ã€ã€Œå†…ç§‘åŒ»ã€ã¯è¨±å¯ï¼‰
          if (EXACT_EXCLUDE_VALUES.includes(fieldValue)) {
            console.log(`Excluding exact match: "${fieldValue}"`);
            return; // éè¨ºç™‚ç§‘ã®å€¤ã¯ã‚¹ã‚­ãƒƒãƒ—
          }
          
          // è¨ºç™‚ç§‘ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯ï¼ˆéƒ¨åˆ†ä¸€è‡´ï¼‰
          const hasSpecialtyKeyword = SPECIALTY_KEYWORDS.some(keyword => 
            fieldValue.includes(keyword)
          );
          
          // è¨ºç™‚ç§‘ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã¦ã„ãªã„å ´åˆã‚‚ã‚¹ã‚­ãƒƒãƒ—
          if (!hasSpecialtyKeyword) {
            console.log(`Skipping non-specialty value: "${fieldValue}"`);
            return;
          }
          
          console.log(`Including specialty: "${fieldValue}"`);
        }
        
        if (!monthlyData[month]) {
          monthlyData[month] = {};
        }
        if (!monthlyData[month][fieldValue]) {
          monthlyData[month][fieldValue] = 0;
        }
        monthlyData[month][fieldValue]++;
      });
      
      return monthlyData;
    }
    
    /**
     * æœŸé–“æ¯”è¼ƒãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ
     */
    function generateComparisonData(projects, fieldName) {
      console.log(`generateComparisonData for ${fieldName}:`, {
        totalProjects: projects.length,
        sampleDates: projects.slice(0, 5).map(p => p.implementationDate)
      });
      
      const monthlyData = aggregateByMonth(projects, fieldName);
      console.log(`Monthly data for ${fieldName}:`, Object.keys(monthlyData).sort());
      
      const recentMonths = getRecentThreeMonths();
      const yoyMonths = getYoYThreeMonths();
      const sixMonths = getRecentSixMonths();
      
      console.log(`Periods:`, { recentMonths, yoyMonths });
      
      // ç›´è¿‘3ãƒµæœˆã®é›†è¨ˆ
      const currData = {};
      recentMonths.forEach(month => {
        if (monthlyData[month]) {
          console.log(`  ${month} data:`, monthlyData[month]);
          Object.entries(monthlyData[month]).forEach(([key, count]) => {
            currData[key] = (currData[key] || 0) + count;
          });
        }
      });
      
      console.log(`Current period (${fieldName}) aggregated data:`, currData);
      
      // æ˜¨å¹´åŒæ™‚æœŸã®é›†è¨ˆ
      const prevData = {};
      yoyMonths.forEach(month => {
        if (monthlyData[month]) {
          console.log(`  ${month} data (YoY):`, monthlyData[month]);
          Object.entries(monthlyData[month]).forEach(([key, count]) => {
            prevData[key] = (prevData[key] || 0) + count;
          });
        }
      });
      
      console.log(`Previous period (${fieldName}) aggregated data:`, prevData);
      
      // ç›´è¿‘6ãƒµæœˆã®æœˆåˆ¥æ¨ç§»ï¼ˆã‚¹ãƒ‘ãƒ¼ã‚¯ãƒ©ã‚¤ãƒ³ç”¨ï¼‰
      const sparklineData = {};
      sixMonths.forEach(month => {
        if (monthlyData[month]) {
          Object.entries(monthlyData[month]).forEach(([key, count]) => {
            if (!sparklineData[key]) sparklineData[key] = [];
            sparklineData[key].push(count);
          });
        }
      });
      
      // æ¯”è¼ƒãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ
      const allKeys = new Set([...Object.keys(currData), ...Object.keys(prevData)]);
      const comparison = [];
      
      allKeys.forEach(key => {
        const curr = currData[key] || 0;
        const prev = prevData[key] || 0;
        const delta = curr - prev;
        const yoyPercent = prev > 0 ? ((delta / prev) * 100) : null;
        
        // å…¨ä½“ã«å¯¾ã™ã‚‹æ§‹æˆæ¯”
        const currTotal = Object.values(currData).reduce((sum, v) => sum + v, 0);
        const prevTotal = Object.values(prevData).reduce((sum, v) => sum + v, 0);
        const currShare = currTotal > 0 ? (curr / currTotal) * 100 : 0;
        const prevShare = prevTotal > 0 ? (prev / prevTotal) * 100 : 0;
        const shareDelta = currShare - prevShare;
        
        comparison.push({
          name: key,
          curr: curr,
          prev: prev,
          delta: delta,
          yoyPercent: yoyPercent,
          currShare: currShare,
          prevShare: prevShare,
          shareDelta: shareDelta,
          sparkline: sparklineData[key] || []
        });
      });
      
      console.log(`${fieldName} comparison before filtering (${comparison.length} items):`, comparison);
      
      // ãƒã‚¤ã‚ºæŠ‘åˆ¶ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼šãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã”ã¨ã«åŸºæº–ã‚’èª¿æ•´
      const filtered = comparison.filter(item => {
        if (fieldName === 'specialty' || fieldName === 'diseaseName') {
          // è¨ºç™‚ç§‘ã¨ç–¾æ‚£ã‚«ãƒ†ã‚´ãƒªãƒ¼ã¯å°‘ãªãã¨ã‚‚1ä»¶ã‚ã‚Œã°OKï¼ˆãƒ‡ãƒ¼ã‚¿ãŒå°‘ãªã„ãŸã‚ï¼‰
          return item.prev >= 1 || item.curr >= 1;
        } else if (fieldName === 'client') {
          // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚‚ç·©ã‚ã®åŸºæº–
          return item.prev >= 2 || item.curr >= 3;
        } else {
          // ãã®ä»–ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯å³ã—ã„åŸºæº–ï¼šPrev<5 ã‹ã¤ Curr<8 ã¯é™¤å¤–
          return item.prev >= 5 || item.curr >= 8;
        }
      });
      
      console.log(`${fieldName} comparison after filtering (${filtered.length} items):`, filtered);
      
      // ä»¶æ•°é †ã§ã‚½ãƒ¼ãƒˆ
      filtered.sort((a, b) => b.curr - a.curr);
      
      const result = {
        data: filtered,
        recentPeriod: recentMonths,
        yoyPeriod: yoyMonths,
        currTotal: Object.values(currData).reduce((sum, v) => sum + v, 0),
        prevTotal: Object.values(prevData).reduce((sum, v) => sum + v, 0)
      };
      
      console.log(`${fieldName} final result:`, result);
      
      return result;
    }

    // çµ±è¨ˆæƒ…å ±ã‚’èª­ã¿è¾¼ã¿
    async function loadStatistics() {
      try {
        // æœŸé–“è¨ˆç®—ç¢ºèª
        const testPeriods = getRecentThreeMonths();
        console.log('ğŸ” [loadStatistics] è¨ˆç®—ã•ã‚ŒãŸæœŸé–“:', testPeriods);
        console.log('âœ… æœŸå¾…ã•ã‚Œã‚‹æœŸé–“: [2025-08, 2025-09, 2025-10]');
        
        // æœŸé–“ã®å¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯
        const expectedPeriods = ['2025-08', '2025-09', '2025-10'];
        const periodsMatch = JSON.stringify(testPeriods) === JSON.stringify(expectedPeriods);
        console.log(periodsMatch ? 'âœ… æœŸé–“ä¸€è‡´!' : 'âŒ æœŸé–“ãŒç•°ãªã‚Šã¾ã™!');
        
        // ãƒ‡ãƒãƒƒã‚°ãƒãƒŠãƒ¼ã«æœŸé–“ã‚’è¡¨ç¤º
        const debugElem = document.getElementById('debugPeriod');
        if (debugElem) {
          debugElem.textContent = `${testPeriods[0]}ã€œ${testPeriods[2]}`;
          // æœŸå¾…é€šã‚Šãªã‚‰ç·‘ã€ç•°ãªã‚‹ãªã‚‰èµ¤
          debugElem.className = periodsMatch 
            ? 'font-mono text-green-600 font-bold' 
            : 'font-mono text-red-600 font-bold';
        }
        
        const stats = await api.getStats();
        const allProjects = await api.getAllProjects();

        // ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã¯ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒãƒŠãƒ¼ã‚’è¡¨ç¤º
        if (stats.totalProjects === 0) {
          document.getElementById('importBanner').classList.remove('hidden');
        }

        // åŸºæœ¬çµ±è¨ˆ
        document.getElementById('totalProjects').textContent = stats.totalProjects;
        document.getElementById('totalRecruits').textContent = stats.totalRecruits.toLocaleString();
        document.getElementById('avgRecruits').textContent = stats.averageRecruits;

        // ä»Šæœˆã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ•°
        const thisMonth = new Date().toISOString().substring(0, 7);
        document.getElementById('thisMonthProjects').textContent = stats.monthlyTrend[thisMonth] || 0;

        // å¯¾è±¡è€…ã‚¿ã‚¤ãƒ—åˆ¥åˆ†å¸ƒï¼ˆæ—¢å­˜ãƒ­ã‚¸ãƒƒã‚¯ç¶­æŒï¼‰
        renderTargetTypeChart(stats.targetTypeDistribution);

        // ã€æ–°ãƒ­ã‚¸ãƒƒã‚¯ã€‘ç–¾æ‚£ã‚«ãƒ†ã‚´ãƒªãƒ¼ Top 5ï¼ˆæœŸé–“æ¯”è¼ƒï¼‰
        const diseaseComparison = generateComparisonData(allProjects, 'diseaseName');
        renderDiseaseChartWithComparison(diseaseComparison);

        // ã€æ–°ãƒ­ã‚¸ãƒƒã‚¯ã€‘å°‚é–€ï¼ˆè¨ºç™‚ç§‘ï¼‰Top 5ï¼ˆæœŸé–“æ¯”è¼ƒï¼‰
        const specialtyComparison = generateComparisonData(allProjects, 'specialty');
        renderSpecialtyChartWithComparison(specialtyComparison);

        // ã€æ–°ãƒ­ã‚¸ãƒƒã‚¯ã€‘ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ Top 5ï¼ˆæœŸé–“æ¯”è¼ƒï¼‰
        const clientComparison = generateComparisonData(allProjects, 'client');
        renderClientChartWithComparison(clientComparison);

        // æœ€è¿‘ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
        renderRecentProjects(stats.recentProjects);

      } catch (error) {
        console.error('Failed to load statistics:', error);
        alert('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚');
      }
    }

    // å¯¾è±¡è€…ã‚¿ã‚¤ãƒ—åˆ¥åˆ†å¸ƒã‚°ãƒ©ãƒ•ï¼ˆTop 5ï¼‰
    function renderTargetTypeChart(distribution) {
      const container = document.getElementById('targetTypeChart');
      container.innerHTML = '';

      const total = Object.values(distribution).reduce((sum, val) => sum + val, 0);
      
      if (total === 0) {
        container.innerHTML = '<p class="text-gray-500 text-center py-4">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>';
        return;
      }

      const colors = {
        'åŒ»å¸«': 'bg-blue-500',
        'æ‚£è€…': 'bg-green-500',
        'ä»‹è­·è€…': 'bg-yellow-500',
        'åŒ»å¸«ãƒ»æ‚£è€…': 'bg-purple-500',
        'KOL': 'bg-red-500',
        'çœ‹è­·å¸«': 'bg-pink-500',
        'è–¬å‰¤å¸«': 'bg-indigo-500'
      };

      // Top 5ã«çµã‚‹
      Object.entries(distribution).sort((a, b) => b[1] - a[1]).slice(0, 5).forEach(([type, count]) => {
        const percentage = ((count / total) * 100).toFixed(1);
        const colorClass = colors[type] || 'bg-gray-500';

        container.innerHTML += `
          <div>
            <div class="flex justify-between mb-1">
              <span class="text-sm font-medium text-gray-700">${type}</span>
              <span class="text-sm text-gray-600">${count}ä»¶ (${percentage}%)</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-2">
              <div class="${colorClass} h-2 rounded-full transition-all duration-500" style="width: ${percentage}%"></div>
            </div>
          </div>
        `;
      });
    }

    // ==========================================
    // Phase 2: æœŸé–“æ¯”è¼ƒUIï¼ˆäºŒé‡ãƒãƒ¼ + Î”ãƒãƒƒã‚¸ï¼‰
    // ==========================================
    
    /**
     * æœŸé–“æ¯”è¼ƒã‚«ãƒ¼ãƒ‰ã‚’ç”Ÿæˆï¼ˆå…±é€šé–¢æ•°ï¼‰
     */
    function renderComparisonChart(container, comparisonResult, colorClass = 'bg-blue-500') {
      const { data, recentPeriod, yoyPeriod, currTotal, prevTotal } = comparisonResult;
      
      console.log('renderComparisonChart called:', { 
        dataCount: data.length, 
        currTotal, 
        prevTotal,
        recentPeriod,
        yoyPeriod,
        sampleData: data.slice(0, 3)
      });
      
      container.innerHTML = '';
      
      // æœŸé–“è¡¨ç¤º
      const periodInfo = `
        <div class="text-xs text-gray-500 mb-3 flex items-center justify-between">
          <span>ç›´è¿‘3ãƒµæœˆ: ${recentPeriod[0]}ã€œ${recentPeriod[2]} (${currTotal}ä»¶)</span>
          <span>æ˜¨å¹´åŒæ™‚æœŸ: ${yoyPeriod[0]}ã€œ${yoyPeriod[2]} (${prevTotal}ä»¶)</span>
        </div>
      `;
      container.innerHTML = periodInfo;
      
      if (data.length === 0) {
        container.innerHTML += '<p class="text-gray-500 text-center py-4">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>';
        return;
      }
      
      // Top 5ã®ã¿è¡¨ç¤º
      data.slice(0, 5).forEach((item) => {
        const maxCount = Math.max(item.curr, item.prev);
        const currPercent = maxCount > 0 ? (item.curr / maxCount) * 100 : 0;
        const prevPercent = maxCount > 0 ? (item.prev / maxCount) * 100 : 0;
        
        // Î”ãƒãƒƒã‚¸ã®ç”Ÿæˆ
        let deltaBadge = '';
        if (item.prev === 0) {
          // æ–°è¦
          deltaBadge = `<span class="px-2 py-1 bg-purple-100 text-purple-700 text-xs font-semibold rounded">æ–°è¦</span>`;
        } else if (item.delta > 0) {
          deltaBadge = `<span class="px-2 py-1 bg-green-100 text-green-700 text-xs font-semibold rounded">+${item.delta}ä»¶ (+${item.yoyPercent.toFixed(1)}%)</span>`;
        } else if (item.delta < 0) {
          deltaBadge = `<span class="px-2 py-1 bg-red-100 text-red-700 text-xs font-semibold rounded">${item.delta}ä»¶ (${item.yoyPercent.toFixed(1)}%)</span>`;
        } else {
          deltaBadge = `<span class="px-2 py-1 bg-gray-100 text-gray-700 text-xs font-semibold rounded">å¤‰å‹•ãªã—</span>`;
        }
        
        // æ§‹æˆæ¯”å·®
        const shareText = item.shareDelta !== 0 
          ? `<span class="text-xs ${item.shareDelta > 0 ? 'text-green-600' : 'text-red-600'}">(${item.shareDelta > 0 ? '+' : ''}${item.shareDelta.toFixed(1)}pt)</span>`
          : '';
        
        container.innerHTML += `
          <div class="mb-4">
            <div class="flex justify-between items-center mb-2">
              <span class="text-sm font-medium text-gray-700">${item.name}</span>
              <div class="flex items-center space-x-2">
                ${deltaBadge}
                ${shareText}
              </div>
            </div>
            <div class="relative">
              <!-- ä¸‹åœ°ãƒãƒ¼ï¼ˆæ˜¨å¹´åŒæ™‚æœŸï¼‰ -->
              <div class="w-full bg-gray-200 rounded-full h-6 mb-1">
                <div class="${colorClass} opacity-30 h-6 rounded-full transition-all duration-500" style="width: ${prevPercent}%"></div>
              </div>
              <!-- æ¿ƒè‰²ãƒãƒ¼ï¼ˆç›´è¿‘3ãƒµæœˆï¼‰ -->
              <div class="w-full absolute top-0 left-0">
                <div class="${colorClass} h-6 rounded-full transition-all duration-500 flex items-center justify-end pr-2" style="width: ${currPercent}%">
                  <span class="text-white text-xs font-bold">${item.curr}ä»¶</span>
                </div>
              </div>
            </div>
            <div class="flex justify-between text-xs text-gray-500 mt-1">
              <span>æ˜¨å¹´: ${item.prev}ä»¶</span>
              <span>æ§‹æˆæ¯”: ${item.currShare.toFixed(1)}%</span>
            </div>
          </div>
        `;
      });
    }
    
    /**
     * ç–¾æ‚£ã‚«ãƒ†ã‚´ãƒªãƒ¼ Top 5ï¼ˆæœŸé–“æ¯”è¼ƒç‰ˆï¼‰
     */
    function renderDiseaseChartWithComparison(comparisonResult) {
      const container = document.getElementById('diseaseChart');
      renderComparisonChart(container, comparisonResult, 'bg-red-500');
    }
    
    /**
     * å°‚é–€ï¼ˆè¨ºç™‚ç§‘ï¼‰Top 5ï¼ˆæœŸé–“æ¯”è¼ƒç‰ˆï¼‰
     */
    function renderSpecialtyChartWithComparison(comparisonResult) {
      const container = document.getElementById('specialtyChart');
      renderComparisonChart(container, comparisonResult, 'bg-indigo-500');
    }
    
    /**
     * ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ Top 5ï¼ˆæœŸé–“æ¯”è¼ƒç‰ˆï¼‰
     */
    function renderClientChartWithComparison(comparisonResult) {
      const container = document.getElementById('clientChart');
      renderComparisonChart(container, comparisonResult, 'bg-yellow-500');
    }

    // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ Top 5
    function renderClientChart(clients) {
      const container = document.getElementById('clientChart');
      container.innerHTML = '';

      const sorted = Object.entries(clients)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 5);

      if (sorted.length === 0) {
        container.innerHTML = '<p class="text-gray-500 text-center py-4">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>';
        return;
      }

      const maxCount = sorted[0][1];
      const colors = ['bg-yellow-500', 'bg-orange-500', 'bg-red-500', 'bg-pink-500', 'bg-purple-500'];

      sorted.forEach(([client, count], index) => {
        const percentage = (count / maxCount) * 100;

        container.innerHTML += `
          <div>
            <div class="flex justify-between mb-1">
              <span class="text-sm font-medium text-gray-700 truncate" title="${client}">${truncate(client, 30)}</span>
              <span class="text-sm text-gray-600">${count}ä»¶</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-2">
              <div class="${colors[index]} h-2 rounded-full transition-all duration-500" style="width: ${percentage}%"></div>
            </div>
          </div>
        `;
      });
    }

    // ç–¾æ‚£ã‚«ãƒ†ã‚´ãƒªãƒ¼ Top 5
    function renderDiseaseChart(diseases) {
      const container = document.getElementById('diseaseChart');
      container.innerHTML = '';

      const sorted = Object.entries(diseases)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 5);

      if (sorted.length === 0) {
        container.innerHTML = '<p class="text-gray-500 text-center py-4">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>';
        return;
      }

      const maxCount = sorted[0][1];
      const colors = ['bg-red-500', 'bg-orange-500', 'bg-yellow-500', 'bg-green-500', 'bg-blue-500'];

      sorted.forEach(([disease, count], index) => {
        const percentage = (count / maxCount) * 100;

        container.innerHTML += `
          <div>
            <div class="flex justify-between mb-1">
              <span class="text-sm font-medium text-gray-700 truncate" title="${disease}">${truncate(disease, 30)}</span>
              <span class="text-sm text-gray-600">${count}ä»¶</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-2">
              <div class="${colors[index]} h-2 rounded-full transition-all duration-500" style="width: ${percentage}%"></div>
            </div>
          </div>
        `;
      });
    }

    // å°‚é–€ï¼ˆè¨ºç™‚ç§‘ï¼‰Top 5
    function renderSpecialtyChart(specialties) {
      const container = document.getElementById('specialtyChart');
      container.innerHTML = '';

      const sorted = Object.entries(specialties)
        .filter(([specialty]) => specialty) // ç©ºæ–‡å­—ã‚’é™¤å¤–
        .sort((a, b) => b[1] - a[1])
        .slice(0, 5);

      if (sorted.length === 0) {
        container.innerHTML = '<p class="text-gray-500 text-center py-4">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>';
        return;
      }

      const maxCount = sorted[0][1];
      const colors = ['bg-indigo-500', 'bg-blue-500', 'bg-cyan-500', 'bg-teal-500', 'bg-green-500'];

      sorted.forEach(([specialty, count], index) => {
        const percentage = (count / maxCount) * 100;

        container.innerHTML += `
          <div>
            <div class="flex justify-between mb-1">
              <span class="text-sm font-medium text-gray-700">${specialty}</span>
              <span class="text-sm text-gray-600">${count}ä»¶</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-2">
              <div class="${colors[index]} h-2 rounded-full transition-all duration-500" style="width: ${percentage}%"></div>
            </div>
          </div>
        `;
      });
    }

    // æœ€è¿‘ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§
    function renderRecentProjects(projects) {
      const tbody = document.getElementById('recentProjectsTable');
      tbody.innerHTML = '';

      if (projects.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="8" class="px-4 py-8 text-center text-gray-500">
              æ¡ˆä»¶ãŒã¾ã ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“
            </td>
          </tr>
        `;
        return;
      }

      projects.forEach(project => {
        const date = project.createdAt 
          ? new Date(project.createdAt).toLocaleDateString('ja-JP')
          : '-';
        
        tbody.innerHTML += `
          <tr class="hover:bg-gray-50 transition">
            <td class="px-4 py-3 text-sm text-gray-900">${truncate(project.diseaseName, 30)}</td>
            <td class="px-4 py-3 text-sm text-gray-600">${project.diseaseAbbr || '-'}</td>
            <td class="px-4 py-3 text-sm">
              <span class="px-2 py-1 rounded-full text-xs font-semibold ${getTargetTypeBadgeClass(project.targetType)}">
                ${project.targetType}
              </span>
            </td>
            <td class="px-4 py-3 text-sm text-gray-600">${project.specialty || '-'}</td>
            <td class="px-4 py-3 text-sm font-medium ${project.inquiryOnly === 'TRUE' || project.inquiryOnly === true ? 'text-red-600' : 'text-green-600'}">
              ${project.inquiryOnly === 'TRUE' || project.inquiryOnly === true ? 'å•åˆã›: ' : ''}${project.recruitCount}å
            </td>
            <td class="px-4 py-3 text-sm text-gray-600">${truncate(project.client || '-', 20)}</td>
            <td class="px-4 py-3 text-sm text-gray-500">${date}</td>
            <td class="px-4 py-3 text-sm">
              <a href="projects.html?id=${project.id}" class="text-blue-600 hover:text-blue-800">
                <i class="fas fa-eye mr-1"></i>è©³ç´°
              </a>
            </td>
          </tr>
        `;
      });
    }

    // å¯¾è±¡è€…ã‚¿ã‚¤ãƒ—ãƒãƒƒã‚¸ã®ã‚¯ãƒ©ã‚¹
    function getTargetTypeBadgeClass(type) {
      const classes = {
        'åŒ»å¸«': 'bg-blue-100 text-blue-800',
        'æ‚£è€…': 'bg-green-100 text-green-800',
        'ä»‹è­·è€…': 'bg-yellow-100 text-yellow-800',
        'çœ‹è­·å¸«': 'bg-pink-100 text-pink-800',
        'KOL': 'bg-indigo-100 text-indigo-800',
        'åŒ»å¸«ãƒ»æ‚£è€…': 'bg-purple-100 text-purple-800'
      };
      return classes[type] || 'bg-gray-100 text-gray-800';
    }

    // ãƒ†ã‚­ã‚¹ãƒˆåˆ‡ã‚Šè©°ã‚
    function truncate(text, length) {
      if (!text) return '';
      return text.length > length ? text.substring(0, length) + '...' : text;
    }

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å®Ÿè¡Œ
    window.addEventListener('DOMContentLoaded', initDashboard);
  </script>
</body>
</html>
