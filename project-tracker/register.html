<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç™»éŒ² - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå±¥æ­´ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
  <link rel="icon" type="image/png" href="SP_logo_shape_only.png">
  <!-- Cache Busting: v2.0.1 -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Project Tracker ã‚¹ã‚¿ã‚¤ãƒ«ã‚·ãƒ¼ãƒˆ -->
  <link rel="stylesheet" href="css/style-2026.css">
  <link rel="stylesheet" href="css/components.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•° -->
  <script src="js/utils.js"></script>
  <script src="js/data/specialties-master.js"></script>
  <script src="js/config.js"></script>
  <script src="js/database.js"></script>
</head>
<body class="bg-gray-50">
  <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
  <nav class="bg-white shadow-md sticky top-0 z-40">
    <div class="container mx-auto px-2 sm:px-4 py-2 sm:py-3">
      <div class="flex items-center justify-between flex-wrap gap-2">
        <!-- ãƒ­ã‚´éƒ¨åˆ† -->
        <div class="flex items-center space-x-2 sm:space-x-4">
          <img src="Seed_Planning_Logo_Original.jpg" alt="SEED PLANNING" class="h-8 sm:h-10">
          <h1 class="hidden md:block text-lg font-bold text-gray-800">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå±¥æ­´ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h1>
        </div>
        
        <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
        <div class="flex flex-wrap gap-1 sm:gap-2">
          <a href="index.html" class="px-2 sm:px-4 py-2 text-xs sm:text-sm bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition flex items-center">
            <i class="fas fa-home sm:mr-2"></i><span class="hidden sm:inline ml-1">ãƒ›ãƒ¼ãƒ </span>
          </a>
          <a href="register.html" class="px-2 sm:px-4 py-2 text-xs sm:text-sm text-white rounded-lg transition flex items-center" style="background-color: #1F7A85;">
            <i class="fas fa-plus sm:mr-2"></i><span class="hidden sm:inline ml-1">æ–°è¦ç™»éŒ²</span>
          </a>
          <a href="projects.html" class="px-2 sm:px-4 py-2 text-xs sm:text-sm bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition flex items-center">
            <i class="fas fa-search sm:mr-2"></i><span class="hidden sm:inline ml-1">æ¡ˆä»¶æ¤œç´¢</span>
          </a>
          <a href="links.html" class="px-2 sm:px-4 py-2 text-xs sm:text-sm bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition flex items-center">
            <i class="fas fa-link sm:mr-2"></i><span class="hidden sm:inline ml-1">ãƒªãƒ³ã‚¯é›†</span>
          </a>
          <a href="https://seedplanning.monday.com/boards/2723929863" target="_blank" rel="noopener noreferrer" class="px-2 sm:px-4 py-2 text-xs sm:text-sm bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition flex items-center">
            <img src="monday.png" alt="Monday" class="h-3 w-3 sm:h-4 sm:w-4 sm:mr-2"><span class="hidden sm:inline ml-1">Monday</span>
          </a>
          <a href="https://db.seedplanning.co.jp/project/management" target="_blank" rel="noopener noreferrer" class="px-2 sm:px-4 py-2 text-xs sm:text-sm bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition flex items-center">
            <img src="SP_logo_shape_only.png" alt="ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†" class="h-3 w-3 sm:h-4 sm:w-4 sm:mr-2"><span class="hidden sm:inline ml-1">PJç®¡ç†</span>
          </a>
        </div>
      </div>
    </div>
  </nav>

  <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
  <div class="container mx-auto px-4 py-8">
    <div class="max-w-4xl mx-auto">
      
      <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º -->
      <div id="loadingOverlay" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl shadow-2xl p-8 max-w-md mx-4">
          <div class="flex flex-col items-center">
            <i class="fas fa-spinner fa-spin text-6xl mb-4" style="color: #1F7A85;"></i>
            <h3 class="text-xl font-bold text-gray-800 mb-2">ãƒ‡ãƒ¼ã‚¿æº–å‚™ä¸­...</h3>
            <p class="text-gray-600 text-center">ç·¨é›†ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™ã€‚<br>ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„ã€‚</p>
          </div>
        </div>
      </div>

      <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
      <div class="rounded-lg shadow-md p-6 mb-6" style="background: linear-gradient(135deg, #E8F0F1 0%, #d5e5e7 100%);">
        <h2 id="pageHeading" class="text-2xl font-bold text-gray-800 flex items-center">
          <i class="fas fa-plus-circle mr-3 text-green-600"></i>
          æ–°è¦æ¡ˆä»¶ç™»éŒ²
        </h2>
        <p id="pageDescription" class="text-gray-600 mt-2">ãƒªã‚¯ãƒ«ãƒ¼ãƒˆæ¸ˆæ¡ˆä»¶ã®å®Ÿç¸¾æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚1ã¤ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§è¤‡æ•°ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãŒã‚ã£ãŸå ´åˆã¯ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã”ã¨ã«å…¥åŠ›ã‚’ç¹°ã‚Šè¿”ã—ã¦ãã ã•ã„ã€‚<span class="text-red-500">*</span>ãŒå¿…é ˆå…¥åŠ›é …ç›®ã§ã™ã€‚</p>
      </div>

      <!-- ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ  -->
      <form id="projectForm" class="bg-white rounded-lg shadow-md p-6 space-y-6">
        
        <!-- ç–¾æ‚£å -->
        <div>
          <label for="diseaseName" class="block text-sm font-medium text-gray-700 mb-2">
            <i class="fas fa-heartbeat mr-2 text-red-600"></i>
            ç–¾æ‚£å <span class="text-red-500">*</span>
          </label>
          <input 
            type="text" 
            id="diseaseName" 
            name="diseaseName" 
            required
            placeholder="ä¾‹: ã‚¢ãƒ«ãƒ„ãƒã‚¤ãƒãƒ¼å‹èªçŸ¥ç—‡"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          >
        </div>

        <!-- ç–¾æ‚£ç•¥èª -->
        <div>
          <label for="diseaseAbbr" class="block text-sm font-medium text-gray-700 mb-2">
            <i class="fas fa-tag mr-2 text-purple-600"></i>
            ç–¾æ‚£ç•¥èªãƒ»è‹±èªç–¾æ‚£åï¼ˆã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã€ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆè¡¨è¨˜ã¯èª¿ã¹ã¦å¿…ãšå…¥åŠ›ï¼‰
          </label>
          <input 
            type="text" 
            id="diseaseAbbr" 
            name="diseaseAbbr" 
            placeholder="ä¾‹: AD, T2DM, COPD"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          >
        </div>

        <!-- 2åˆ—ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- æ‰‹æ³• -->
          <div>
            <label for="method" class="block text-sm font-medium text-gray-700 mb-2">
              <i class="fas fa-clipboard-list mr-2 text-blue-600"></i>
              æ‰‹æ³• <span class="text-red-500">*</span>
            </label>
            <input 
              type="text" 
              id="method" 
              name="method" 
              required
              placeholder="ä¾‹: IDI, ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆ, ä¼šå ´èª¿æŸ»"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
            >
          </div>

          <!-- èª¿æŸ»ç¨®åˆ¥ -->
          <div>
            <label for="surveyType" class="block text-sm font-medium text-gray-700 mb-2">
              <i class="fas fa-chart-bar mr-2 text-green-600"></i>
              èª¿æŸ»ç¨®åˆ¥ <span class="text-red-500">*</span>
            </label>
            <select 
              id="surveyType" 
              name="surveyType" 
              required
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
            >
              <option value="å®šæ€§" selected>å®šæ€§</option>
              <option value="å®šé‡">å®šé‡</option>
              <option value="ãã®ä»–">ãã®ä»–</option>
            </select>
          </div>
        </div>

        <!-- å¯¾è±¡è€…ç¨®åˆ¥ -->
        <div>
          <label for="targetType" class="block text-sm font-medium text-gray-700 mb-2">
            <i class="fas fa-users mr-2 text-green-600"></i>
            å¯¾è±¡è€…ç¨®åˆ¥ <span class="text-red-500">*</span>
          </label>
          <select 
            id="targetType" 
            name="targetType" 
            required
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          >
            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
            <option value="åŒ»å¸«">åŒ»å¸«</option>
            <option value="æ‚£è€…">æ‚£è€…</option>
            <option value="ä»‹è­·è€…">ä»‹è­·è€…</option>
            <option value="åŒ»å¸«ãƒ»æ‚£è€…">åŒ»å¸«ãƒ»æ‚£è€…</option>
            <option value="KOL">KOL</option>
            <option value="çœ‹è­·å¸«">çœ‹è­·å¸«</option>
            <option value="è–¬å‰¤å¸«">è–¬å‰¤å¸«</option>
            <option value="ãã®ä»–">ãã®ä»–</option>
          </select>
          
          <!-- ãã®ä»–é¸æŠæ™‚ã®å…¥åŠ›ãƒœãƒƒã‚¯ã‚¹ -->
          <div id="targetTypeOtherContainer" class="mt-3 hidden">
            <label for="targetTypeOther" class="block text-sm font-medium text-gray-700 mb-2">
              å¯¾è±¡è€…ç¨®åˆ¥ã®è©³ç´° <span class="text-red-500">*</span>
            </label>
            <input 
              type="text" 
              id="targetTypeOther" 
              name="targetTypeOther" 
              placeholder="ä¾‹: æ „é¤Šå£«ã€ç†å­¦ç™‚æ³•å£«ãªã©"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            >
            <p class="text-xs text-gray-500 mt-1">å…·ä½“çš„ãªå¯¾è±¡è€…ç¨®åˆ¥ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
          </div>
        </div>

        <!-- å°‚é–€ï¼ˆã‚³ãƒ³ãƒœãƒœãƒƒã‚¯ã‚¹ï¼‰ -->
        <div class="relative" id="specialty-combobox">
          <label for="specialtyInput" class="block text-sm font-medium text-gray-700 mb-2">
            <i class="fas fa-user-md mr-2 text-indigo-600"></i>
            å°‚é–€ï¼ˆè¨ºç™‚ç§‘ï¼‰<span class="text-red-500 ml-1" id="specialtyRequired" style="display: none;">*</span>
            <span class="text-xs text-gray-500 font-normal ml-2">å€™è£œã«ãªã„å ´åˆã¯ä¸€ç•ªè¿‘ã„å°‚é–€ã‚’é¸æŠã—ã¦ç™»éŒ²ã€‚â€»å¯¾è±¡è€…ãŒåŒ»å¸«ã®å ´åˆã¯å¿…é ˆ</span>
          </label>

          <input
            id="specialtyInput"
            name="specialty"
            type="text"
            autocomplete="off"
            role="combobox"
            aria-autocomplete="list"
            aria-expanded="false"
            aria-controls="specialtyList"
            aria-activedescendant=""
            placeholder="å…ˆé ­2ã€œ3æ–‡å­—ã§å€™è£œè¡¨ç¤ºï¼ˆä¾‹ï¼šæ¶ˆåŒ– / å¾ªç’° / çš®è†šâ€¦ï¼‰"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
          />

          <!-- å€™è£œãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ -->
          <ul
            id="specialtyList"
            role="listbox"
            class="absolute z-10 w-full mt-1 border border-gray-200 bg-white rounded-md shadow hidden max-h-56 overflow-auto"
          ></ul>

          <!-- é€ä¿¡ç”¨ã®æ­£è¦åŒ–ãƒ‡ãƒ¼ã‚¿ï¼ˆå°†æ¥ã®æ‹¡å¼µç”¨ï¼‰ -->
          <input type="hidden" id="specialtyCode" name="specialty_code">
          <input type="hidden" id="specialtyEn"   name="specialty_en">

          <p class="text-xs text-gray-500 mt-1">å…ˆé ­2ã€œ3æ–‡å­—å…¥åŠ›ã§å€™è£œãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚è¡¨ç¤ºã•ã‚Œã‚‹å€™è£œã‹ã‚‰é¸æŠã—ã¦ãã ã•ã„ã€‚</p>
          <p id="specialtyError" class="mt-2 text-sm text-red-600 hidden">å€™è£œã®ä¸­ã‹ã‚‰é¸ã‚“ã§ãã ã•ã„ã€‚</p>
        </div>

        <!-- å®Ÿç¸¾æ•° -->
        <div>
          <label for="recruitCount" class="block text-sm font-medium text-gray-700 mb-2">
            <i class="fas fa-user-plus mr-2 text-purple-600"></i>
            å®Ÿç¸¾æ•°ï¼ˆãƒªã‚¯ãƒ«ãƒ¼ãƒˆå®Ÿç¸¾äººæ•°ã€ã¾ãŸã¯ç¢ºèªå…ˆã‹ã‚‰å›ç­”ã‚’å¾—ãŸæƒ³å®šãƒªã‚¯ãƒ«ãƒ¼ãƒˆäººæ•°ï¼‰ <span class="text-red-500">*</span>
          </label>
          <input 
            type="number" 
            id="recruitCount" 
            name="recruitCount" 
            required
            min="1"
            pattern="[0-9]*"
            inputmode="numeric"
            placeholder="ä¾‹: 50"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          >
          
          <!-- å•åˆã›ã®ã¿ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ -->
          <div class="mt-3 flex items-center">
            <input 
              type="checkbox" 
              id="inquiryOnly" 
              name="inquiryOnly" 
              class="w-4 h-4 text-purple-600 bg-gray-100 border-gray-300 rounded focus:ring-purple-500 focus:ring-2"
            >
            <label for="inquiryOnly" class="ml-2 text-sm font-medium text-gray-700">
              å•åˆã›ã®ã¿ã¯ãƒã‚§ãƒƒã‚¯ï¼ˆæ¨å®šå›åæ•°ã¨ã—ã¦è¨˜éŒ²ï¼‰
            </label>
          </div>
          <p class="text-xs text-gray-500 mt-1">â€»å®Ÿéš›ã®ãƒªã‚¯ãƒ«ãƒ¼ãƒˆã§ã¯ãªãã€å•åˆã›ç¢ºèªæ•°ã®å ´åˆã¯ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„</p>
        </div>

        <!-- å¯¾è±¡æ¡ä»¶ -->
        <div>
          <label for="targetConditions" class="block text-sm font-medium text-gray-700 mb-2">
            <i class="fas fa-filter mr-2 text-orange-600"></i>
            å¯¾è±¡æ¡ä»¶ï¼ˆã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°æ¡ä»¶ï¼‰ <span class="text-red-500">*</span> å‚™è€ƒã‚„æ³¨æ„ç‚¹ãªã©ã‚‚è‡ªç”±ã«ã“ã“ã¸å…¥åŠ›ã—ã¦ãã ã•ã„ 
            <P>ã€Œä½•ã®ç–¾æ‚£ã€ã‚’ã€Œä½•ã‹æœˆã§ä½•åã€è¨ºç™‚ã—ã¦ã„ã‚‹ãªã©ã¯ã€å¾Œã‹ã‚‰å‚ç…§ã—ãŸã„ã€Œã‚­ãƒ¼æƒ…å ±ã€ã§ã™ï¼</P>
          </label>
          <textarea 
            id="targetConditions" 
            name="targetConditions" 
            rows="3"
            required
            placeholder="ä¾‹: ã‚¢ãƒ«ãƒ„ãƒã‚¤ãƒãƒ¼å‹èªçŸ¥ç—‡æ‚£è€…ã‚’æœˆã«20äººä»¥ä¸Šè¨ºç™‚"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          ></textarea>
          <p class="text-xs text-gray-500 mt-1">ãƒªã‚¯ãƒ«ãƒ¼ãƒˆå¯¾è±¡ã®è©³ç´°æ¡ä»¶ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
        </div>

        <!-- è–¬å‰¤ -->
        <div>
          <label for="drug" class="block text-sm font-medium text-gray-700 mb-2">
            <i class="fas fa-pills mr-2 text-pink-600"></i>
            è–¬å‰¤ï¼ˆä»»æ„ã§ã™ãŒã€ç¨®é¡ã¾ã§ã¯å…¥åŠ›ï¼ ä¾‹ï¼šIL-13 é˜»å®³è–¬ï¼‰
          </label>
          <input 
            type="text" 
            id="drug" 
            name="drug" 
            placeholder="ä¾‹: ãƒ¬ã‚«ãƒãƒãƒ–, ãƒ¬ã‚±ãƒ³ãƒ“"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          >
          <p class="text-xs text-gray-500 mt-1">èª¿æŸ»å¯¾è±¡ã®è–¬å‰¤åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆè¤‡æ•°ã®å ´åˆã¯ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰</p>
        </div>

        <!-- 2åˆ—ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- ãƒªã‚¯ãƒ«ãƒ¼ãƒˆå®Ÿæ–½ä¼šç¤¾ -->
          <div>
            <label for="recruitCompany" class="block text-sm font-medium text-gray-700 mb-2">
              <i class="fas fa-building mr-2 text-teal-600"></i>
              ãƒªã‚¯ãƒ«ãƒ¼ãƒˆå®Ÿæ–½ï¼ˆå•åˆã›å…ˆï¼‰
            </label>
            <input 
              type="text" 
              id="recruitCompany" 
              name="recruitCompany" 
              placeholder="ä¾‹: ã‚­ãƒ£ãƒ³ãƒ‰ã‚¥, ã‚¢ã‚¹ãƒãƒ¼ã‚¯"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
            >
          </div>

          <!-- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ -->
          <div>
            <label for="client" class="block text-sm font-medium text-gray-700 mb-2">
              <i class="fas fa-handshake mr-2 text-yellow-600"></i>
              ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆèª¿æŸ»ä¾é ¼å…ƒï¼‰ <span class="text-red-500">*</span>
            </label>
            <input 
              type="text" 
              id="client" 
              name="client" 
              placeholder="ä¾‹: The Link Group"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
            >
            <p class="text-xs text-gray-500 mt-1">â€»ã‚¨ãƒ³ãƒ‰ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ã©ã¡ã‚‰ã‹å¿…é ˆã§ã™</p>
          </div>
        </div>

        <!-- æ–°è¦è¿½åŠ é …ç›® -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚¿ãƒ¼ -->
          <div>
            <label for="moderator" class="block text-sm font-medium text-gray-700 mb-2">
              <i class="fas fa-user-tie mr-2 text-purple-600"></i>
              ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚¿ãƒ¼ï¼ˆä»»æ„ï¼‰
            </label>
            <input 
              type="text" 
              id="moderator" 
              name="moderator" 
              placeholder="ä¾‹: å±±æœ¬é§¿äºº"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
            >
          </div>

          <!-- ã‚¨ãƒ³ãƒ‰ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ -->
          <div>
            <label for="endClient" class="block text-sm font-medium text-gray-700 mb-2">
              <i class="fas fa-building mr-2 text-blue-600"></i>
              ã‚¨ãƒ³ãƒ‰ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆä»»æ„ã§ã™ãŒå‡ºæ¥ã‚‹ã ã‘å…¥åŠ›ï¼‰
            </label>
            <input 
              type="text" 
              id="endClient" 
              name="endClient" 
              placeholder="ä¾‹: å¤§å¡šè£½è–¬"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
            >
          </div>
        </div>
        
        <!-- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ/ã‚¨ãƒ³ãƒ‰ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ ã©ã¡ã‚‰ã‹å¿…é ˆã®æ³¨æ„æ›¸ã -->
        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
          <p class="text-sm text-gray-700 flex items-start">
            <i class="fas fa-info-circle mr-2 text-yellow-600 mt-0.5"></i>
            <span><span class="text-red-500 font-semibold">â€»å¿…é ˆï¼š</span> ã€Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã€ã¾ãŸã¯ã€Œã‚¨ãƒ³ãƒ‰ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã€ã®ã„ãšã‚Œã‹ã€ã¾ãŸã¯ä¸¡æ–¹ã«å…¥åŠ›ãŒå¿…è¦ã§ã™ã€‚</span>
          </p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <!-- PJç•ªå· -->
          <div>
            <label for="projectNumber" class="block text-sm font-medium text-gray-700 mb-2">
              <i class="fas fa-hashtag mr-2 text-indigo-600"></i>
              PJç•ªå·ï¼ˆä»»æ„ï¼‰
            </label>
            <input 
              type="text" 
              id="projectNumber" 
              name="projectNumber" 
              placeholder="ä¾‹: Y10034163"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
            >
          </div>

          <!-- å®Ÿæ–½å¹´æœˆ -->
          <div>
            <label for="implementationDate" class="block text-sm font-medium text-gray-700 mb-2">
              <i class="fas fa-calendar mr-2 text-red-600"></i>
              å®Ÿæ–½å¹´æœˆï¼ˆå•åˆã›å¹´æœˆï¼‰ <span class="text-red-500">*</span>
            </label>
            <input 
              type="text" 
              id="implementationDate" 
              name="implementationDate" 
              required
              placeholder="ä¾‹: 2024/11"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
            >
            <p class="text-xs text-gray-500 mt-1">YYYY/MMå½¢å¼ã§å…¥åŠ›</p>
          </div>

          <!-- ç™»éŒ²æ‹…å½“ -->
          <div>
            <label for="registrant" class="block text-sm font-medium text-gray-700 mb-2">
              <i class="fas fa-user-check mr-2 text-teal-600"></i>
              ç™»éŒ²æ‹…å½“ <span class="text-red-500">*</span>
            </label>
            <input 
              type="text" 
              id="registrant" 
              name="registrant" 
              required
              placeholder="ä¾‹: æœ«ç”°"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
            >
          </div>
        </div>

        <!-- ç™»éŒ²ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
          <p class="text-sm text-gray-700 text-center">
            <i class="fas fa-info-circle mr-2 text-blue-600"></i>
            æ¡ˆä»¶ç™»éŒ²ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚ä»¥ä¸‹ã®ãƒœã‚¿ãƒ³ã‹ã‚‰ã€Œç™»éŒ²ã€ã‚’ã—ã¦ãã ã•ã„ã€‚
          </p>
        </div>

        <!-- é€ä¿¡ãƒœã‚¿ãƒ³ -->
        <div class="flex space-x-4 pt-4">
          <button 
            type="submit" 
            class="flex-1 bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition font-semibold flex items-center justify-center space-x-2"
          >
            <i class="fas fa-code-branch"></i>
            <span>ã“ã®å†…å®¹ã§æ¡ˆä»¶ç™»éŒ²ã™ã‚‹</span>
          </button>
          <button 
            type="button" 
            onclick="resetForm()" 
            class="px-6 py-3 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition font-semibold"
          >
            <i class="fas fa-redo mr-2"></i>
            ãƒªã‚»ãƒƒãƒˆ
          </button>
        </div>
      </form>

      <!-- æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
      <div id="successMessage" class="hidden mt-6 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg">
        <div class="flex items-center justify-between mb-2">
          <div class="flex items-center space-x-2">
            <i class="fas fa-check-circle text-xl"></i>
            <span class="font-semibold">ç™»éŒ²ã—ã¾ã—ãŸï¼</span>
          </div>
          <button onclick="hideSuccessMessage()" class="text-green-700 hover:text-green-900">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div id="successDetails" class="ml-7 space-y-2">
          <p class="text-sm">
            <span class="font-semibold">ç™»éŒ²ID:</span>
            <span id="savedId">-</span>
          </p>
          <p class="text-sm">
            <span class="font-semibold">ç™»éŒ²ç•ªå·:</span>
            <span id="savedRegistrationId">-</span>
          </p>
          <a id="projectLink" href="projects.html" class="text-blue-600 hover:text-blue-800 underline inline-flex items-center space-x-2">
            <i class="fas fa-search"></i>
            <span>æ¡ˆä»¶æ¤œç´¢ã§ç¢ºèªã™ã‚‹</span>
            <i class="fas fa-external-link-alt text-sm"></i>
          </a>
        </div>
      </div>

      <!-- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
      <div id="errorMessage" class="hidden mt-6 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg flex items-center justify-between">
        <div class="flex items-center space-x-2">
          <i class="fas fa-exclamation-circle text-xl"></i>
          <span id="errorText">ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</span>
        </div>
        <button onclick="hideErrorMessage()" class="text-red-700 hover:text-red-900">
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- å…±é€šè¨­å®š -->
  <script src="js/config.js"></script>

  <!-- å°‚é–€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ ã‚ªãƒ¼ãƒˆã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆ -->
  <script>
    // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚³ãƒ¼ãƒ—ã§å¤‰æ•°ã¨é–¢æ•°ã‚’å®šç¾©
    let SPECIALTIES_MASTER = [];
    let SPECIALTIES_INDEX = [];
    let SPECIALTY_ALIASES = {};
    
    // æ­£è¦åŒ–é–¢æ•°ã‚‚ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚³ãƒ¼ãƒ—ã«å®šç¾©
    const normalizeKey = (s) => (s || "").toString().trim().toLowerCase()
                 .replace(/\s+/g, "").normalize("NFKC");
    
    // DOMContentLoadedã‚’å¾…ã£ã¦ã‹ã‚‰å®Ÿè¡Œ
    document.addEventListener('DOMContentLoaded', function() {
      console.log('=== Specialty Autocomplete Debug ===');
      console.log('SpecialtyMaster available:', typeof SpecialtyMaster !== 'undefined');
      
      if (typeof SpecialtyMaster === 'undefined') {
        console.error('SpecialtyMaster is not loaded! Check if specialties-master.js is properly loaded.');
        return;
      }
      
      // ===== æ–°ã—ã„çµ±ä¸€ãƒã‚¹ã‚¿ãƒ¼ã‚’ä½¿ç”¨ =====
      // specialties-master.js ã‹ã‚‰ SpecialtyMaster ã‚’ä½¿ç”¨
    
      // å¾Œæ–¹äº’æ›æ€§ã®ãŸã‚ã€æ—¢å­˜ã®å¤‰æ•°åã«ãƒãƒƒãƒ”ãƒ³ã‚°
      SPECIALTIES_MASTER = SpecialtyMaster.getAllSpecialties().map(s => ({
        code: s.code,
        ja: s.ja,
        en: s.en
      }));
    
    /* æ—§ãƒã‚¹ã‚¿ãƒ¼å®šç¾©ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆï¼‰
    const SPECIALTIES_MASTER_OLD = [
      // å†…ç§‘ç³»
      { code: "001", ja: "å†…ç§‘", en: "Internal Medicine" },
      { code: "340", ja: "å‘¼å¸å™¨å†…ç§‘", en: "Respiratory Medicine (Internal)" },
      { code: "500", ja: "æ¶ˆåŒ–å™¨å†…ç§‘", en: "Gastroenterology (Internal)" },
      { code: "290", ja: "èƒƒè…¸ç§‘", en: "Gastroenterology" },
      { code: "350", ja: "å¾ªç’°å™¨å†…ç§‘", en: "Cardiovascular Medicine (Internal)" },
      { code: "640", ja: "å¾ªç’°å™¨ç§‘", en: "Cardiology" },
      { code: "450", ja: "å†…åˆ†æ³Œå†…ç§‘", en: "Endocrinology" },
      { code: "440", ja: "ä»£è¬å†…ç§‘", en: "Metabolic Medicine" },
      { code: "400", ja: "ç³–å°¿ç—…ç§‘", en: "Diabetology" },
      { code: "002", ja: "å†…åˆ†æ³Œä»£è¬å†…ç§‘", en: "Endocrinology & Metabolism" },
      { code: "410", ja: "è…è‡“å†…ç§‘", en: "Nephrology" },
      { code: "420", ja: "è…ç§»æ¤ç§‘", en: "Kidney Transplantation" },
      { code: "430", ja: "è¡€æ¶²é€æç§‘", en: "Dialysis Medicine" },
      { code: "470", ja: "è¡€æ¶²ç§‘", en: "Hematology" },
      { code: "480", ja: "è¡€æ¶²å†…ç§‘", en: "Hematology (Internal)" },
      { code: "280", ja: "ç¥çµŒå†…ç§‘", en: "Neurology (Internal)" },
      { code: "003", ja: "è…«ç˜å†…ç§‘", en: "Medical Oncology" },
      { code: "590", ja: "è…«ç˜æ²»ç™‚ç§‘", en: "Oncology (Treatment)" },
      { code: "004", ja: "å¿ƒç™‚å†…ç§‘", en: "Psychosomatic Medicine" },
      { code: "650", ja: "ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ç§‘", en: "Allergology" },
      { code: "ãƒªã‚¦ãƒãƒç§‘", ja: "ãƒªã‚¦ãƒãƒç§‘", en: "Rheumatology" },
      { code: "660", ja: "è€å¹´ç§‘", en: "Geriatrics" },
      { code: "600", ja: "ç·åˆè¨ºç™‚ç§‘", en: "General Practice" },
      { code: "005", ja: "ãã®ä»–ã®å†…ç§‘", en: "Other Internal Medicine" },
      
      // å¤–ç§‘ç³»
      { code: "110", ja: "å¤–ç§‘", en: "Surgery" },
      { code: "170", ja: "å¿ƒè‡“è¡€ç®¡å¤–ç§‘", en: "Cardiovascular Surgery" },
      { code: "160", ja: "å‘¼å¸å™¨å¤–ç§‘", en: "Thoracic Surgery" },
      { code: "510", ja: "æ¶ˆåŒ–å™¨å¤–ç§‘", en: "Gastroenterological Surgery" },
      { code: "150", ja: "è„³ç¥çµŒå¤–ç§‘", en: "Neurosurgery" },
      { code: "180", ja: "å°å…å¤–ç§‘", en: "Pediatric Surgery" },
      { code: "120", ja: "æ•´å½¢å¤–ç§‘", en: "Orthopaedic Surgery" },
      { code: "130", ja: "å½¢æˆå¤–ç§‘", en: "Plastic Surgery" },
      { code: "140", ja: "ç¾å®¹å¤–ç§‘", en: "Cosmetic Surgery" },
      { code: "006", ja: "å£è…”å¤–ç§‘", en: "Oral Surgery" },
      { code: "540", ja: "å¤§è…¸è‚›é–€ç§‘", en: "Colorectal Surgery" },
      { code: "610", ja: "ä¹³è…ºç”²çŠ¶è…ºå¤–ç§‘", en: "Breast & Thyroid Surgery" },
      { code: "670", ja: "ä¹³è…ºç§‘", en: "Breast Surgery" },
      { code: "007", ja: "ãã®ä»–ã®å¤–ç§‘", en: "Other Surgery" },
      
      // å°å…ãƒ»ç”£å©¦äººç§‘
      { code: "100", ja: "å°å…ç§‘", en: "Pediatrics" },
      { code: "620", ja: "æ–°ç”Ÿå…ç§‘", en: "Neonatology" },
      { code: "630", ja: "å°å…å¾ªç’°å™¨ç§‘", en: "Pediatric Cardiology" },
      { code: "220", ja: "ç”£å©¦äººç§‘", en: "Obstetrics & Gynecology" },
      { code: "320", ja: "ç”£ç§‘", en: "Obstetrics" },
      { code: "330", ja: "å©¦äººç§‘", en: "Gynecology" },
      
      // ç²¾ç¥ãƒ»ç¥çµŒç§‘
      { code: "008", ja: "ç²¾ç¥ç§‘", en: "Psychiatry" },
      
      // æ„Ÿè¦šå™¨ç§‘
      { code: "230", ja: "çœ¼ç§‘", en: "Ophthalmology" },
      { code: "240", ja: "è€³é¼»å’½å–‰ç§‘", en: "Otorhinolaryngology (ENT)" },
      { code: "250", ja: "æ°—ç®¡é£Ÿé“ç§‘", en: "Tracheo-Esophageal Medicine" },
      
      // çš®è†šãƒ»æ³Œå°¿å™¨ç§‘
      { code: "300", ja: "çš®è†šç§‘", en: "Dermatology" },
      { code: "310", ja: "æ³Œå°¿å™¨ç§‘", en: "Urology" },
      { code: "190", ja: "çš®è†šæ³Œå°¿å™¨ç§‘", en: "Dermatology & Urology" },
      { code: "200", ja: "æ€§ç—…ç§‘", en: "Sexually Transmitted Disease Medicine" },
      { code: "210", ja: "è‚›é–€ç§‘", en: "Proctology" },
      
      // ãã®ä»–ã®è¨ºç™‚ç§‘
      { code: "260", ja: "ãƒªãƒãƒ“ãƒªãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ç§‘", en: "Rehabilitation Medicine" },
      { code: "270", ja: "æ”¾å°„ç·šç§‘", en: "Radiology" },
      { code: "490", ja: "éº»é…”ç§‘", en: "Anesthesiology" },
      { code: "680", ja: "ç·©å’Œã‚±ã‚¢ç§‘", en: "Palliative Care" },
      { code: "460", ja: "æ•‘æ€¥åŒ»å­¦ç§‘", en: "Emergency Medicine" },
      { code: "009", ja: "æ•‘æ€¥ç§‘", en: "Emergency Department" },
      { code: "690", ja: "ç—…ç†ç§‘", en: "Pathology" },
      { code: "700", ja: "åŸºç¤åŒ»å­¦ç³»", en: "Basic Medical Sciences" },
      { code: "999", ja: "ãã®ä»–", en: "Other" },
    ];
    */
    
      // ---- 2) ã‚ˆãã‚ã‚‹è¡¨è¨˜ã®ã€Œåˆ¥å â†’ æ­£å¼åã€ãƒãƒƒãƒ—ï¼ˆæ–°ãƒã‚¹ã‚¿ãƒ¼ã‹ã‚‰è‡ªå‹•ç”Ÿæˆï¼‰ ----
      SPECIALTY_ALIASES = {};
      
      // æ–°ãƒã‚¹ã‚¿ãƒ¼ã‹ã‚‰åˆ¥åãƒãƒƒãƒ—ã‚’ç”Ÿæˆ
      SpecialtyMaster.getAllSpecialties().forEach(specialty => {
        if (specialty.aliases && Array.isArray(specialty.aliases)) {
          specialty.aliases.forEach(alias => {
            SPECIALTY_ALIASES[alias] = specialty.ja;
          });
        }
      });
    
      // æ—§å®šç¾©ã‚‚ä¸€éƒ¨è¿½åŠ ï¼ˆå¾Œæ–¹äº’æ›æ€§ã®ãŸã‚ï¼‰
      Object.assign(SPECIALTY_ALIASES, {
      // å†…ç§‘ç³»
      "ä¸€èˆ¬å†…ç§‘": "å†…ç§‘",
      "æ¶ˆåŒ–å™¨ç§‘": "æ¶ˆåŒ–å™¨å†…ç§‘",
      "æ¶ˆåŒ–å™¨": "æ¶ˆåŒ–å™¨å†…ç§‘",
      "GI": "æ¶ˆåŒ–å™¨å†…ç§‘",
      "å¾ªç’°å™¨": "å¾ªç’°å™¨å†…ç§‘",
      "å‘¼å¸å™¨ç§‘": "å‘¼å¸å™¨å†…ç§‘",
      "å‘¼å¸å™¨": "å‘¼å¸å™¨å†…ç§‘",
      "è¡€æ¶²": "è¡€æ¶²å†…ç§‘",
      "å†…åˆ†æ³Œç§‘": "å†…åˆ†æ³Œå†…ç§‘",
      "å†…åˆ†æ³Œ": "å†…åˆ†æ³Œå†…ç§‘",
      "ä»£è¬ç§‘": "ä»£è¬å†…ç§‘",
      "å†…åˆ†æ³Œä»£è¬ç§‘": "å†…åˆ†æ³Œä»£è¬å†…ç§‘",
      "ç³–å°¿ç—…": "ç³–å°¿ç—…ç§‘",
      "è…è‡“ç§‘": "è…è‡“å†…ç§‘",
      "è…è‡“": "è…è‡“å†…ç§‘",
      "è¡€æ¶²é€æ": "è¡€æ¶²é€æç§‘",
      "ç¥çµŒ": "ç¥çµŒå†…ç§‘",
      "è…«ç˜": "è…«ç˜å†…ç§‘",
      "ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼": "ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ç§‘",
      "ãƒªã‚¦ãƒãƒ": "ãƒªã‚¦ãƒãƒç§‘",
      "ç·åˆè¨ºç™‚": "ç·åˆè¨ºç™‚ç§‘",
      
      // å¤–ç§‘ç³»
      "è„³å¤–": "è„³ç¥çµŒå¤–ç§‘",
      "è„³å¤–ç§‘": "è„³ç¥çµŒå¤–ç§‘",
      "æ•´å½¢": "æ•´å½¢å¤–ç§‘",
      "å½¢æˆ": "å½¢æˆå¤–ç§‘",
      "å¿ƒè‡“å¤–ç§‘": "å¿ƒè‡“è¡€ç®¡å¤–ç§‘",
      "å¿ƒå¤–": "å¿ƒè‡“è¡€ç®¡å¤–ç§‘",
      "ä¹³è…ºå¤–ç§‘": "ä¹³è…ºç§‘",
      
      // ãã®ä»–
      "è€³é¼»ç§‘": "è€³é¼»å’½å–‰ç§‘",
      "ENT": "è€³é¼»å’½å–‰ç§‘",
      "éº»é…”": "éº»é…”ç§‘",
      "å°å…å¾ªç’°å™¨": "å°å…å¾ªç’°å™¨ç§‘",
      "çš®æ³Œ": "çš®è†šæ³Œå°¿å™¨ç§‘",
      "ãƒªãƒ": "ãƒªãƒãƒ“ãƒªãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ç§‘",
      "ãƒªãƒãƒ“ãƒª": "ãƒªãƒãƒ“ãƒªãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ç§‘",
      "ç²¾ç¥": "ç²¾ç¥ç§‘",
      "æ•‘æ€¥": "æ•‘æ€¥ç§‘",
      "ICU": "æ•‘æ€¥ç§‘",
      "ç·©å’Œ": "ç·©å’Œã‚±ã‚¢ç§‘",
        "ç—…ç†": "ç—…ç†ç§‘",
      });

      // ---- 3) æ¤œç´¢ã‚­ãƒ¼ã‚’å¢—ã‚„ã™ï¼ˆæ—¥æœ¬èªãƒ»è‹±åãƒ»ã‚³ãƒ¼ãƒ‰ï¼‰ ----
      // æ–°ãƒã‚¹ã‚¿ãƒ¼ã®æ§‹é€ ã«åˆã‚ã›ã¦ä¿®æ­£
      SPECIALTIES_INDEX = [];
      
      // SpecialtyMasterãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã‚’ç¢ºèª
      if (typeof SpecialtyMaster !== 'undefined' && SpecialtyMaster.getAllSpecialties) {
        const allSpecialties = SpecialtyMaster.getAllSpecialties();
        console.log('Loading specialties from SpecialtyMaster:', allSpecialties.length);
        
        allSpecialties.forEach(r => {
          SPECIALTIES_INDEX.push({
            code: r.code,
            ja: r.ja,
            en: r.en || '',
            key_ja: normalizeKey(r.ja),
            key_en: normalizeKey(r.en || ''),
            key_code: normalizeKey(r.code),
          });
        });
      } else {
        console.error('SpecialtyMaster not found! Using fallback data.');
        // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: æœ€å°é™ã®ãƒ‡ãƒ¼ã‚¿
        SPECIALTIES_INDEX.push(
          { code: 'IM', ja: 'å†…ç§‘', en: 'Internal Medicine', key_ja: normalizeKey('å†…ç§‘'), key_en: normalizeKey('Internal Medicine'), key_code: normalizeKey('IM') },
          { code: 'SURG', ja: 'å¤–ç§‘', en: 'Surgery', key_ja: normalizeKey('å¤–ç§‘'), key_en: normalizeKey('Surgery'), key_code: normalizeKey('SURG') },
          { code: 'PED', ja: 'å°å…ç§‘', en: 'Pediatrics', key_ja: normalizeKey('å°å…ç§‘'), key_en: normalizeKey('Pediatrics'), key_code: normalizeKey('PED') }
        );
      }
      
      // ãƒ‡ãƒãƒƒã‚°ç”¨: ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’ç¢ºèª
      console.log('SPECIALTIES_MASTER count:', SPECIALTIES_MASTER.length);
      console.log('SPECIALTIES_INDEX count:', SPECIALTIES_INDEX.length);
      console.log('SPECIALTIES_INDEX sample:', SPECIALTIES_INDEX.slice(0, 3));
      console.log('SPECIALTY_ALIASES sample:', Object.keys(SPECIALTY_ALIASES).slice(0, 5));

      // ---- 4) UI ãƒ­ã‚¸ãƒƒã‚¯ ----
      // setupSpecialtyCombobox ã‚’ç›´æ¥å®Ÿè¡Œ
      const input = document.getElementById("specialtyInput");
      const list  = document.getElementById("specialtyList");
      const err   = document.getElementById("specialtyError");
      const hidCode = document.getElementById("specialtyCode");
      const hidEn   = document.getElementById("specialtyEn");
      
      console.log('UI elements found:', {
        input: !!input,
        list: !!list,
        err: !!err,
        hidCode: !!hidCode,
        hidEn: !!hidEn
      });
      
      if (!input || !list) {
        console.error('Required elements not found!');
        return;
      }

      let activeIndex = -1;
      let currentItems = [];

      function showError(msg = "å€™è£œã®ä¸­ã‹ã‚‰é¸ã‚“ã§ãã ã•ã„ã€‚") {
        err.textContent = msg;
        err.classList.remove("hidden");
        input.classList.add("border-red-400", "focus:ring-red-500");
      }
      function hideError() {
        err.classList.add("hidden");
        input.classList.remove("border-red-400", "focus:ring-red-500");
      }
      function hideList() {
        list.classList.add("hidden");
        input.setAttribute("aria-expanded", "false");
        input.setAttribute("aria-activedescendant", "");
      }

      function renderList(items) {
        list.innerHTML = "";
        activeIndex = -1;
        currentItems = items;

        if (!items.length) {
          hideList(); return;
        }
        items.forEach((r, idx) => {
          const li = document.createElement("li");
          li.id = `specialty-opt-${idx}`;
          li.setAttribute("role", "option");
          li.className = "px-3 py-2 cursor-pointer hover:bg-indigo-50 text-sm";
          li.innerHTML = `<span class="font-medium">${r.ja}</span>
                          <span class="text-gray-500 ml-2">(${r.en})</span>
                          <span class="text-gray-400 ml-2 text-xs">#${r.code}</span>`;
          li.addEventListener("mousedown", (e) => { e.preventDefault(); choose(idx); });
          list.appendChild(li);
        });
        list.classList.remove("hidden");
        input.setAttribute("aria-expanded", "true");
      }

      function choose(idx) {
        const r = currentItems[idx];
        if (!r) return;
        input.value = r.ja;
        hidCode.value = r.code;
        hidEn.value   = r.en;
        hideError(); hideList();
      }

      // å…¥åŠ› â†’ å€™è£œç”Ÿæˆ
      function candidates(qRaw) {
        if (!qRaw) return [];
        
        // ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°
        console.log('candidates called with:', qRaw);
        console.log('SPECIALTIES_INDEX length:', SPECIALTIES_INDEX.length);
        console.log('normalizeKey type:', typeof normalizeKey);
        
        let q = normalizeKey(qRaw);
        // åˆ¥å â†’ æ­£å¼åã«å¯„ã›ã‚‹
        if (SPECIALTY_ALIASES[qRaw]) q = normalizeKey(SPECIALTY_ALIASES[qRaw]);

        // å…ˆé ­ä¸€è‡´ã‚’æœ€å„ªå…ˆã€æ¬¡ã«éƒ¨åˆ†ä¸€è‡´
        const starts = [];
        const parts  = [];
        for (const r of SPECIALTIES_INDEX) {
          const hitStart = r.key_ja.startsWith(q) || r.key_en.startsWith(q) || r.key_code.startsWith(q);
          const hitPart  = !hitStart && (r.key_ja.includes(q) || r.key_en.includes(q) || r.key_code.includes(q));
          if (hitStart) starts.push(r);
          else if (hitPart) parts.push(r);
        }
        
        const results = [...starts, ...parts].slice(0, 30);
        console.log('candidates found:', results.length);
        return results;
      }

      input.addEventListener("input", () => {
        console.log('Input event fired, value:', input.value);
        hideError();
        const val = input.value;
        
        // æ”¹è¡Œã€ã‚«ãƒ³ãƒã€ã‚»ãƒŸã‚³ãƒ­ãƒ³ãªã©è¤‡æ•°ã®å°‚é–€ã‚’ç¤ºã™æ–‡å­—ãŒå«ã¾ã‚Œã¦ã„ã‚‹å ´åˆã¯ã‚¯ãƒªã‚¢
        if (val.includes('\n') || val.includes(',') || val.includes('ã€') || val.includes(';') || val.includes('ï¼›')) {
          showError("è¤‡æ•°ã®å°‚é–€ã‚’å…¥åŠ›ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚1ã¤ãšã¤é¸æŠã—ã¦ãã ã•ã„ã€‚");
          input.value = "";
          hidCode.value = "";
          hidEn.value = "";
          return;
        }
        
        const items = candidates(input.value);
        console.log('Items to render:', items.length);
        // é¸æŠãŒå¤–ã‚ŒãŸã‚‰ hidden ã‚’ã‚¯ãƒªã‚¢
        hidCode.value = ""; hidEn.value = "";
        renderList(items);
      });

      input.addEventListener("keydown", (e) => {
        const visible = !list.classList.contains("hidden");
        if (!visible && ["ArrowDown", "ArrowUp"].includes(e.key)) {
          renderList(candidates(input.value));
        }
        if (e.key === "ArrowDown" && visible) {
          e.preventDefault();
          activeIndex = Math.min(activeIndex + 1, currentItems.length - 1);
          highlight();
        } else if (e.key === "ArrowUp" && visible) {
          e.preventDefault();
          activeIndex = Math.max(activeIndex - 1, 0);
          highlight();
        } else if (e.key === "Enter" && visible) {
          e.preventDefault(); choose(activeIndex >= 0 ? activeIndex : 0);
        } else if (e.key === "Escape") {
          hideList();
        }
      });

      function highlight() {
        [...list.children].forEach((li, i) => {
          if (i === activeIndex) {
            li.classList.add("bg-indigo-50");
            input.setAttribute("aria-activedescendant", li.id);
            li.scrollIntoView({ block: "nearest" });
          } else {
            li.classList.remove("bg-indigo-50");
          }
        });
      }

      input.addEventListener("blur", () => setTimeout(hideList, 120));

      // ãƒšãƒ¼ã‚¹ãƒˆã‚¤ãƒ™ãƒ³ãƒˆï¼šè¤‡æ•°ã®å°‚é–€ãŒãƒšãƒ¼ã‚¹ãƒˆã•ã‚ŒãŸå ´åˆã¯é˜²ã
      input.addEventListener("paste", (e) => {
        const pastedText = (e.clipboardData || window.clipboardData).getData('text');
        
        // æ”¹è¡Œã€ã‚«ãƒ³ãƒã€ã‚»ãƒŸã‚³ãƒ­ãƒ³ãªã©è¤‡æ•°ã®å°‚é–€ã‚’ç¤ºã™æ–‡å­—ãŒå«ã¾ã‚Œã¦ã„ã‚‹å ´åˆã¯ãƒšãƒ¼ã‚¹ãƒˆã‚’é˜²ã
        if (pastedText.includes('\n') || pastedText.includes(',') || pastedText.includes('ã€') || pastedText.includes(';') || pastedText.includes('ï¼›')) {
          e.preventDefault();
          showError("è¤‡æ•°ã®å°‚é–€ã‚’ä¸€åº¦ã«å…¥åŠ›ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚1ã¤ãšã¤å…¥åŠ›ã—ã¦å€™è£œã‹ã‚‰é¸æŠã—ã¦ãã ã•ã„ã€‚");
          return;
        }
        
        // ãƒšãƒ¼ã‚¹ãƒˆå¾Œã¯é¸æŠçŠ¶æ…‹ã‚’ã‚¯ãƒªã‚¢
        hidCode.value = "";
        hidEn.value = "";
      });

      // é€ä¿¡æ™‚ï¼šå…¥åŠ›ãŒã‚ã‚Œã°ãƒã‚¹ã‚¿ã‹ã‚‰é¸æŠã•ã‚ŒãŸã‚‚ã®ã ã‘é€šã™ï¼ˆspecialtyCodeãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªï¼‰
      const form = input.closest("form");
      if (form) {
        form.addEventListener("submit", (e) => {
          const v = input.value.trim();
          
          // ç©ºæ¬„ã¯è¨±å¯ï¼ˆå¯¾è±¡è€…ç¨®åˆ¥ãŒåŒ»å¸«ä»¥å¤–ã®å ´åˆã¯ä»»æ„é …ç›®ï¼‰
          if (!v) {
            hidCode.value = "";
            hidEn.value = "";
            hideError();
            return;
          }

          // å…¥åŠ›ãŒã‚ã‚‹ãŒ specialtyCode ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã‚¨ãƒ©ãƒ¼
          // ï¼ˆå€™è£œã‹ã‚‰é¸æŠã•ã‚Œã¦ã„ãªã„ã€ã¾ãŸã¯æ‰‹å…¥åŠ›/ã‚³ãƒ”ãƒšã•ã‚ŒãŸï¼‰
          if (!hidCode.value) {
            e.preventDefault();
            e.stopPropagation();
            renderList(candidates(v));
            showError("å€™è£œã®ä¸­ã‹ã‚‰é¸ã‚“ã§ãã ã•ã„ã€‚è¤‡æ•°ã®å°‚é–€ã‚’å…¥åŠ›ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚");
            input.focus();
            return;
          }

          // specialtyCode ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã€æ­£å¼åã§é€ä¿¡
          const hit = SPECIALTIES_MASTER.find(r => r.code === hidCode.value);
          if (!hit) {
            // å¿µã®ãŸã‚ã€ã‚³ãƒ¼ãƒ‰ãŒãƒã‚¹ã‚¿ã«å­˜åœ¨ã™ã‚‹ã‹ç¢ºèª
            e.preventDefault();
            e.stopPropagation();
            showError("ç„¡åŠ¹ãªå°‚é–€ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚å€™è£œã‹ã‚‰é¸ã³ç›´ã—ã¦ãã ã•ã„ã€‚");
            hidCode.value = ""; hidEn.value = "";
            input.focus();
            return;
          }
          
          // æ­£å¼åï¼†ã‚³ãƒ¼ãƒ‰ãƒ»è‹±åã§é€ã‚‹
          input.value   = hit.ja;
          hidCode.value = hit.code;
          hidEn.value   = hit.en;
          hideError();
        });
      }
      
    }); // DOMContentLoaded ã®çµ‚äº†
  </script>

  <!-- ãƒ•ã‚©ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯ -->
  <script>
    // âœ… Google Apps Scriptï¼ˆWebã‚¢ãƒ—ãƒªï¼‰URLï¼ˆconfig.jsã‹ã‚‰å–å¾—ï¼‰
    const API_ENDPOINT = API.getSubmitUrl();

    // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
    function getQueryParam(name) {
      const url = new URL(location.href);
      return url.searchParams.get(name);
    }

    // å€¤ã‚’ã‚»ãƒƒãƒˆã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
    function setValue(id, value) {
      const el = document.getElementById(id);
      if (el) el.value = (value ?? '');
    }

    // å®Ÿæ–½å¹´æœˆã‚’YYYY/MMå½¢å¼ã«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
    function formatImplementationDateForInput(value) {
      if (!value) return '';
      
      // æ—¢ã«YYYY/MM ã¾ãŸã¯ YYYY/MM/DD å½¢å¼ã®å ´åˆ
      if (/^\d{4}\/\d{1,2}(\/\d{1,2})?$/.test(value)) {
        // YYYY/MM/DD ã®å ´åˆã¯ YYYY/MM ã«å¤‰æ›
        const parts = value.split('/');
        if (parts.length === 3) {
          return `${parts[0]}/${parts[1].padStart(2, '0')}`;
        }
        // YYYY/MM ã®å ´åˆã¯ãã®ã¾ã¾
        return value;
      }
      
      // ISOå½¢å¼ (2024-12-01T08:00:00.000Z) ã‚„ä»–ã®æ—¥ä»˜å½¢å¼ã®å ´åˆ
      const date = new Date(value);
      if (!isNaN(date.getTime())) {
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        return `${year}/${month}`;
      }
      
      // ãƒ‘ãƒ¼ã‚¹ã§ããªã„å ´åˆã¯ç©ºæ–‡å­—ã‚’è¿”ã™
      return '';
    }

    // GAS URLã‚’æ§‹ç¯‰ã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
    function buildGasUrl(action, params = {}) {
      const baseUrl = GAS_CONFIG.URL;
      const url = new URL(baseUrl);
      url.searchParams.set('action', action);
      if (GAS_CONFIG.TOKEN) {
        url.searchParams.set('token', GAS_CONFIG.TOKEN);
      }
      Object.entries(params).forEach(([key, value]) => {
        if (value !== undefined && value !== null && value !== '') {
          url.searchParams.set(key, String(value));
        }
      });
      return url.toString();
    }

    // ç·¨é›†å¯¾è±¡ã®IDã¨registrationIdã‚’ä¿æŒã™ã‚‹ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
    window.__editingId = null;
    window.__editingRegistrationId = null;

    // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã€æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€
    async function loadProjectForEdit() {
      const mode = getQueryParam('mode');
      const id = getQueryParam('id');
      
      if (mode !== 'edit' || !id) return;

      // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºã‚’è¡¨ç¤º
      const loadingOverlay = document.getElementById('loadingOverlay');
      loadingOverlay.classList.remove('hidden');

      try {
        // ç”»é¢è¡¨ç¤ºã‚’ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã¸
        document.title = 'æ¡ˆä»¶ç·¨é›† - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå±¥æ­´ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ';
        const heading = document.getElementById('pageHeading');
        if (heading) {
          heading.innerHTML = '<i class="fas fa-edit mr-3 text-blue-600"></i>æ¡ˆä»¶ç·¨é›†';
        }
        const description = document.getElementById('pageDescription');
        if (description) {
          description.textContent = 'æ—¢å­˜æ¡ˆä»¶ã®æƒ…å ±ã‚’ç·¨é›†ã—ã¾ã™ã€‚*ãŒå¿…é ˆå…¥åŠ›é …ç›®ã§ã™ã€‚';
        }

        // æ—¢å­˜ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆGAS action=getï¼‰
        const url = buildGasUrl('get', { id: id });
        
        console.log('ğŸ“¡ ãƒ‡ãƒ¼ã‚¿å–å¾—é–‹å§‹:', url);
        
        const res = await fetch(url, {
          method: 'GET',
          headers: {
            'Accept': 'application/json',
          },
          // ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’30ç§’ã«è¨­å®š
          signal: AbortSignal.timeout(30000)
        });
        
        console.log('ğŸ“¥ ãƒ¬ã‚¹ãƒãƒ³ã‚¹å—ä¿¡:', res.status, res.statusText);
        
        // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ†ã‚­ã‚¹ãƒˆã‚’å–å¾—ã—ã¦ãƒ­ã‚°å‡ºåŠ›
        const responseText = await res.text();
        console.log('ğŸ“„ ãƒ¬ã‚¹ãƒãƒ³ã‚¹å†…å®¹:', responseText);
        
        if (!res.ok) {
          throw new Error(`ãƒ‡ãƒ¼ã‚¿å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ (${res.status}: ${res.statusText})\n\nãƒ¬ã‚¹ãƒãƒ³ã‚¹: ${responseText}`);
        }
        
        // JSONãƒ‘ãƒ¼ã‚¹
        let data;
        try {
          data = JSON.parse(responseText);
        } catch (parseError) {
          console.error('âŒ JSONãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼:', parseError);
          throw new Error(`JSONãƒ‘ãƒ¼ã‚¹ã«å¤±æ•—ã—ã¾ã—ãŸ: ${parseError.message}\n\nãƒ¬ã‚¹ãƒãƒ³ã‚¹: ${responseText}`);
        }
        
        console.log('âœ… ãƒ‡ãƒ¼ã‚¿å–å¾—æˆåŠŸ:', data);
        
        if (!data.success || !data.project) {
          throw new Error(data.message || 'å¯¾è±¡ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
        }

        const p = data.project;

        // ç·¨é›†å¯¾è±¡ã®IDã¨registrationIdã‚’ä¿æŒ
        window.__editingId = p.id;
        window.__editingRegistrationId = p.registrationId;

        // ãƒ•ã‚©ãƒ¼ãƒ ã¸åæ˜ 
        setValue('diseaseName', p.diseaseName);
        setValue('diseaseAbbr', p.diseaseAbbr);
        setValue('method', p.method);
        setValue('surveyType', p.surveyType);
        
        // å¯¾è±¡è€…ç¨®åˆ¥ã®è¨­å®š
        const targetTypeSelect = document.getElementById('targetType');
        const standardTypes = ['åŒ»å¸«', 'æ‚£è€…', 'ä»‹è­·è€…', 'åŒ»å¸«ãƒ»æ‚£è€…', 'KOL', 'çœ‹è­·å¸«', 'è–¬å‰¤å¸«', 'ãã®ä»–'];
        if (standardTypes.includes(p.targetType)) {
          targetTypeSelect.value = p.targetType;
          if (p.targetType === 'ãã®ä»–') {
            // ãã®ä»–ã®å ´åˆã¯å…¥åŠ›ãƒœãƒƒã‚¯ã‚¹ã‚’è¡¨ç¤º
            document.getElementById('targetTypeOtherContainer').classList.remove('hidden');
            document.getElementById('targetTypeOther').required = true;
          }
        } else {
          // æ¨™æº–ã‚¿ã‚¤ãƒ—ã«å«ã¾ã‚Œãªã„å ´åˆã¯ã€Œãã®ä»–ã€ã‚’é¸æŠã—ã¦è©³ç´°å…¥åŠ›
          targetTypeSelect.value = 'ãã®ä»–';
          document.getElementById('targetTypeOtherContainer').classList.remove('hidden');
          document.getElementById('targetTypeOther').required = true;
          setValue('targetTypeOther', p.targetType);
        }
        
        setValue('specialtyInput', p.specialty);
        setValue('recruitCount', p.recruitCount);
        document.getElementById('inquiryOnly').checked = (String(p.inquiryOnly) === 'TRUE' || p.inquiryOnly === true);
        setValue('targetConditions', p.targetConditions);
        setValue('drug', p.drug);
        setValue('recruitCompany', p.recruitCompany);
        setValue('moderator', p.moderator);
        setValue('client', p.client);
        setValue('endClient', p.endClient);
        setValue('projectNumber', p.projectNumber);
        // å®Ÿæ–½å¹´æœˆã¯YYYY/MMå½¢å¼ã«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
        setValue('implementationDate', formatImplementationDateForInput(p.implementationDate));

        // â˜…ç™»éŒ²æ‹…å½“ã¯ç©ºæ¬„ã«ã—ã¦ã€ç·¨é›†è€…åã‚’å…¥ã‚Œã•ã›ã‚‹
        setValue('registrant', '');
        const registrantLabel = document.querySelector('label[for="registrant"]');
        if (registrantLabel) {
          registrantLabel.innerHTML = '<i class="fas fa-user-check mr-2 text-teal-600"></i>ç·¨é›†è€…å <span class="text-red-500">*</span>';
        }
        const registrantInput = document.getElementById('registrant');
        if (registrantInput) {
          registrantInput.placeholder = 'ä¾‹: æœ¬ç”°';
        }

        // é€ä¿¡ãƒœã‚¿ãƒ³ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’å¤‰æ›´
        const submitButton = document.querySelector('button[type="submit"]');
        if (submitButton) {
          submitButton.innerHTML = '<i class="fas fa-save"></i><span>ã“ã®å†…å®¹ã§æ›´æ–°ã™ã‚‹</span>';
        }

        // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã‚¨ãƒªã‚¢ã‚’éè¡¨ç¤º
        document.getElementById('successMessage').classList.add('hidden');
        
        console.log('âœ… ãƒ•ã‚©ãƒ¼ãƒ è¨­å®šå®Œäº†');

      } catch (error) {
        console.error('âŒ ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
        
        // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
        let errorMessage = 'ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚';
        
        if (error.name === 'AbortError' || error.name === 'TimeoutError') {
          errorMessage = 'ãƒ‡ãƒ¼ã‚¿å–å¾—ãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸã€‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚’ç¢ºèªã—ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚';
        } else if (error.message) {
          errorMessage += '\n\nè©³ç´°: ' + error.message;
        }
        
        alert('âŒ ' + errorMessage);
        
        // æ¡ˆä»¶ä¸€è¦§ã¸æˆ»ã‚‹
        window.location.href = 'projects.html';
      } finally {
        // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºã‚’éè¡¨ç¤º
        loadingOverlay.classList.add('hidden');
      }
    }

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯
    window.addEventListener('DOMContentLoaded', loadProjectForEdit);

    // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡
    document.getElementById('projectForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ/ã‚¨ãƒ³ãƒ‰ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ã‚«ã‚¹ã‚¿ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
      const client = document.getElementById('client').value.trim();
      const endClient = document.getElementById('endClient').value.trim();
      const clientInput = document.getElementById('client');
      const endClientInput = document.getElementById('endClient');
      
      // ã©ã¡ã‚‰ã‚‚ç©ºã®å ´åˆã¯ã‚¨ãƒ©ãƒ¼
      if (!client && !endClient) {
        clientInput.setCustomValidity('ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¾ãŸã¯ã‚¨ãƒ³ãƒ‰ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ã„ãšã‚Œã‹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        endClientInput.setCustomValidity('ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¾ãŸã¯ã‚¨ãƒ³ãƒ‰ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ã„ãšã‚Œã‹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        
        // ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
        clientInput.reportValidity();
        return;
      } else {
        // ã‚¨ãƒ©ãƒ¼ã‚’ã‚¯ãƒªã‚¢
        clientInput.setCustomValidity('');
        endClientInput.setCustomValidity('');
      }

      // å¯¾è±¡è€…ç¨®åˆ¥ãŒã€ŒåŒ»å¸«ã€ã®å ´åˆã€å°‚é–€ãŒå¿…é ˆ
      const targetTypeSelect = document.getElementById('targetType').value;
      const targetTypeOther = document.getElementById('targetTypeOther').value.trim();
      const finalTargetType = targetTypeSelect === 'ãã®ä»–' ? targetTypeOther : targetTypeSelect;
      const specialtyInput = document.getElementById('specialtyInput');
      const specialtyValue = specialtyInput.value.trim();
      const specialtyCode = document.getElementById('specialtyCode').value;
      
      // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã®åˆ¤å®š
      const isEditMode = window.__editingId != null;
      console.log('ğŸ” ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒã‚§ãƒƒã‚¯ - ç·¨é›†ãƒ¢ãƒ¼ãƒ‰:', isEditMode, 'editingId:', window.__editingId);
      
      // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã§ã¯å°‚é–€ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚¹ã‚­ãƒƒãƒ—ï¼ˆç™»éŒ²æ™‚ã«ãƒã‚§ãƒƒã‚¯æ¸ˆã¿ï¼‰
      if (!isEditMode) {
        console.log('âœ… æ–°è¦ç™»éŒ²ãƒ¢ãƒ¼ãƒ‰: å°‚é–€ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œ');
        // å°‚é–€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆæ–°è¦ç™»éŒ²æ™‚ã®ã¿ï¼‰
        // 1. å¯¾è±¡è€…ç¨®åˆ¥ãŒã€ŒåŒ»å¸«ã€ã®å ´åˆã®å¿…é ˆãƒã‚§ãƒƒã‚¯
        if (finalTargetType === 'åŒ»å¸«') {
          if (!specialtyValue) {
            // å°‚é–€ãŒæœªå…¥åŠ›ã®å ´åˆ
            specialtyInput.setCustomValidity('å¯¾è±¡è€…ç¨®åˆ¥ãŒã€ŒåŒ»å¸«ã€ã®å ´åˆã€å°‚é–€ï¼ˆè¨ºç™‚ç§‘ï¼‰ã®é¸æŠãŒå¿…é ˆã§ã™');
            specialtyInput.reportValidity();
            showErrorMessage('å¯¾è±¡è€…ç¨®åˆ¥ãŒã€ŒåŒ»å¸«ã€ã®å ´åˆã€å°‚é–€ï¼ˆè¨ºç™‚ç§‘ï¼‰ã‚’é¸æŠã—ã¦ãã ã•ã„');
            
            // å°‚é–€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’èµ¤æ ã§å¼·èª¿
            specialtyInput.classList.add('border-red-500');
            specialtyInput.focus();
            return;
          }
        }
        
        // 2. å°‚é–€ã«å…¥åŠ›ãŒã‚ã‚‹å ´åˆã¯ã€å¿…ãšå€™è£œã‹ã‚‰é¸æŠã•ã‚ŒãŸã‚‚ã®ã‹ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆå¯¾è±¡è€…ç¨®åˆ¥ã«é–¢ä¿‚ãªãï¼‰
        if (specialtyValue) {
          if (!specialtyCode) {
            // å°‚é–€ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã‚‹ãŒãƒã‚¹ã‚¿ã‹ã‚‰é¸æŠã•ã‚Œã¦ã„ãªã„å ´åˆï¼ˆæ‰‹å…¥åŠ›ã®ã¾ã¾ã€ã¾ãŸã¯è¤‡æ•°ã‚³ãƒ”ãƒšï¼‰
            specialtyInput.setCustomValidity('è¡¨ç¤ºã•ã‚ŒãŸå€™è£œã®ä¸­ã‹ã‚‰å°‚é–€ï¼ˆè¨ºç™‚ç§‘ï¼‰ã‚’é¸æŠã—ã¦ãã ã•ã„');
            specialtyInput.reportValidity();
            showErrorMessage('å°‚é–€ï¼ˆè¨ºç™‚ç§‘ï¼‰ã¯å€™è£œã®ä¸­ã‹ã‚‰1ã¤é¸æŠã—ã¦ãã ã•ã„ã€‚è¤‡æ•°ã®å°‚é–€ã‚’å…¥åŠ›ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚');
            
            // å°‚é–€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’èµ¤æ ã§å¼·èª¿
            specialtyInput.classList.add('border-red-500');
            specialtyInput.focus();
            return;
          }
        }
      } else {
        console.log('â­ï¸ ç·¨é›†ãƒ¢ãƒ¼ãƒ‰: å°‚é–€ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚¹ã‚­ãƒƒãƒ—');
      }
      
      // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¯ãƒªã‚¢
      specialtyInput.setCustomValidity('');
      specialtyInput.classList.remove('border-red-500');

      // é€ä¿¡ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
      const submitButton = e.target.querySelector('button[type="submit"]');
      const originalText = submitButton.innerHTML;
      submitButton.disabled = true;
      submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>é€ä¿¡ä¸­...</span>';

      // ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’åé›†
      const formData = {
        diseaseName: document.getElementById('diseaseName').value.trim(),
        diseaseAbbr: document.getElementById('diseaseAbbr').value.trim(),
        method: document.getElementById('method').value.trim(),
        surveyType: document.getElementById('surveyType').value.trim(),
        targetType: finalTargetType,
        specialty: specialtyValue,
        recruitCount: parseInt(document.getElementById('recruitCount').value) || 0,
        inquiryOnly: document.getElementById('inquiryOnly').checked,
        targetConditions: document.getElementById('targetConditions').value.trim(),
        drug: document.getElementById('drug').value.trim(),
        recruitCompany: document.getElementById('recruitCompany').value.trim(),
        moderator: document.getElementById('moderator').value.trim(),
        client: client,
        endClient: endClient,
        projectNumber: document.getElementById('projectNumber').value.trim(),
        implementationDate: document.getElementById('implementationDate').value.trim(),
        registrant: document.getElementById('registrant').value.trim()
      };

      // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰åˆ¤å®šï¼ˆä¸Šã§æ—¢ã«å®Ÿè¡Œæ¸ˆã¿ï¼‰
      const action = isEditMode ? 'update' : 'add';

      console.log('ğŸ“ é€ä¿¡ãƒ¢ãƒ¼ãƒ‰:', isEditMode ? 'ç·¨é›†' : 'æ–°è¦ç™»éŒ²');
      console.log('ğŸ“‹ ç·¨é›†ID:', window.__editingId);

      try {
        // âœ… GAS(Webã‚¢ãƒ—ãƒª) ã«POST
        const payload = {
          ...formData,
          action: action,
          clientTimestamp: new Date().toISOString(),
        };

        // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã¯idã¨editorNameã‚’è¿½åŠ 
        if (isEditMode) {
          payload.id = window.__editingId;
          payload.editorName = formData.registrant;
          payload.reason = ''; // ç·¨é›†ç†ç”±ã¯ä»»æ„ï¼ˆå¿…è¦ãªã‚‰å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ ï¼‰
          console.log('âœï¸ ç·¨é›†ãƒ¢ãƒ¼ãƒ‰: ID=' + payload.id + ', editorName=' + payload.editorName);
        }

        // URLã¯GAS_CONFIG.URLã‚’ç›´æ¥ä½¿ç”¨ï¼ˆactionã¯bodyã§é€ã‚‹ï¼‰
        const requestUrl = GAS_CONFIG.TOKEN 
          ? `${GAS_CONFIG.URL}?token=${encodeURIComponent(GAS_CONFIG.TOKEN)}`
          : GAS_CONFIG.URL;

        console.log('ğŸ“¡ é€ä¿¡å…ˆURL:', requestUrl);
        console.log('ğŸ“¦ ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰:', JSON.stringify(payload, null, 2));

        const response = await fetch(requestUrl, {
          method: 'POST',
          headers: {
            'Content-Type': 'text/plain;charset=utf-8',
          },
          body: JSON.stringify(payload),
        });

        // GAS ã‹ã‚‰ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹JSONï¼ˆCORS/å®Ÿè£…å·®åˆ†ã§json()ãŒå¤±æ•—ã—ã¦ã‚‚è½ã¨ã•ãªã„ï¼‰
        console.log('ğŸ“¥ ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:', response.status, response.statusText);
        
        // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ†ã‚­ã‚¹ãƒˆã‚’å–å¾—
        const responseText = await response.text();
        console.log('ğŸ“„ ãƒ¬ã‚¹ãƒãƒ³ã‚¹å†…å®¹:', responseText);
        
        let result = null;
        try {
          result = JSON.parse(responseText);
          console.log('âœ… ãƒ‘ãƒ¼ã‚¹æˆåŠŸ:', result);
        } catch (e) {
          console.error('âŒ JSONãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼:', e);
          result = { success: response.ok };
        }

        if (response.ok && result && result.success) {
          // æˆåŠŸ: ç™»éŒ²/æ›´æ–°æƒ…å ±ã‚’è¡¨ç¤º
          showSuccessMessage(result);
          
          // ãƒ–ãƒ©ã‚¦ã‚¶ã‚¢ãƒ©ãƒ¼ãƒˆã§æˆåŠŸã‚’é€šçŸ¥
          if (isEditMode) {
            alert('âœ… æ­£å¸¸ã«æ›´æ–°ã—ã¾ã—ãŸã€‚');
            // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã¯è©³ç´°ãƒšãƒ¼ã‚¸ã¸æˆ»ã‚‹
            setTimeout(() => {
              window.location.href = `projects.html?id=${window.__editingId}`;
            }, 800);
          } else {
            alert('âœ… æ­£å¸¸ã«ç™»éŒ²ã—ã¾ã—ãŸã€‚å…¥åŠ›ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚');
            // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
            setTimeout(() => {
              resetForm();
            }, 800);
          }
        } else {
          // ã‚¨ãƒ©ãƒ¼: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã‚’è¡¨ç¤º
          if (result && result.details) {
            showValidationErrors(result.details);
          } else {
            showErrorMessage((result && (result.message || result.error)) || 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
          }
        }
      } catch (error) {
        console.error('API Error:', error);
        showErrorMessage('é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
      } finally {
        // é€ä¿¡ãƒœã‚¿ãƒ³ã‚’å†åº¦æœ‰åŠ¹åŒ–
        submitButton.disabled = false;
        submitButton.innerHTML = originalText;
      }
    });

    // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
    function resetForm() {
      document.getElementById('projectForm').reset();
      // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã‚’ã‚¯ãƒªã‚¢
      document.querySelectorAll('.error-text').forEach(el => el.remove());
      document.querySelectorAll('.border-red-500').forEach(el => {
        el.classList.remove('border-red-500');
        el.classList.add('border-gray-300');
      });
      // å¯¾è±¡è€…ç¨®åˆ¥ã€Œãã®ä»–ã€ã®å…¥åŠ›ãƒœãƒƒã‚¯ã‚¹ã‚’éè¡¨ç¤ºã«
      document.getElementById('targetTypeOtherContainer').classList.add('hidden');
      document.getElementById('targetTypeOther').required = false;
    }

    // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
    function showSuccessMessage(result) {
      const element = document.getElementById('successMessage');

      const idEl = document.getElementById('savedId');
      const regEl = document.getElementById('savedRegistrationId');
      const projectLink = document.getElementById('projectLink');

      if (idEl) idEl.textContent = result.id != null ? String(result.id) : '-';
      if (regEl) regEl.textContent = result.registrationId ? String(result.registrationId) : '-';

      if (projectLink) {
        projectLink.href = result.id != null ? `projects.html?id=${encodeURIComponent(result.id)}` : 'projects.html';
      }

      element.classList.remove('hidden');
      // è‡ªå‹•çš„ã«éè¡¨ç¤ºã«ã—ãªã„ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç¢ºèªã™ã‚‹ã¾ã§è¡¨ç¤ºï¼‰
    }

    function hideSuccessMessage() {
      document.getElementById('successMessage').classList.add('hidden');
    }

    // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
    function showValidationErrors(errors) {
      // æ—¢å­˜ã®ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã‚’ã‚¯ãƒªã‚¢
      document.querySelectorAll('.error-text').forEach(el => el.remove());
      document.querySelectorAll('.border-red-500').forEach(el => {
        el.classList.remove('border-red-500');
        el.classList.add('border-gray-300');
      });

      // å„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ã‚¨ãƒ©ãƒ¼ã‚’è¡¨ç¤º
      Object.entries(errors).forEach(([field, message]) => {
        const input = document.getElementById(field);
        if (input) {
          // å…¥åŠ›æ¬„ã‚’èµ¤æ ã«
          input.classList.remove('border-gray-300');
          input.classList.add('border-red-500');
          
          // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿½åŠ 
          const errorDiv = document.createElement('p');
          errorDiv.className = 'error-text text-xs text-red-500 mt-1';
          errorDiv.textContent = message;
          input.parentElement.appendChild(errorDiv);
        }
      });

      // ä¸€èˆ¬çš„ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚‚è¡¨ç¤º
      showErrorMessage('å…¥åŠ›å†…å®¹ã«èª¤ã‚ŠãŒã‚ã‚Šã¾ã™ã€‚èµ¤å­—ã®é …ç›®ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
    }

    // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
    function showErrorMessage(message) {
      const element = document.getElementById('errorMessage');
      document.getElementById('errorText').textContent = message;
      element.classList.remove('hidden');
      
      setTimeout(hideErrorMessage, 5000);
    }

    function hideErrorMessage() {
      document.getElementById('errorMessage').classList.add('hidden');
    }

    // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹JSã®èª­ã¿è¾¼ã¿ã‚’å‰Šé™¤ï¼ˆã‚‚ã†LocalStorageã‚’ä½¿ã‚ãªã„ï¼‰
    
    // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ/ã‚¨ãƒ³ãƒ‰ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    (function setupClientValidation() {
      const clientInput = document.getElementById('client');
      const endClientInput = document.getElementById('endClient');
      
      function clearClientValidation() {
        const client = clientInput.value.trim();
        const endClient = endClientInput.value.trim();
        
        // ã©ã¡ã‚‰ã‹ã«å…¥åŠ›ãŒã‚ã‚Œã°ã‚¨ãƒ©ãƒ¼ã‚’ã‚¯ãƒªã‚¢
        if (client || endClient) {
          clientInput.setCustomValidity('');
          endClientInput.setCustomValidity('');
        }
      }
      
      // å…¥åŠ›æ™‚ã«ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒªã‚¢
      clientInput.addEventListener('input', clearClientValidation);
      endClientInput.addEventListener('input', clearClientValidation);
    })();

    // å¯¾è±¡è€…ç¨®åˆ¥ã€Œãã®ä»–ã€ã®è¡¨ç¤º/éè¡¨ç¤ºã¨ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    (function setupTargetTypeOther() {
      const targetTypeSelect = document.getElementById('targetType');
      const otherContainer = document.getElementById('targetTypeOtherContainer');
      const otherInput = document.getElementById('targetTypeOther');
      const specialtyRequired = document.getElementById('specialtyRequired');
      const specialtyInput = document.getElementById('specialtyInput');
      
      // é¸æŠå¤‰æ›´æ™‚ã®å‡¦ç†
      targetTypeSelect.addEventListener('change', function() {
        if (this.value === 'ãã®ä»–') {
          // ãã®ä»–ã‚’é¸æŠæ™‚ï¼šå…¥åŠ›ãƒœãƒƒã‚¯ã‚¹ã‚’è¡¨ç¤ºã—ã€å¿…é ˆåŒ–
          otherContainer.classList.remove('hidden');
          otherInput.required = true;
        } else {
          // ãã®ä»–ä»¥å¤–ã‚’é¸æŠæ™‚ï¼šå…¥åŠ›ãƒœãƒƒã‚¯ã‚¹ã‚’éè¡¨ç¤ºã«ã—ã€å¿…é ˆã‚’è§£é™¤
          otherContainer.classList.add('hidden');
          otherInput.required = false;
          otherInput.value = ''; // å…¥åŠ›å†…å®¹ã‚’ã‚¯ãƒªã‚¢
        }
        
        // å¯¾è±¡è€…ç¨®åˆ¥ãŒã€ŒåŒ»å¸«ã€ã®å ´åˆã€å°‚é–€ã«å¿…é ˆãƒãƒ¼ã‚¯ã‚’è¡¨ç¤º
        const finalTargetType = (this.value === 'ãã®ä»–') ? otherInput.value.trim() : this.value;
        if (finalTargetType === 'åŒ»å¸«') {
          specialtyRequired.style.display = 'inline';
          specialtyInput.setAttribute('aria-required', 'true');
        } else {
          specialtyRequired.style.display = 'none';
          specialtyInput.removeAttribute('aria-required');
        }
      });
      
      // ã€Œãã®ä»–ã€å…¥åŠ›æ™‚ã«ã‚‚åŒ»å¸«ã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯
      otherInput.addEventListener('input', function() {
        if (targetTypeSelect.value === 'ãã®ä»–') {
          if (this.value.trim() === 'åŒ»å¸«') {
            specialtyRequired.style.display = 'inline';
            specialtyInput.setAttribute('aria-required', 'true');
          } else {
            specialtyRequired.style.display = 'none';
            specialtyInput.removeAttribute('aria-required');
          }
        }
      });
    })();

    // å°‚é–€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¯ãƒªã‚¢
    (function setupSpecialtyValidation() {
      const specialtyInput = document.getElementById('specialtyInput');
      const targetTypeSelect = document.getElementById('targetType');
      
      // å°‚é–€å…¥åŠ›æ™‚ã«ã‚¨ãƒ©ãƒ¼çŠ¶æ…‹ã‚’ã‚¯ãƒªã‚¢
      specialtyInput.addEventListener('input', function() {
        this.setCustomValidity('');
        this.classList.remove('border-red-500');
        hideErrorMessage();
      });
      
      // å¯¾è±¡è€…ç¨®åˆ¥å¤‰æ›´æ™‚ã«ã‚‚å°‚é–€ã®ã‚¨ãƒ©ãƒ¼çŠ¶æ…‹ã‚’ã‚¯ãƒªã‚¢
      targetTypeSelect.addEventListener('change', function() {
        specialtyInput.setCustomValidity('');
        specialtyInput.classList.remove('border-red-500');
      });
    })();

    // å®Ÿç¸¾æ•°ï¼ˆãƒªã‚¯ãƒ«ãƒ¼ãƒˆäººæ•°ï¼‰ã¯åŠè§’æ•°å­—ã®ã¿å—ã‘ä»˜ã‘ã‚‹
    (function setupRecruitCountValidation() {
      const recruitCountInput = document.getElementById('recruitCount');
      
      // å…¥åŠ›æ™‚ã«åŠè§’æ•°å­—ä»¥å¤–ã‚’é™¤å»
      recruitCountInput.addEventListener('input', function(e) {
        // ç¾åœ¨ã®å€¤ã‹ã‚‰åŠè§’æ•°å­—ä»¥å¤–ã‚’å‰Šé™¤
        this.value = this.value.replace(/[^0-9]/g, '');
      });
      
      // ã‚­ãƒ¼å…¥åŠ›æ™‚ã«åŠè§’æ•°å­—ã€åˆ¶å¾¡ã‚­ãƒ¼ä»¥å¤–ã‚’ãƒ–ãƒ­ãƒƒã‚¯
      recruitCountInput.addEventListener('keydown', function(e) {
        // è¨±å¯ã™ã‚‹ã‚­ãƒ¼: æ•°å­—ã€ãƒãƒƒã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã€ãƒ‡ãƒªãƒ¼ãƒˆã€ã‚¿ãƒ–ã€ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã€ã‚¨ãƒ³ã‚¿ãƒ¼ã€çŸ¢å°ã‚­ãƒ¼
        const allowedKeys = ['Backspace', 'Delete', 'Tab', 'Escape', 'Enter', 'ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown'];
        const isNumber = (e.key >= '0' && e.key <= '9');
        const isAllowedKey = allowedKeys.includes(e.key);
        const isCtrlA = (e.key === 'a' && (e.ctrlKey || e.metaKey)); // Ctrl+A (å…¨é¸æŠ)
        const isCtrlC = (e.key === 'c' && (e.ctrlKey || e.metaKey)); // Ctrl+C (ã‚³ãƒ”ãƒ¼)
        const isCtrlV = (e.key === 'v' && (e.ctrlKey || e.metaKey)); // Ctrl+V (ãƒšãƒ¼ã‚¹ãƒˆ)
        const isCtrlX = (e.key === 'x' && (e.ctrlKey || e.metaKey)); // Ctrl+X (ã‚«ãƒƒãƒˆ)
        
        if (!isNumber && !isAllowedKey && !isCtrlA && !isCtrlC && !isCtrlV && !isCtrlX) {
          e.preventDefault();
        }
      });
      
      // ãƒšãƒ¼ã‚¹ãƒˆæ™‚ã«åŠè§’æ•°å­—ä»¥å¤–ã‚’é™¤å»
      recruitCountInput.addEventListener('paste', function(e) {
        e.preventDefault();
        const pastedText = (e.clipboardData || window.clipboardData).getData('text');
        const numericOnly = pastedText.replace(/[^0-9]/g, '');
        
        // ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®ã«æ•°å­—ã®ã¿ã‚’æŒ¿å…¥
        const start = this.selectionStart;
        const end = this.selectionEnd;
        const currentValue = this.value;
        this.value = currentValue.slice(0, start) + numericOnly + currentValue.slice(end);
        
        // ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®ã‚’æ›´æ–°
        const newPosition = start + numericOnly.length;
        this.setSelectionRange(newPosition, newPosition);
      });
    })();
  </script>
</body>
</html>
