<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>音声ファイル書き起こしツール</title>
<style>
  body { font-family: Arial, sans-serif; margin: 30px; }
  input, button { margin: 10px 0; }
  #status { margin-top: 10px; color: #333; }
</style>
</head>
<body>

<h2>音声ファイル書き起こしツール</h2>
<p>音声ファイルを選択して「書き起こし開始！」を押すと、自動でTXTファイルがダウンロードされます。</p>

<input type="file" id="audioFile" accept="audio/*">
<br>
<button id="transcribeBtn">書き起こし開始！</button>
<div id="status"></div>

<script>
const API_KEY = "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"; // ← 必ず入れて

document.getElementById("transcribeBtn").addEventListener("click", async () => {
    const fileInput = document.getElementById("audioFile");
    const statusDiv = document.getElementById("status");

    if (!fileInput.files.length) {
        alert("音声ファイルを選択してください。");
        return;
    }

    const file = fileInput.files[0];
    statusDiv.textContent = "書き起こし中…しばらくお待ちください。";

    try {
        const formData = new FormData();
        formData.append("file", file);
        formData.append("model", "whisper-1");
        formData.append("language", "ja");

        const response = await fetch("https://api.openai.com/v1/audio/transcriptions", {
            method: "POST",
            headers: { "Authorization": `Bearer ${API_KEY}` },
            body: formData
        });

        if (!response.ok) throw new Error("書き起こしAPIリクエストに失敗しました。");

        const data = await response.json();
        const transcriptText = data.text;

        // ファイル名を生成
        const timestamp = new Date().toISOString().replace(/[:.]/g, "-");
        const filename = `transcript_${timestamp}.txt`;

        // TXTファイルをダウンロード
        const blob = new Blob([transcriptText], { type: "text/plain" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        statusDiv.textContent = "書き起こし完了！ダウンロードが始まりました。";

    } catch (err) {
        console.error(err);
        statusDiv.textContent = "エラーが発生しました。コンソールを確認してください。";
    }
});
</script>

</body>
</html>