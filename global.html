<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>42期・43期（3-2月決算）売上インフォグラフィック｜B3のみ</title>
  <!-- React + ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <!-- Recharts -->
  <script src="https://unpkg.com/recharts/umd/Recharts.min.js"></script>
  <!-- Tailwind (CDN) for quick styling) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background:#fff; }
    .card { border-radius:1rem; box-shadow: 0 1px 2px rgba(0,0,0,.06), 0 4px 12px rgba(0,0,0,.06); }
  </style>
</head>
<body class="min-h-screen p-6 md:p-10">
  <div id="app" class="max-w-6xl mx-auto"></div>

  <script>
  const {useMemo, useState} = React;
  const { ResponsiveContainer, LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, PieChart, Pie, Cell } = Recharts;

  // ===== 集計済みデータ（/mnt/data のExcelから算出） =====
  const DATA = {
    monthly_total: %MONTHLY_TOTAL%,
    tlg_series: %TLG_SERIES%,
    holden_series: %HOLDEN_SERIES%,
    pie_42_all: %PIE42_ALL%,
    pie_43_all: %PIE43_ALL%,
    months_43: %MONTHS_43%
  };

  const COLORS = {
    k42: "#2563eb", // 42期
    k43: "#f97316", // 43期
    tlg: "#10b981", // TLG
    holden: "#8b5cf6", // Holden
    grid: "#e5e7eb",
  };
  const PALETTE = [
    "#10b981", "#8b5cf6", "#ef4444", "#3b82f6", "#f59e0b", "#14b8a6", "#a855f7", "#84cc16", "#06b6d4", "#f97316", "#64748b"
  ];
  const yen = (v) => typeof v === 'number' ? '¥' + v.toLocaleString() : '-';

  function clipFY(rows, allowed) {
    const allow = new Set(allowed.map(String));
    return rows.map(r => ({ ...r, "43期": allow.has(String(parseInt(r.月))) ? r["43期"] : null }));
  }

  function SectionTitle({children}){
    return <h2 class="text-lg font-semibold mb-1">{children}</h2>;
  }

  function App(){
    const [showLabels, setShowLabels] = useState(false);

    const monthly = useMemo(() => clipFY(DATA.monthly_total, DATA.months_43), []);
    const tlg = useMemo(() => clipFY(DATA.tlg_series, DATA.months_43), []);
    const holden = useMemo(() => clipFY(DATA.holden_series, DATA.months_43), []);

    return (
      <div class="space-y-8">
        <header>
          <h1 class="text-2xl md:text-3xl font-bold tracking-tight">42期・43期（3-2月決算）売上インフォグラフィック（B3のみ）</h1>
          <p class="text-sm text-gray-600 mt-1">会計期：3→2月。<span class="font-mono">担G1=B3</span>／税抜。43期は <span class="font-semibold">3–7月</span> のみ表示。</p>
        </header>

        <div class="flex items-center gap-3">
          <button class="border px-3 py-1.5 rounded-2xl" onclick={() => setShowLabels(v=>!v)}>
            {showLabels ? '値ラベルを隠す' : '値ラベルを表示'}
          </button>
          <span class="text-gray-500 text-sm">凡例クリックで系列の表示切替ができます</span>
        </div>

        <!-- 1) 期別（FY）月次売上推移 -->
        <div class="card p-4">
          <SectionTitle>42期 vs 43期：月次売上推移（FY 3→2）</SectionTitle>
          <div style={{height:'320px'}}>
            <ResponsiveContainer>
              <LineChart data={monthly} margin={{ top: 10, right: 24, bottom: 0, left: 0 }}>
                <CartesianGrid strokeDasharray="3 3" stroke={COLORS.grid} />
                <XAxis dataKey="月" />
                <YAxis tickFormatter={(v) => `${(v/100000000).toFixed(1)}億`} />
                <Tooltip formatter={(v) => yen(Number(v))} />
                <Legend />
                <Line type="monotone" dataKey="42期" stroke={COLORS.k42} strokeWidth={2.2} dot={{ r: 3 }} />
                <Line type="monotone" dataKey="43期" stroke={COLORS.k43} strokeWidth={2.2} dot={{ r: 3 }} />
              </LineChart>
            </ResponsiveContainer>
          </div>
        </div>

        <!-- 2) クライアント別：TLG / Holden -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="card p-4">
            <SectionTitle>TLG：月次売上推移（FY 3→2）</SectionTitle>
            <div style={{height:'280px'}}>
              <ResponsiveContainer>
                <LineChart data={tlg} margin={{ top: 10, right: 24, bottom: 0, left: 0 }}>
                  <CartesianGrid strokeDasharray="3 3" stroke={COLORS.grid} />
                  <XAxis dataKey="月" />
                  <YAxis tickFormatter={(v) => `${(v/100000000).toFixed(1)}億`} />
                  <Tooltip formatter={(v) => yen(Number(v))} />
                  <Legend />
                  <Line type="monotone" dataKey="42期" stroke={COLORS.k42} strokeWidth={2.2} dot={{ r: 3 }} />
                  <Line type="monotone" dataKey="43期" stroke={COLORS.k43} strokeWidth={2.2} dot={{ r: 3 }} />
                </LineChart>
              </ResponsiveContainer>
            </div>
          </div>

          <div class="card p-4">
            <SectionTitle>Holden：月次売上推移（FY 3→2）</SectionTitle>
            <div style={{height:'280px'}}>
              <ResponsiveContainer>
                <LineChart data={holden} margin={{ top: 10, right: 24, bottom: 0, left: 0 }}>
                  <CartesianGrid strokeDasharray="3 3" stroke={COLORS.grid} />
                  <XAxis dataKey="月" />
                  <YAxis tickFormatter={(v) => `${(v/100000000).toFixed(1)}億`} />
                  <Tooltip formatter={(v) => yen(Number(v))} />
                  <Legend />
                  <Line type="monotone" dataKey="42期" stroke={COLORS.k42} strokeWidth={2.2} dot={{ r: 3 }} />
                  <Line type="monotone" dataKey="43期" stroke={COLORS.k43} strokeWidth={2.2} dot={{ r: 3 }} />
                </LineChart>
              </ResponsiveContainer>
            </div>
          </div>
        </div>

        <!-- 3) 全クライアント構成（トップ10 + その他） -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="card p-4">
            <SectionTitle>42期：全クライアント売上構成（B3）</SectionTitle>
            <div style={{height:'300px'}}>
              <ResponsiveContainer>
                <PieChart>
                  <Tooltip formatter={(v) => yen(Number(v))} />
                  <Legend />
                  <Pie data={DATA.pie_42_all.map(d=>({name:d.組織2||d.name, value:d.売上||d.value}))} dataKey="value" nameKey="name" cx="50%" cy="50%" outerRadius={110} label={showLabels}>
                    {DATA.pie_42_all.map((_, i) => (
                      <Cell key={`p42-${i}`} fill={PALETTE[i % PALETTE.length]} />
                    ))}
                  </Pie>
                </PieChart>
              </ResponsiveContainer>
            </div>
          </div>

          <div class="card p-4">
            <SectionTitle>43期（3–7月）：全クライアント売上構成（B3）</SectionTitle>
            <div style={{height:'300px'}}>
              <ResponsiveContainer>
                <PieChart>
                  <Tooltip formatter={(v) => yen(Number(v))} />
                  <Legend />
                  <Pie data={DATA.pie_43_all.map(d=>({name:d.組織2||d.name, value:d.売上||d.value}))} dataKey="value" nameKey="name" cx="50%" cy="50%" outerRadius={110} label={showLabels}>
                    {DATA.pie_43_all.map((_, i) => (
                      <Cell key={`p43-${i}`} fill={PALETTE[i % PALETTE.length]} />
                    ))}
                  </Pie>
                </PieChart>
              </ResponsiveContainer>
            </div>
          </div>
        </div>
      </div>
    );
  }

  const container = document.getElementById('app');
  const root = ReactDOM.createRoot(container);
  root.render(React.createElement(App));
  </script>

  <script>
    // 置換: Pythonで生成したJSONを埋め込み
  </script>
</body>
</html>
