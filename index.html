<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Japan Healthcare Market Research — FAQ | Seed Planning</title>
<meta name="description" content="Comprehensive FAQ for conducting healthcare market research in Japan. Patients, HCP, System, Compliance, Fieldwork, Operations, Timeline." />
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><circle cx=%2250%22 cy=%2250%22 r=%2248%22 fill=%22%235baaae%22/><text x=%2250%22 y=%2263%22 font-size=%2255%22 text-anchor=%22middle%22 fill=%22white%22 font-family=%22Arial%22>SP</text></svg>">
<style>
  :root{
    --bg:#ffffff; --ink:#21343b; --muted:#5e7a85; --line:#e6eff1;
    --accent:#2f6f7e; --accent-2:#5baaae; --chip:#edf7f7; --mark:#fff3b0;
    --radius:14px; --radius-sm:10px; --shadow:0 6px 24px rgba(24,60,70,.08)
  }
  html,body{margin:0;background:var(--bg);color:var(--ink);
    font-family:"Inter","Noto Sans","Noto Sans JP",system-ui,-apple-system,Segoe UI,Roboto,Arial;
    line-height:1.7}
  a{color:var(--accent);text-decoration:none}
  a:hover{text-decoration:underline}
  /* Header */
  header{position:sticky;top:0;z-index:50;background:rgba(255,255,255,.9);
    backdrop-filter:saturate(160%) blur(10px);border-bottom:1px solid var(--line)}
  .wrap{max-width:1120px;margin:0 auto;padding:18px 20px}
  .topbar{display:flex;align-items:center;gap:16px;justify-content:space-between;flex-wrap:wrap}
  .brand{display:flex;align-items:center;gap:12px}
  .brand img{height:34px}
  .brand .title{font-weight:700;letter-spacing:.2px}
  /* Search */
  .search{position:relative;flex:1 1 520px;max-width:720px;display:flex;align-items:center;gap:10px;background:#fff;border:1px solid var(--line);border-radius:999px;padding:10px 14px;box-shadow:var(--shadow)}
  .search input{flex:1;border:0;outline:0;font-size:16px;background:transparent;padding:6px 2px}
  .search .kbd{font-size:12px;color:var(--muted);border:1px solid var(--line);padding:2px 6px;border-radius:6px}
  .suggest{position:absolute;top:54px;left:0;right:0;background:#fff;border:1px solid var(--line);border-radius:12px;box-shadow:var(--shadow);overflow:hidden;display:none;max-height:380px;overflow-y:auto}
  .suggest.visible{display:block}
  .s-item{padding:12px 14px;border-bottom:1px solid var(--line);cursor:pointer}
  .s-item:last-child{border-bottom:0}
  .s-title{font-weight:600}
  .s-snippet{font-size:13px;color:var(--muted)}
  /* Chips */
  .chips{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
  .chip{background:var(--chip);color:var(--accent);border:1px solid #d9ecec;padding:6px 10px;border-radius:999px;font-size:12px}
  /* Sections */
  h2.section-title{margin:30px 0 14px;padding-bottom:8px;border-bottom:2px solid var(--accent-2);display:flex;align-items:center;gap:10px}
  .badge{font-size:12px;background:var(--chip);color:var(--accent);border:1px solid #d9ecec;padding:2px 8px;border-radius:999px}
  .faq-grid{display:grid;grid-template-columns:1fr;gap:14px}
  @media (min-width:860px){.faq-grid{grid-template-columns:1fr 1fr}}
  article.faq{background:#fff;border:1px solid var(--line);border-radius:var(--radius-sm);padding:16px;box-shadow:var(--shadow);scroll-margin-top:110px}
  .q{font-weight:700;margin:0 0 8px;font-size:18px}
  .a{margin:0 0 8px;color:var(--muted)}
  .meta{display:flex;align-items:center;gap:8px;flex-wrap:wrap;margin-top:8px}
  .tag{font-size:12px;color:var(--muted)}
  .back{margin-left:auto;font-size:13px}
  mark{background:var(--mark);padding:0 .2em}
  footer.site{margin:36px 0 80px;color:var(--muted);font-size:13px;text-align:center}
  :focus-visible{outline:3px solid #bfe3e6;outline-offset:2px}
</style>
</head>
<body>
<header>
  <div class="wrap topbar">
    <div class="brand">
      <img src="seed-planning-logo.png" alt="Seed Planning" onerror="this.style.display='none'">
      <div class="title">Japan Healthcare Market Research — FAQ</div>
    </div>
    <div class="search" role="search" aria-label="Search FAQ">
      <svg aria-hidden="true" width="18" height="18" viewBox="0 0 24 24"><path fill="currentColor" d="M10 2a8 8 0 0 1 6.32 12.906l4.387 4.387l-1.414 1.414l-4.387-4.387A8 8 0 1 1 10 2m0 2a6 6 0 1 0 0 12a6 6 0 0 0 0-12"/></svg>
      <input id="search" type="search" placeholder="Search keywords (title & content)..." autocomplete="off" />
      <div class="kbd">/</div>
      <div id="suggest" class="suggest" role="listbox" aria-label="Search suggestions"></div>
    </div>
  </div>
</header>

<div class="wrap">
  <div id="intro" class="intro">
    <p><strong>Purpose.</strong> Use the search above or browse by section. Click a question to open its dedicated page.</p>
    <div class="chips" aria-label="Quick filters">
      <a class="chip" href="#Patients">Patients</a>
      <a class="chip" href="#HCP">HCP</a>
      <a class="chip" href="#System">System</a>
      <a class="chip" href="#Compliance">Compliance</a>
      <a class="chip" href="#Fieldwork">Fieldwork</a>
      <a class="chip" href="#Operations">Operations</a>
      <a class="chip" href="#Timeline">Timeline</a>
    </div>
  </div>

  <!-- Sections (auto-populated) -->
  <!-- 一番上に追加 -->
  <section id="All"><h2 class="section-title">All <span class="badge" id="count-All"></span></h2><div class="faq-grid" data-section="All"></div></section>
  <section id="Patients"><h2 class="section-title">Patients <span class="badge" id="count-Patients"></span></h2><div class="faq-grid" data-section="Patients"></div></section>
  <section id="HCP"><h2 class="section-title">HCP <span class="badge" id="count-HCP"></span></h2><div class="faq-grid" data-section="HCP"></div></section>
  <section id="System"><h2 class="section-title">System <span class="badge" id="count-System"></span></h2><div class="faq-grid" data-section="System"></div></section>
  <section id="Compliance"><h2 class="section-title">Compliance <span class="badge" id="count-Compliance"></span></h2><div class="faq-grid" data-section="Compliance"></div></section>
  <section id="Fieldwork"><h2 class="section-title">Fieldwork <span class="badge" id="count-Fieldwork"></span></h2><div class="faq-grid" data-section="Fieldwork"></div></section>
  <section id="Operations"><h2 class="section-title">Operations <span class="badge" id="count-Operations"></span></h2><div class="faq-grid" data-section="Operations"></div></section>
  <section id="Timeline"><h2 class="section-title">Timeline <span class="badge" id="count-Timeline"></span></h2><div class="faq-grid" data-section="Timeline"></div></section>
  <section id="Uncategorized"><h2 class="section-title">Uncategorized <span class="badge" id="count-Uncategorized"></span></h2><div class="faq-grid" data-section="Uncategorized"></div></section>
  <footer class="site"><p>© <span id="year"></span> Seed Planning.</p></footer>
</div>

<!-- Load data -->
<script src="data/faqs.js"></script>

<script src="data/faqs.js"></script>

<script>
// ===== CSV + JS merge（CSV優先） =====
async function fetchCSV(u){
  const res = await fetch(u+(u.includes("?")?"&":"?")+"v="+Date.now(),{cache:"no-store"});
  if(!res.ok) return []; const t=await res.text(); return parseCSV(t);
}
function parseCSV(text){
  const rows=[], out=[]; let cur=[''], q=false; const s=String(text||'');
  for(let i=0;i<s.length;i++){
    const c=s[i];
    if(q){ if(c=='"'){ if(s[i+1]=='"'){cur[cur.length-1]+='"'; i++;} else q=false; } else cur[cur.length-1]+=c; }
    else { if(c=='"') q=true; else if(c==',') cur.push(''); else if(c=='\n'||c=='\r'){ if(cur.length>1||cur[0]!=='') rows.push(cur); cur=['']; } else cur[cur.length-1]+=c; }
  }
  if(cur.length>1||cur[0]!=='') rows.push(cur);
  if(!rows.length) return [];
  const head=rows[0].map(h=>h.trim());
  for(let i=1;i<rows.length;i++){
    const r=rows[i], o={}; head.forEach((h,k)=>o[h]=(r[k]??'').trim());
    if(o.categories) o.categories=o.categories.split(/\s*[;|,]\s*/).filter(Boolean);
    out.push(o);
  }
  return out;
}
function jsFAQs(){
  try { if (Array.isArray(window.FAQS) && window.FAQS.length) return window.FAQS; } catch(_){}
  try { if (typeof FAQS !== 'undefined' && Array.isArray(FAQS) && FAQS.length) return FAQS; } catch(_){}
  return [];
}

const SECTIONS = ["All","Patients","HCP","System","Compliance","Fieldwork","Operations","Timeline","Uncategorized"];
const DATA_PROMISE = (async ()=>{
  let csv=[]; try{ csv=await fetchCSV("data/index.csv"); }catch(_){}
  const js = jsFAQs();
  const m=new Map();
  js.forEach(x=>x&&x.id&&m.set(String(x.id),x));
  csv.forEach(x=>x&&x.id&&m.set(String(x.id),x)); // CSV優先
  const arr=[...m.values()].map(x=>{
    if(x.categories && !Array.isArray(x.categories)){
      x.categories=String(x.categories).split(/\s*[;|,]\s*/).filter(Boolean);
    }
    return x;
  });
  return arr;
})();

function escapeHTML(s){return String(s||'').replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m]));}
function cardHtml(f){
  const link=`articles.html?id=${encodeURIComponent(f.id)}`;
  const tags=(f.categories||[]).map(c=>`<span class="tag">#${escapeHTML(c)}</span>`).join(' ');
  const a=String(f.answer||''); const preview=a.length>150?a.slice(0,150)+'…':a;
  return `<article class="faq" tabindex="0">
    <h3 class="q"><a href="${link}">${escapeHTML(f.question)}</a></h3>
    <p class="a">${escapeHTML(preview)}</p>
    <div class="meta">${tags} <a class="back" href="${link}" aria-label="Read: ${escapeHTML(f.question)}">Read</a></div>
  </article>`;
}
async function renderSections(){
  const FAQS = await DATA_PROMISE;
  const counts=Object.fromEntries(SECTIONS.map(s=>[s,0]));
  SECTIONS.forEach(section=>{
    const grid=document.querySelector(`.faq-grid[data-section="${section}"]`);
    if(!grid) return;
    let list=[];
    if(section==="All"){
      list=FAQS;
    }else if(section==="Uncategorized"){
      list=FAQS.filter(f=>!Array.isArray(f.categories) || f.categories.length===0);
    }else{
      list=FAQS.filter(f=>Array.isArray(f.categories) && f.categories.includes(section));
    }
    grid.innerHTML=list.map(cardHtml).join('');
    counts[section]=list.length;
    const badge=document.getElementById('count-'+section);
    if(badge) badge.textContent=String(list.length);
  });
}
document.getElementById('year').textContent=new Date().getFullYear();
renderSections();
</script>
</body>
</html>

