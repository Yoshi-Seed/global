<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Japan Healthcare Market Research — FAQ | Seed Planning</title>
<meta name="description" content="Comprehensive FAQ for conducting healthcare market research in Japan. Patients, HCP, System, Compliance, Fieldwork, Operations, Timeline." />
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><circle cx=%2250%22 cy=%2250%22 r=%2248%22 fill=%22%235baaae%22/><text x=%2250%22 y=%2263%22 font-size=%2255%22 text-anchor=%22middle%22 fill=%22white%22 font-family=%22Arial%22>SP</text></svg>">
<style>
  :root{
    --bg:#ffffff; --ink:#21343b; --muted:#5e7a85; --line:#e6eff1;
    --accent:#2f6f7e; --accent-2:#5baaae; --chip:#edf7f7; --mark:#fff3b0;
    --radius:14px; --radius-sm:10px; --shadow:0 6px 24px rgba(24,60,70,.08)
  }
  html,body{margin:0;background:var(--bg);color:var(--ink);
    font-family:"Inter","Noto Sans","Noto Sans JP",system-ui,-apple-system,Segoe UI,Roboto,Arial;
    line-height:1.7}
  a{color:var(--accent);text-decoration:none}
  a:hover{text-decoration:underline}
  /* Header */
  header{position:sticky;top:0;z-index:50;background:rgba(255,255,255,.9);
    backdrop-filter:saturate(160%) blur(10px);border-bottom:1px solid var(--line)}
  .wrap{max-width:1120px;margin:0 auto;padding:18px 20px}
  .topbar{display:flex;align-items:center;gap:16px;justify-content:space-between;flex-wrap:wrap}
  .brand{display:flex;align-items:center;gap:12px}
  .brand img{height:34px}
  .brand .title{font-weight:700;letter-spacing:.2px}
  /* Search */
  .search{position:relative;flex:1 1 520px;max-width:720px;display:flex;align-items:center;gap:10px;background:#fff;border:1px solid var(--line);border-radius:999px;padding:10px 14px;box-shadow:var(--shadow)}
  .search input{flex:1;border:0;outline:0;font-size:16px;background:transparent;padding:6px 2px}
  .search .kbd{font-size:12px;color:var(--muted);border:1px solid var(--line);padding:2px 6px;border-radius:6px}
  .suggest{position:absolute;top:54px;left:0;right:0;background:#fff;border:1px solid var(--line);border-radius:12px;box-shadow:var(--shadow);overflow:hidden;display:none;max-height:380px;overflow-y:auto}
  .suggest.visible{display:block}
  .s-item{padding:12px 14px;border-bottom:1px solid var(--line);cursor:pointer}
  .s-item:last-child{border-bottom:0}
  .s-title{font-weight:600}
  .s-snippet{font-size:13px;color:var(--muted)}
  /* Chips */
  .chips{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
  .chip{background:var(--chip);color:var(--accent);border:1px solid #d9ecec;padding:6px 10px;border-radius:999px;font-size:12px}
  /* Sections */
  h2.section-title{margin:30px 0 14px;padding-bottom:8px;border-bottom:2px solid var(--accent-2);display:flex;align-items:center;gap:10px}
  .badge{font-size:12px;background:var(--chip);color:var(--accent);border:1px solid #d9ecec;padding:2px 8px;border-radius:999px}
  .faq-grid{display:grid;grid-template-columns:1fr;gap:14px}
  @media (min-width:860px){.faq-grid{grid-template-columns:1fr 1fr}}
  article.faq{background:#fff;border:1px solid var(--line);border-radius:var(--radius-sm);padding:16px;box-shadow:var(--shadow);scroll-margin-top:110px}
  .q{font-weight:700;margin:0 0 8px;font-size:18px}
  .a{margin:0 0 8px;color:var(--muted)}
  .meta{display:flex;align-items:center;gap:8px;flex-wrap:wrap;margin-top:8px}
  .tag{font-size:12px;color:var(--muted)}
  .back{margin-left:auto;font-size:13px}
  mark{background:var(--mark);padding:0 .2em}
  footer.site{margin:36px 0 80px;color:var(--muted);font-size:13px;text-align:center}
  :focus-visible{outline:3px solid #bfe3e6;outline-offset:2px}
</style>
</head>
<body>
<header>
  <div class="wrap topbar">
    <div class="brand">
      <img src="seed-planning-logo.png" alt="Seed Planning" onerror="this.style.display='none'">
      <div class="title">Japan Healthcare Market Research — FAQ</div>
    </div>
    <div class="search" role="search" aria-label="Search FAQ">
      <svg aria-hidden="true" width="18" height="18" viewBox="0 0 24 24"><path fill="currentColor" d="M10 2a8 8 0 0 1 6.32 12.906l4.387 4.387l-1.414 1.414l-4.387-4.387A8 8 0 1 1 10 2m0 2a6 6 0 1 0 0 12a6 6 0 0 0 0-12"/></svg>
      <input id="search" type="search" placeholder="Search keywords (title & content)..." autocomplete="off" />
      <div class="kbd">/</div>
      <div id="suggest" class="suggest" role="listbox" aria-label="Search suggestions"></div>
    </div>
  </div>
</header>

<div class="wrap">
  <div id="intro" class="intro">
    <p><strong>Purpose.</strong> Use the search above or browse by section. Click a question to open its dedicated page.</p>
    <div class="chips" aria-label="Quick filters">
      <a class="chip" href="#Patients">Patients</a>
      <a class="chip" href="#HCP">HCP</a>
      <a class="chip" href="#System">System</a>
      <a class="chip" href="#Compliance">Compliance</a>
      <a class="chip" href="#Fieldwork">Fieldwork</a>
      <a class="chip" href="#Operations">Operations</a>
      <a class="chip" href="#Timeline">Timeline</a>
    </div>
  </div>

  <!-- Sections (auto-populated) -->
  <!-- 一番上に追加 -->
  <section id="All"><h2 class="section-title">All <span class="badge" id="count-All"></span></h2><div class="faq-grid" data-section="All"></div></section>
  <section id="Patients"><h2 class="section-title">Patients <span class="badge" id="count-Patients"></span></h2><div class="faq-grid" data-section="Patients"></div></section>
  <section id="HCP"><h2 class="section-title">HCP <span class="badge" id="count-HCP"></span></h2><div class="faq-grid" data-section="HCP"></div></section>
  <section id="System"><h2 class="section-title">System <span class="badge" id="count-System"></span></h2><div class="faq-grid" data-section="System"></div></section>
  <section id="Compliance"><h2 class="section-title">Compliance <span class="badge" id="count-Compliance"></span></h2><div class="faq-grid" data-section="Compliance"></div></section>
  <section id="Fieldwork"><h2 class="section-title">Fieldwork <span class="badge" id="count-Fieldwork"></span></h2><div class="faq-grid" data-section="Fieldwork"></div></section>
  <section id="Operations"><h2 class="section-title">Operations <span class="badge" id="count-Operations"></span></h2><div class="faq-grid" data-section="Operations"></div></section>
  <section id="Timeline"><h2 class="section-title">Timeline <span class="badge" id="count-Timeline"></span></h2><div class="faq-grid" data-section="Timeline"></div></section>
  <section id="Uncategorized"><h2 class="section-title">Uncategorized <span class="badge" id="count-Uncategorized"></span></h2><div class="faq-grid" data-section="Uncategorized"></div></section>
  <!-- Category groups -->
<section id="ByCategory">
  <h2 class="section-title">By Category</h2>
  <div id="category-groups"></div>
</section>
  <footer class="site"><p>© <span id="year"></span> Seed Planning.</p></footer>
</div>

<!-- Load data -->
<script src="data/faqs.js"></script>

<script>
/* ===== Search / Highlight ===== */
function norm(s){ // 全半角や長音の揺れを軽減（軽めの正規化）
  return String(s||'')
    .toLowerCase()
    .replace(/[\u2010-\u2015\u2212]/g,'-')
    .replace(/[Ａ-Ｚａ-ｚ０-９]/g,ch=>String.fromCharCode(ch.charCodeAt(0)-0xFEE0));
}
function esc(s){return String(s||'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));}

// 安全に <mark> を差し込む（先にエスケープ→正規表現マッチ）
function highlightEscaped(text, query){
  if(!query) return esc(text);
  const q = norm(query).replace(/[.*+?^${}()|[\]\\]/g,'\\$&'); // 正規表現エスケープ
  if(!q) return esc(text);
  const src = esc(text);
  // 可視テキストでの検索なので、src側をノーマライズしたインデックスと同期させたい
  // 簡易的に、位置ごとに比較して置換（小規模データ前提）
  const lower = src.toLowerCase();
  const idxs = [];
  let i=0;
  while(i < lower.length){
    const j = lower.indexOf(q, i);
    if(j === -1) break;
    idxs.push([j, j+q.length]);
    i = j + q.length;
  }
  if(!idxs.length) return src;
  let out='', pos=0;
  for(const [a,b] of idxs){
    out += src.slice(pos,a) + '<mark>' + src.slice(a,b) + '</mark>';
    pos = b;
  }
  out += src.slice(pos);
  return out;
}

// 検索キーワードを使ってカードHTMLを生成（ハイライト版）
function cardHtmlHighlighted(f, query){
  const link=`articles.html?id=${encodeURIComponent(f.id)}${query?('&q='+encodeURIComponent(query)) : ''}`;
  const tags=(f.categories||[]).map(c=>`<span class="tag">#${esc(c)}</span>`).join(' ');
  const a = String(f.answer||'');
  const preview = a.length>150 ? a.slice(0,150)+'…' : a;
  const title = query ? highlightEscaped(f.question, query) : esc(f.question);
  const prev  = query ? highlightEscaped(preview, query)  : esc(preview);
  return `<article class="faq" tabindex="0">
    <h3 class="q"><a href="${link}">${title}</a></h3>
    <p class="a">${prev}</p>
    <div class="meta">${tags} <a class="back" href="${link}" aria-label="Read: ${esc(f.question)}">Read</a></div>
  </article>`;
}

async function renderSectionsWithSearch(query){
  const FAQS = await DATA_PROMISE;
  const qn = norm(query||'').trim();
  const counts=Object.fromEntries(SECTIONS.map(s=>[s,0]));
  SECTIONS.forEach(section=>{
    const grid=document.querySelector(`.faq-grid[data-section="${section}"]`);
    if(!grid) return;
    let list=[];
    if(section==="All"){
      list=FAQS;
    }else if(section==="Uncategorized"){
      list=FAQS.filter(f=>!Array.isArray(f.categories) || f.categories.length===0);
    }else{
      list=FAQS.filter(f=>Array.isArray(f.categories) && f.categories.includes(section));
    }
    // フィルタはせず「常に表示」。ヒットがあればハイライトのみ行う。
    grid.innerHTML=list.map(f=>cardHtmlHighlighted(f, qn)).join('');
    counts[section]=list.length;
    const badge=document.getElementById('count-'+section);
    if(badge) badge.textContent=String(list.length);
  });
}

// サジェスト表示（タイトルと冒頭スニペット）
async function renderSuggest(query){
  const box = document.getElementById('suggest');
  if(!box) return;
  const q = norm(query||'').trim();
  if(!q){ box.classList.remove('visible'); box.innerHTML=''; return; }

  const FAQS = await DATA_PROMISE;
  const hits = FAQS.filter(f=>{
    const hay = norm(f.question+' '+(f.answer||''));
    return hay.includes(q);
  }).slice(0,20);

  if(!hits.length){ box.classList.remove('visible'); box.innerHTML=''; return; }

  box.innerHTML = hits.map(f=>{
    const title = highlightEscaped(f.question, query);
    const snip  = highlightEscaped(String(f.answer||'').slice(0,120), query);
    const href  = `articles.html?id=${encodeURIComponent(f.id)}&q=${encodeURIComponent(query)}`;
    return `<div class="s-item" role="option" data-id="${esc(f.id)}" data-href="${href}">
      <div class="s-title">${title}</div>
      <div class="s-snippet">${snip}</div>
    </div>`;
  }).join('');
  box.classList.add('visible');

  // クリックで遷移
  box.querySelectorAll('.s-item').forEach(it=>{
    it.addEventListener('click', ()=>{ location.href = it.getAttribute('data-href'); });
  });
}

// 入力イベント（1文字目から反応）
(function wireSearch(){
  const input = document.getElementById('search');
  const suggest = document.getElementById('suggest');
  if(!input) return;

  // ショートカット： "/" でフォーカス
  window.addEventListener('keydown', (e)=>{ if(e.key==='/'){ e.preventDefault(); input.focus(); } });

  let t=null;
  input.addEventListener('input', (e)=>{
    const v = e.target.value;
    clearTimeout(t);
    // 軽いデバウンス（50ms）
    t = setTimeout(()=>{
      renderSectionsWithSearch(v);
      renderSuggest(v);
    }, 50);
  });

  // フォーカス外れたらサジェスト閉じる
  document.addEventListener('click', (e)=>{
    if(!suggest) return;
    const within = e.target===suggest || suggest.contains(e.target) || e.target===input;
    if(!within){ suggest.classList.remove('visible'); }
  });
})();
</script>

</body>
</html>



